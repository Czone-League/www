xh5_define("plugins.TKChart",["utils.util","utils.utility"],function(t){function e(t){t.stopPropagation()}function i(t){t.preventDefault(),t.stopPropagation()}function a(t){return document.createElement(t)}function r(t,e){e=e||"block";var i=t.style;t&&(i.display="none"===i.display?e:"none")}function n(t){t.style.display="none"}function h(t){var e,i="undefined"==typeof getComputedStyle?t.currentStyle:getComputedStyle(t);return i.height?(e=parseFloat(i.width),"content-box"===i.boxSizing&&(e=e+parseFloat(i.paddingLeft)+parseFloat(i.paddingRight)+parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth))):e=t.clientWidth||parseFloat(t.style.width),0|e}function o(t){var e,i="undefined"==typeof getComputedStyle?t.currentStyle:getComputedStyle(t);return i.height?(e=parseFloat(i.height),"content-box"===i.boxSizing&&(e=e+parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)+parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth))):e=t.clientHeight||parseFloat(t.style.height),0|e}function s(t){return null===t?"Null":void 0===t?"Undefined":W.call(t).slice(8,-1)}function l(t,e,i){if(!e){return t}t||(t={});for(var a in e){e.hasOwnProperty(a)&&("Object"===s(e[a])?(!t[a]&&(t[a]={}),l(t[a],e[a],i)):!i&&a in t||(t[a]=e[a]))}return t}function c(t,e){if(t=Number(t),isNaN(t)){return"-"}var i=Math.abs(t);return 100000>i?t.toFixed(0):10000000>i?(t/10000).toFixed(e)+"\u4e07":100000000>i?(t/10000000).toFixed(e)+"\u5343\u4e07":(t/100000000).toFixed(e)+"\u4ebf"}function p(t){return"forex"==H(t)&&(t=t.slice(-6)),"BTC"==H(t)&&(t=t.replace("btc_btc","")),t=t.split("_"),t=t[t.length-1].toUpperCase()}function d(t){return/^sh6\d{5}|sh900\d{3}|sz00\d{4}|sz30\d{4}|sz20\d{4}$/.test(t)}function m(t,e,i){t="prototype" in t?t.prototype:t,e="prototype" in e?e.prototype:e;for(var a in e){e.hasOwnProperty(a)&&(i?null!=e[a]:null==t[a])&&(t[a]=e[a])}return t}function u(t){switch(t){case"t1":case"t5":return"tChart";case"repay":return"repayChart";case"predict":return"predictChart";case"networth":return"netWorthChart";default:return"kChart"}}function f(t,e){var i=document.createElement("ul"),a=e.more,r=a.length;l(i.style,e.subNavStyle,!0),i.style.display="none";for(var n=0;r>n;n++){var h=document.createElement("li");i.appendChild(h),l(h.style,e.subNavItemStyle,!0),h.innerHTML=e.viewMap[a[n]],h.setAttribute("type","subNav"),h.setAttribute(e.attributeName,a[n])}t.appendChild(i)}function y(t,e,i){var a=document.createElement("ul"),h=e.list,o=h.length;t.appendChild(a),a.style.display="none",l(a.style,e.navTopStyle,!0);for(var s=0,c=0;o>s;s++){var p=document.createElement("li");a.appendChild(p),l(p.style,e.navItemStyle,!0),"app"==h[s]?(i.tabs[c]?(p.innerHTML=i.tabs[c].name||"B/S\u70b9",p.setAttribute(e.attributeDj,i.tabs[c].v)):p.innerHTML=i.tabName[c]||"B/S\u70b9",c++):p.innerHTML=e.viewMap[h[s]],p.setAttribute("type","nav"),"more"===h[s]?(f(p,e),p.addEventListener("click",function(){r(this.querySelector("ul"))})):(p.setAttribute(e.attributeName,h[s]),p.addEventListener("click",function(){for(var e=t.querySelectorAll("li>ul"),i=e.length;i--;){n(e[i])}}))}return a}function k(t,e){this.parent=t,this.param=e,this._init()}function C(t,e,i){var a=t.getAttribute("type");"nav"==a?l(t.style,e,!0):"subNav"==a&&l(t.style,i,!0)}function v(t){var e={t1:"touzi_wap_v2_hq_04",t5:"touzi_wap_v2_hq_05",kcl:"touzi_wap_v2_hq_06",dk:"touzi_wap_v2_hq_07",kd:"touzi_wap_v2_hq_08",kw:"touzi_wap_v2_hq_09",km:"touzi_wap_v2_hq_10",k5:"touzi_wap_v2_hq_11",k15:"touzi_wap_v2_hq_12",k30:"touzi_wap_v2_hq_13",k60:"touzi_wap_v2_hq_14"};e[t]&&K(e[t],null,"touzi_wap_v2_hq")}function b(t,e,i){return t+': <span style="color: '+i+'">'+e+"</span>"}function w(t){return -1==["HF","forex_yt"].indexOf(t)}function S(t,e){this.parent=t,this.param=e,this._init(),this.simple(!0)}function g(t,e){if("LI"==t.target.nodeName){for(var i=t.target,a=this.querySelectorAll("li"),r=a.length;r--;){l(a[r].style,e.itemNormalStyle,!0),a[r].setAttribute("selected","false")}l(i.style,e.itemActiveStyle,!0),i.setAttribute("selected","true")}}function x(t,e){this.parent=t,this.param=e,this._init(),this.isShow=!0,this.hide()}function _(t,e){this.parent=t,this.param=e,this._init()}function A(t,e){var i=!1,a=H(t);e.on("viewChange",function(a){if(e.kChart){if("t1"!==a||"t5"!==a){e.kChart.setLineStyle({linetype:"solid"})}}})}function L(t,e){this.parent=t,this.param=e;var r=a("div"),n=r.style;l(n,e.style,!0);var h=a("div"),o=h.style;l(o,e.zoomInStyle,!0),h.addEventListener("click",function(e){t.chart.chart.zoom(!0),i(e)}),r.appendChild(h);var s=a("div"),c=s.style;l(c,e.zoomOutStyle,!0),s.addEventListener("click",function(e){t.chart.chart.zoom(!1),i(e),M(t,"zoom")}),r.appendChild(s),this.dom=r,t.param.wrap.dom.appendChild(r)}function I(t,e){this.parent=t,this.param=e;var i=a("div"),r=i.style;l(r,e.closeBoxStyle,!0);var n=a("div"),h=n.style;l(h,e.closeStyle,!0),n.addEventListener("click",function(){window.h5chart.closeClickChart()}),i.appendChild(n),this.dom=i,t.param.wrap.dom.appendChild(i)}function D(t,e){this.parent=t,this.param=e;
var i=a("div"),r=a("div"),n=i.style,h=r.style;l(n,e.style,!0),n.width=t._calcChartWidth()+"px",n.height=t._calcChartHeight()+"px",h.width="100%",h.height="100%",h.position="absolute",h.background="rgba(0,0,0)",h.zIndex="999",h.top=0,this.maskDom=r,this.parent.chart.dom.appendChild(r)}function T(t,e){this.parent=t,this.param=e,this.bag="";var i={eventid:e.key||"universal_callup",subname:e.value||"chart_CN_bs",uatrackKey:e.key||"universal_callup",androidInstallUrl:e.apk||this.bag,needOpenSource:!1};this.sfc=null,"undefined"!=typeof SinaFinanceCallUp&&(this.sfc=new SinaFinanceCallUp.CallUpSinaFinance(i))}function B(t,e){this.parent=t,this.param=e;var r=this,n=a("div"),h=n.style;l(h,e.style,!0);var o,s={eventid:"callup_zhengu",subname:"fromWapHq",uatrackKey:"callup_zhengu",needOpenSource:!1};"undefined"!=typeof SinaFinanceCallUp&&(o=new SinaFinanceCallUp.CallUpSinaFinance(s)),n.addEventListener("click",function(t){var e="",a=d(r.parent.symbol)?e:"";o&&o.tryDirectCall({callpagetype:"2",subtype:"1",symbol:r.parent.symbol,position:"fromwaphq",iostoh5:a,isDownload:!1,callfailUrl:a,openBrowser:function(){window.open(a,"_self")}}),K("dsjzg",null,"hq_center_hs"),i(t)}),this.dom=n,t.param.wrap.dom.appendChild(n)}function M(t,e,i){var a=t.param.callUpApp;1!=a.isCall&&(0==a.isSE?a.SEList.indexOf(e)>-1&&a.callBack&&a.callBack({pos:a.pix+t.market+"_"+i,key:"universal_callup",androidurl:a.bag}):a.noSEList.indexOf(e)>-1&&a.callBack&&a.callBack({pos:a.pix+t.market+"_"+i,key:"universal_callup",androidurl:a.bag}))}function z(t){for(var e=J.length;e--;){if(t.match(J[e])){return !0}}return !1}function N(t){t.chart.kInitParam.theme.K_RISE="#00a800",t.chart.kInitParam.theme.K_FALL="#f11200",t.chart.kInitParam.theme.T_RISE="#00a800",t.chart.kInitParam.theme.T_FALL="#f11200",t.chart.tInitParam.theme.K_RISE="#00a800",t.chart.tInitParam.theme.K_FALL="#f11200",t.chart.tInitParam.theme.T_RISE="#00a800",t.chart.tInitParam.theme.T_FALL="#f11200",t.info.upColor="#00a800",t.info.downColor="#f11200"}function F(t){return["sh000001","sz399001","sz399006","sz399415","sz399416","sz399300","sz000300"].indexOf(t)>-1}function R(t){for(var e=["USDTRY","USDZAR","AUDUSD","USDCAD","USDCHF","USDCNH","CZKUSD","DKKUSD","EURUSD","GBPUSD","USDHKD","USDHUF","ILSUSD","USDINR","USDJPY","USDMXN","MYRUSD","USDNOK","NZDUSD","PLNUSD","USDRUB","SEKUSD","SGDUSD","ARSUSD","USDPHP","USDKRW","USDIDR"],i=e.length;i--;){if(t==="fx_s"+e[i].toLowerCase()){return !0}}return !1}function U(t,e,i){var a=H(e);if(i){t.tab.list=["networth","repay"],t.chart.initView="networth",Number(i.flashType[1])&&(t.tab.list.unshift("predict"),t.chart.initView="predict"),Number(i.flashType[0])&&(t.tab.list.unshift("more"),t.chart.initView="t1"),t.tab.more=["t1","t5","kd","kw","km"],t.tab.viewMap.more="\u884c\u60c5\u8d70\u52bf",t.info.toFixedNum=4}else{switch(a){case"CN":if(d(e)){t.tech.kChart.rek=[-1,0,1];var r=decodeURIComponent(q.load("sina_hqchart_rek"));r="null"===r?-1:Number(r.replace('"rek',"").replace(/"/g,"")),t.chart.kChart.setReK=r}t.tab.list=["t1","t5","kd","kw","km","more"];break;case"HK":t.tab.list=["t1","t5","kcl","kd","kw","km"],t.chart.kInitParam.rate=0,t.chart.tInitParam.rate=0,t.info.toFixedNum=3,N(t);break;case"US":N(t);break;case"global_index":t.tab.list=["t1","kcl","kd","kw","km"],t.chart.tChart.tCharts=[{name:"MACD"}],t.chart.kChart.tCharts=[{name:"MACD"}],t.tech.tChart.pCharts=[],t.tech.tChart.tCharts=["null","MACD","BOLL","RSI","BBIBOLL","ROC","TRIX","DMA","EXPMA","BIAS","VR"],t.tech.kChart.pCharts=["MA","BBIBOLL","BOLL","EXPMA","SAR"],t.tech.kChart.tCharts=["null","MACD","ASI","BIAS","BRAR","CCI","DMA","DMI","KDJ","PSY","ROC","RSI","SAR","TRIX","WR"];break;case"forex":case"forex_yt":t.tab.list=__kls;var m=[];["t1","t5","k1","k5","k10","k15","k30","k60","k120","k240","kd","kw","km","kcl"].forEach(function(item,idx){if(__kls.indexOf(item)<0){m.push(item)}});t.tab.more="forex_yt"===a?["k5","k30"]:m,t.chart.initView=__ik,t.chart.kInitParam.nfloat=4,t.chart.kInitParam.newthour="forex_yt"===a?6:7,t.chart.kChart.tCharts=[{name:"VOLUME"}],t.chart.kChart.pCharts=[],t.tech.kChart.pCharts=["MA","BBIBOLL","BOLL","EXPMA","SAR"],t.tech.kChart.tCharts=["null","VOLUME","MACD","ASI","BIAS","BRAR","CCI","DMA","DMI","KDJ","PSY","ROC","RSI","SAR","TRIX","WR"],t.info.toFixedNum=4,t.chart.kChart.showRangeSelector={display:!1},N(t);break;case"BTC":t.tab.list="btc_btcokcoin"===e?["kd","kw","km","more"]:["k1","kd","kw","km","more"],t.tab.more=["k15"],t.chart.initView="btc_btcokcoin"===e?"kd":"k1",t.chart.kInitParam.nfloat=2,t.chart.kInitParam.newthour=0,t.chart.kChart.tCharts=[{name:"MACD"}],t.chart.kChart.pCharts=[],t.info.toFixedNum=2,t.chart.kChart.showRangeSelector={display:!1},N(t);break;case"HF":t.chart.tChart.tCharts=[{name:"MACD"}],t.chart.kChart.tCharts=[{name:"MACD"}],t.tech.tChart.pCharts=[],t.tech.tChart.tCharts=["null","MACD","BOLL","RSI","BBIBOLL","ROC","TRIX","DMA","EXPMA","BIAS","VR"],t.tech.kChart.pCharts=["MA","BBIBOLL","BOLL","EXPMA","SAR"],t.tech.kChart.tCharts=["null","MACD","ASI","BIAS","BRAR","CCI","DMA","DMI","KDJ","PSY","ROC","RSI","SAR","TRIX","WR"],t.tab.list=["t1","kcl","kd","kw","km"],t.chart.tChart.showScale="pct",t.chart.tInitParam.tchartobject={t:["MACD","BOLL","RSI","BBIBOLL","ROC","TRIX","DMA","EXPMA","BIAS","VR"]},t.chart.kInitParam.tchartobject={k:["MACD","ASI","BIAS","BRAR","CCI","DMA","DMI","KDJ","PSY","ROC","RSI","SAR","TRIX","WR"]},~["hf_ES"].indexOf(e)?t.info.toFixedNum=2:~["hf_DXF","hf_SF","hf_CD","hf_JY","hf_BP","hf_EC"].indexOf(e)?(t.info.toFixedNum=4,t.info.percentToFixedNum=4):t.info.toFixedNum=3;
break;case"NF":t.tab.list=["t1","t5","kd","k30","k60","more"],t.tab.more=["k5","k15","kcl","kw","km"],t.chart.tChart.showScale="pct",t.tech.tChart.tCharts=["null","TVOL","POSITION","LB","MACD","BOLL","RSI","BBIBOLL","ROC","TRIX","DMA","EXPMA","BIAS","VR"];break;case"OTC":"sb899001"===e?(t.tab.list=["kcl","kd","kw","km"],t.chart.initView="kcl"):t.tab.list=["t1","kcl","kd","kw","km"]}}}function E(t,e){X.call(this);var i=t.chart.symbol,a=this;if(this.symbol=t.chart.symbol,t.chart.isFund){}else{U(j,i),this._init(t,e)}}function O(){return window.chart?"vertical"==window.chart.direction:!1}function P(){this.VERSION="1.2.12",this.get=function(e,i){function a(e){r.off(e,a),t.isFunc(i)&&i(r)}var r=new E(e,i);r.on("AppTKChartLoaded",a,!1)}}var H=t.market,K=t.suda,V=t.load,q=t.localSL,W=Object.prototype.toString,X=function(){var t=Array.prototype.slice,e=function(){this.eventList={}};return e.prototype={constructor:e,on:function(t,e,i,a){var r=this.eventList;return e&&t?(r[t]||(r[t]=[]),r[t].push({handler:e,one:a,ctx:i||this}),this):this},one:function(t,e,i){this.on(t,e,i,!0)},off:function(t,e){var i=this.eventList;if(!t){return this.eventList={},this}if(e){if(i[t]){for(var a=[],r=0,n=i[t].length;n>r;r++){i[t][r].handler!=e&&a.push(i[t][r])}i[t]=a}i[t]&&0===i[t].length&&delete i[t]}else{delete i[t]}},trigger:function(e){if(this.eventList[e]){var i=arguments,a=i.length;a>3&&(i=t.call(i,1));for(var r=this.eventList[e],n=r.length,h=0;n>h;){switch(a){case 1:r[h].handler.call(r[h].ctx);break;case 2:r[h].handler.call(r[h].ctx,i[1]);break;case 3:r[h].handler.call(r[h].ctx,i[1],i[2]);break;default:r[h].handler.apply(r[h].ctx,i)}r[h].one?(r.splice(h,1),n--):h++}}return this}},e}();k.prototype={constructor:k,_init:function(){var t,e=this.param,i=this.parent,r=a("div");l(r.style,e.style,!0),i.param.wrap.dom.appendChild(r),this.nav=y(r,this.param,this.parent.param.bsCallUp),this.dom=r,t=this.nav.querySelector("["+e.attributeName+"="+i.param.chart.initView+"]"),C(t,e.navItemActiveStyle,e.subNavItemActiveStyle),this.selectedView=t,this.resize(),this.bindClickEvent()},setStyle:function(){this.nav.style.display="block",this.resize()},setView:function(t){var e=this.param,i=t,a=this.nav.querySelector("["+e.attributeName+"="+i+"]");C(this.selectedView,e.navItemStyle,e.subNavItemStyle),this.selectedView=a,C(a,e.navItemActiveStyle,e.subNavItemActiveStyle)},bindClickEvent:function(){var t,e=this,i=this.param,a=this.parent;this.nav.addEventListener("click",function(r){var n=r.target,h=n.getAttribute(i.attributeName),o=n.getAttribute(i.attributeDj);if(h){if(location.origin.match("touzi")&&v(h),a.chart){if("app"===h){switch(a.market){case"CN":a.bsCallUp.call();break;case"US":case"HK":a.bsCallUp.callNew(o)}return}if(a.chart.showView(h),"dk"===h){F(e.parent.symbol)?(a.chart.chart.showKTechM("DPDK"),a.chart.chart.switchKTech("DPDKS")):(a.chart.chart.showKTechM("TZY"),a.chart.chart.switchKTech("TZYS")),a.tech&&a.tech.hide()}else{if(a.chart.chart.hideKTechM("TZY"),a.chart.chart.hideKTechM("DPDK"),a.tech){switch(a.chart.chart.getChartType()){case"tChart":a.tech.param.tChart.show&&"vertical"!=a.direction?(a.tech.show(),a.tech.switchTechList("tChart")):a.tech.hide();break;case"kChart":if(a.tech.param.kChart.show&&"vertical"!=a.direction?(a.tech.show(),a.tech.switchTechList("kChart")):a.tech.hide(),"dk"===t){var s=e.parent.tech.kChart.tCharts.querySelector("[selected=true]");s&&a.chart.chart.switchKTech(s.getAttribute("value"))}if("k0"===h){a.chart.chart.hideKTechM("MA")}else{var l=e.parent.tech.kChart.pCharts.querySelector("[selected=true]");l&&"MA"===l.getAttribute("value")&&a.chart.chart.showKTechM("MA")}break;default:a.tech.hide()}}}a.resize(),t=h}C(e.selectedView,i.navItemStyle,i.subNavItemStyle),C(n,i.navItemActiveStyle,i.subNavItemActiveStyle),e.selectedView=n}})},resize:function(){for(var t=this.nav,e=this.nav.querySelectorAll("ul li"),i=this.param.list,a=h(t)/i.length,r=e.length;r--;){e[r].style.width=a+"px"}},moveTo:function(t){var e=this.nav.querySelector("li>ul");"bottom"==t?(this.parent.param.wrap.dom.appendChild(this.dom),l(this.nav.style,this.param.navBottomStyle,!0),e&&(e.style.bottom="100%")):(this.parent.param.wrap.dom.insertBefore(this.dom,this.parent.param.wrap.dom.firstChild),l(this.nav.style,this.param.navTopStyle,!0),e&&(e.style.bottom=""))}};var Y=["t","k","netWorth","repay","predict"];S.prototype={constructor:S,_init:function(){var t=this.parent,e=this.param,i=a("div"),r=i.style;l(r,this.isSimple?e.simpleStyle:e.completeStyle,!0),this.dom=i,t.param.wrap.dom.appendChild(i),this._initDoms()},simple:function(t){"undefined"==typeof t&&(t=!0);var e=this.param;if(this.isSimple=t,t){l(this.dom.style,e.simpleStyle,!0),this.doms.nameBox.style.display="none",this.doms.price.style.display="none";for(var i=Y.length;i--;){l(this.doms[Y[i]+"Detail"].style,e.simpleDetailStyle,!0)}}else{for(l(this.dom.style,e.completeStyle,!0),this.doms.nameBox.style.display="block",this.doms.price.style.display="block",i=Y.length;i--;){l(this.doms[Y[i]+"Detail"].style,e.completeDetailStyle,!0)
}}},_initDoms:function(){function t(t,r){var h=a("div");i.appendChild(h),n.doms[t+"Detail"]=h;for(var s=0;r>s;s++){var c=a("div"),p=c.style;i.appendChild(c),l(p,e[t+"DetailItemStyle"],!0),p.lineHeight=o(c)+"px",h.appendChild(c)}}var e=this.param,i=a("div"),r=i.style,n=this;this.doms={},r.height="100%",r.width="100%",this.dom.appendChild(i);var h=a("div");i.appendChild(h),l(h.style,e.nameBoxStyle,!0),this.doms.nameBox=h;var s=a("div");h.appendChild(s),l(s.style,e.nameStyle,!0),this.doms.name=s;var c=a("div");h.appendChild(c),l(c.style,e.symbolStyle,!0),this.doms.symbol=c;var p=a("div"),d=p.style;return i.appendChild(p),l(p.style,e.priceStyle,!0),d.lineHeight=o(p)+"px",this.doms.price=p,t("t",6),t("k",6),t("netWorth",2),t("repay",1),t("predict",3),this.doms.dom=i,i},_displayNoneExcept:function(t){for(var e=Y.length;e--;){Y[e]!==t&&(this.doms[Y[e]+"Detail"].style.display="none")}},_showDetailInfo:function(t,e,i){var a,r,n=e.percent,h=this.param,o=h.toFixedNum,s=this.param.percentToFixedNum,l=h.upColor,p=h.downColor,d=h.levelColor;if(isNaN(n)&&(n=0),"tChart"==t){this._displayNoneExcept("t"),a=this.doms.tDetail,r=e.price/(1+n),a.childNodes[0].innerHTML=b("\u4ef7",e.price.toFixed(o),n>0?l:0>n?p:d),a.childNodes[1].innerHTML=b("\u5747",isNaN(e.avg_price)?"-":e.avg_price.toFixed(o),e.avg_price>r?l:e.avg_price<r?p:d),a.childNodes[2].innerHTML=b("\u5e45",(100*n).toFixed(s)+"%",n>0?l:0>n?p:d),a.childNodes[3].innerHTML=this.parent.hasVolume?"\u91cf: "+c(e.volume,2):""}else{if("kChart"==t){this._displayNoneExcept("k"),a=this.doms.kDetail,r=e.close/(1+n),a.childNodes[0].innerHTML=b("\u5f00",e.open.toFixed(o),e.open>r?l:e.open<r?p:d),a.childNodes[1].innerHTML=b("\u9ad8",e.high.toFixed(o),e.high>r?l:e.high<r?p:d),a.childNodes[2].innerHTML=b("\u5e45",(100*n).toFixed(s)+"%",n>0?l:0>n?p:d),a.childNodes[3].innerHTML=b("\u6536",e.close.toFixed(o),n>0?l:0>n?p:d),a.childNodes[4].innerHTML=b("\u4f4e",e.low.toFixed(o),e.low>r?l:e.low<r?p:d),a.childNodes[5].innerHTML=this.parent.hasVolume?"\u91cf: "+c(e.volume,2):""}else{if("netWorthChart"==t){this._displayNoneExcept("netWorth"),a=this.doms.netWorthDetail,i.length>1&&(a.childNodes[0].innerHTML=b(i[0].name,i[0].data.close.toFixed(h.toFixedNum)),a.childNodes[1].innerHTML=b(i[1].name,i[1].data.close.toFixed(h.toFixedNum)))}else{if("repayChart"===t){this._displayNoneExcept("repay"),a=this.doms.repayDetail;var m="";this.parent.tab.param.viewMap&&this.parent.tab.param.viewMap.repay&&(m=this.parent.tab.param.viewMap.repay),a.childNodes[0].innerHTML=b(m||"\u5386\u53f2\u56de\u62a5",e.close.toFixed(h.toFixedNum))}else{"predictChart"===t&&(this._displayNoneExcept("predict"),a=this.doms.predictDetail,r=e.price/(1+n),a.childNodes[0].innerHTML=b("\u4f30",e.price.toFixed(o),n>0?l:0>n?p:d),a.childNodes[1].innerHTML=b("\u5747",isNaN(e.avg_price)?"-":e.avg_price.toFixed(o),e.avg_price>r?l:e.avg_price<r?p:d),a.childNodes[2].innerHTML=b("\u5e45",(100*n).toFixed(s)+"%",n>0?l:0>n?p:d))}}}}a.style.display="block"},_showSimple:function(t,e){var i=t.data;t.interacting?(this.dom.style.display="block",this._showDetailInfo(e,i,t.data_array)):this.dom.style.display="none"},_showComplete:function(t,e){var i,a=this.param,r=this.doms.price,n=this.doms.symbol,h=this.doms.name,o=t.data,s=this.parent.chart.param.isFund;h.innerHTML=s?s.name:t.curname,n.innerHTML=p(this.parent.param.chart.symbol),i=o.percent,r.style.color=i>0?a.upColor:0>i?a.downColor:a.levelColor,this._showDetailInfo(e,o,t.data_array),r.innerHTML="tChart"==e?o.price.toFixed(a.toFixedNum):"kChart"==e?o.close.toFixed(a.toFixedNum):""},show:function(t,e){this[this.isSimple?"_showSimple":"_showComplete"](t,e)}},x.prototype={constructor:x,_init:function(){var t=this.parent,e=this.param,i=a("div"),r=i.style;l(r,e.style,!0),this.dom=i;this._initTechList("tChart"),this._initTechList("kChart");this.switchTechList(u(t.param.chart.initView)),this.resize(),t.param.wrap.dom.appendChild(i)},switchTechStyle:function(t,e){for(var i=this.param,a=e.Indicator,r=this[t].tCharts.querySelectorAll("li"),n=r.length;n--;){l(r[n].style,i.itemNormalStyle,!0),r[n].setAttribute("selected","false"),r[n].getAttribute("value")===a.name&&l(r[n].style,i.itemActiveStyle,!0)}},switchTechList:function(t){this.tChart&&(this.tChart.dom.style.display="none"),this.kChart&&(this.kChart.dom.style.display="none"),("tChart"==t||"kChart"==t)&&(this[t]?this[t].dom.style.display="block":this._initTechList(t),this.isShow=!0)},_initTechList:function(t){var e,i,r,n=this.parent,h=this.dom,o=this.param,s=a("div"),c=s.style;return this[t]={},c.width="100%",c.height="100%",o[t].rek&&o[t].rek.length&&(e=this._initOneList(s,o[t].rek,n.param.chart[t].setReK),e.addEventListener("click",function(t){g.call(this,t,o),n.chart.chart.setReK(t.target.getAttribute("value")),q.save("sina_hqchart_rek","rek"+t.target.getAttribute("value"))})),i=this._initOneList(s,o[t].pCharts,n.param.chart[t].pCharts,!0),i.addEventListener("click",function(e){var i=e.target;"LI"==e.target.nodeName&&("true"==i.getAttribute("selected")?(i.setAttribute("selected","false"),l(i.style,o.itemNormalStyle,!0),n.chart.chart["tChart"==t?"hideTTechM":"hideKTechM"](i.getAttribute("value"))):(i.setAttribute("selected","true"),l(i.style,o.itemActiveStyle,!0),n.chart.chart["tChart"==t?"showTTechM":"showKTechM"](i.getAttribute("value"))),M(n,"tech",t+"_"+i.getAttribute("value")))
}),r=this._initOneList(s,o[t].tCharts,n.param.chart[t].tCharts,!0),r.addEventListener("click",function(e){g.call(this,e,o),n.chart.chart["tChart"==t?"switchTTech":"switchKTech"](e.target.getAttribute("value"))}),this[t].rek=e,this[t].pCharts=i,this[t].tCharts=r,this[t].dom=s,h.appendChild(s),s},_initOneList:function(t,e,i,r){var n=a("ul"),h=this.param,o=h.techMap;l(n.style,h.boxStyle,!0);for(var c=0,p=e.length;p>c;c++){var d=a("li");if(d.innerHTML=o[e[c]]?o[e[c]]:e[c],d.setAttribute("value",e[c]),"Array"==s(i)){l(d.style,h.itemNormalStyle,!0);for(var m=i.length;m--;){if(i[m].name==e[c]){l(d.style,h.itemActiveStyle,!0),r&&d.setAttribute("selected","true");break}}}else{e[c]==i?l(d.style,h.itemActiveStyle,!0):l(d.style,h.itemNormalStyle,!0)}n.appendChild(d)}return t.appendChild(n),n},resize:function(){var t,e,i=this.tChart,a=this.kChart,r=this.parent._calcChartHeight(),n=42,h=0.5,o=0.5,s=3;t=3*n,this.dom.style.height=r+"px",i&&(i.pCharts.style.height=r*h+"px",i.tCharts.style.height=r*o+"px"),a&&(a.rek?(e=r-t,n*s>e&&(e=r>n*s?s*n:r,t=r-e),a.rek.style.height=t+"px"):e=r,a.pCharts.style.height=e*h+"px",a.tCharts.style.height=e*o+"px")},show:function(){this.dom.style.display="block",this.isShow=!0},hide:function(){this.dom.style.display="none",this.isShow=!1}},_.prototype={constructor:_,_init:function(){this._initWrap();var t=this,e=this.parent,i=this.param;KKE.api("plugins.lightTKChart.get",l(i,{dom:this.childDom,kInitParam:{onviewprice:function(t){e.info.show(t,"kChart")},ontechchanged:function(t){e.tech.switchTechStyle("kChart",t)},onshortclickmain:function(){O()}},tInitParam:{onviewprice:function(t){e.info.show(t,"tChart")},ontechchanged:function(t){e.tech.switchTechStyle("tChart",t)},onshortclickmain:function(){O()}},netWorthInitParam:{onviewprice:function(t){e.info.show(t,"netWorthChart")}},repayInitParam:{onviewprice:function(t){e.info.show(t,"repayChart")}},predictInitParam:{onviewprice:function(t){e.info.show(t,"predictChart")}}},!0),function(e){t.chart=e,t.parent.trigger("AppTKChartLoaded",null),t.parent.tab.setStyle(),A(i.symbol,e)})},_initWrap:function(){var t=this.parent,e=this.param,i=t.param.wrap.dom,r=a("div"),n=a("div"),h=r.style,o=n.style;l(h,e.style,!0),h.position="relative",h.width=t._calcChartWidth()+"px",h.height=t._calcChartHeight()+"px",o.width="100%",o.height="100%",this.dom=r,this.childDom=n,r.appendChild(n),i.appendChild(r)},resize:function(){var t=this.dom,e=t.style,i=this.parent;e.width=i._calcChartWidth()+"px",e.height=i._calcChartHeight()+"px",this.chart&&this.chart.resize()},showView:function(t,e){this.chart&&(this.chart.showView("dk"==t?"kd":t),M(this.parent,t,t),this.currentView=t),e&&this.parent.tab.setView(e)}},L.prototype={moveTo:function(t,e){this.dom.style.right=t,this.dom.style.bottom=e}},I.prototype={show:function(){this.dom.style.display="block"},hide:function(){this.dom.style.display="none"}},D.prototype={show:function(){this.maskDom.style.display="block"},hide:function(){this.maskDom.style.display="none"}},T.prototype={callNew:function(t){var e=this.parent.param.callUpApp;e&&e.callBack({key:"universal_callup",pos:e.pix+this.parent.market+"_"+t,androidurl:this.bag})},call:function(){this.sfc&&this.sfc.tryDirectCall({callpagetype:"2",symbol:this.parent.symbol,position:this.param.value||"chart_CN_bs"})}},B.prototype={moveTo:function(t,e){this.dom.style.right=t,this.dom.style.bottom=e}};var _s=(__style||{}),_ssc=((typeof(_s.ssc)=="undefined")?0:_s.ssc);var j={tab:{list:["t1","t5","k1","kd","kw","km","more"],more:["kcl","k5","k10","k15","k30","k60","k120","k240"],viewMap:{t1:"\u5206\u65f6",t5:"\u4e94\u65e5",kd:"\u65e5K",kw:"\u5468K",km:"\u6708K",kcl:"\u5e74\u7ebf",k1:"1\u5206",k5:"5\u5206",k10:"10\u5206",k15:"15\u5206",k30:"30\u5206",k60:"60\u5206",k120:"2\u5c0f\u65f6",k240:"4\u5c0f\u65f6",more:"\u66f4\u591a",dk:"B/S\u70b9",app:"B/S\u70b9",predict:"\u51c0\u503c\u9884\u6d4b",networth:"\u5386\u53f2\u51c0\u503c",repay:"\u5386\u53f2\u56de\u62a5"},style:{"float":"left",width:"100%",display:(_ssc==1?"none":"block"),height:(_ssc==1?"0px":"35px"),lineHeight:"35px",textAlign:"center",fontSize:"14px",backgroundColor:((typeof(_s.backgroundColor2)=="undefined")?"#F0F0F0":_s.backgroundColor2),listStyle:"none"},navTopStyle:{width:"100%",height:"100%",listStyle:"none"},navBottomStyle:{margin:"auto",width:"80%",height:"100%",listStyle:"none"},navItemStyle:{position:"relative","float":"left",listStyle:"none",height:"35px",color:((typeof(_s.color)=="undefined")?"#000":_s.color),backgroundColor:"",borderBottom:"",boxSizing:"border-box",webkitBoxSizing:"border-box"},navItemActiveStyle:{color:"#0099ff",backgroundColor:((typeof(_s.backgroundColor)=="undefined")?"#fff":_s.backgroundColor),borderBottom:"2px solid #0099ff"},subNavStyle:{position:"absolute",width:"100%",zIndex:999,listStyle:"none"},subNavItemStyle:{color:((typeof(_s.color)=="undefined")?"#000":_s.color),backgroundColor:((typeof(_s.backgroundColor2)=="undefined")?"#F0F0F0":_s.backgroundColor2)},subNavItemActiveStyle:{color:"#0099ff",backgroundColor:((typeof(_s.backgroundColor)=="undefined")?"#fff":_s.backgroundColor),},attributeDj:"data-dj",attributeName:"data-view"},chart:{symbol:"sh000001",initView:"t1",style:{"float":"left",width:"90%"},kInitParam:{theme:{},dim:{H_T_G:45},candlenum:50},tInitParam:{theme:{},dim:{H_T_G:45},candlenum:50},netWorthInitParam:{theme:{K_CL:"#00c1eb"},dual:{theme:{K_CL:"#fe6623"}},rate:0,nfloat:4},repayInitParam:{theme:{K_CL:"#987654"},rate:0,nfloat:4},predictInitParam:{nfloat:4},kChart:{setCustom:{allow_indicator_edit:!0,storage_lv:2,touch_prevent:!1},setReK:0,tCharts:[{name:"VOLUME"}],pCharts:[{name:"MA"}]},tChart:{setCustom:{allow_indicator_edit:!0,storage_lv:2,touch_prevent:!1},tCharts:[(_ssc==1?{}:{name:"TVOL"})],pCharts:[]},netWorthChart:{},repayChart:{},predictChart:{tCharts:[{name:"ADL"}]}},info:{simpleStyle:{width:"100%",display:(_ssc==1?"none":"block"),height:(_ssc==1?"0px":"35px"),paddingTop:"",lineHeight:"15px",textAlign:"left",position:"absolute",color:((typeof(_s.color)=="undefined")?"#000":_s.color),backgroundColor:((typeof(_s.backgroundColor)=="undefined")?"#fff":_s.backgroundColor),boxSizing:"content-box",webkitBoxSizing:"content-box"},completeStyle:{width:"100%",display:(_ssc==1?"none":"block"),height:(_ssc==1?"0px":"40px"),paddingTop:"5px",lineHeight:"",textAlign:"left","float":"left",position:"",color:((typeof(_s.color)=="undefined")?"#000":_s.color),backgroundColor:((typeof(_s.backgroundColor2)=="undefined")?"#F0F0F0":_s.backgroundColor2),boxSizing:"content-box",webkitBoxSizing:"content-box"},nameBoxStyle:{"float":"left",width:"20%",height:"100%",paddingLeft:"10px",boxSizing:"border-box",webkitBoxSizing:"border-box"},nameStyle:{fontSize:"17px",color:((typeof(_s.color)=="undefined")?"#000":_s.color),height:"24px",lineHeight:"24px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},symbolStyle:{fontSize:"13px",color:"#999999",height:"16px",lineHeight:"16px"},priceStyle:{"float":"left",width:"25%",height:"100%",fontSize:"26px"},simpleDetailStyle:{"float":"left",width:"90%",height:"100%",fontSize:"13px",marginLeft:"10%"},completeDetailStyle:{"float":"left",width:"55%",marginLeft:"",height:"100%",fontSize:"13px"},tDetailItemStyle:{"float":"left",width:"50%",height:"50%"},kDetailItemStyle:{"float":"left",width:"33%",height:"50%"},netWorthDetailItemStyle:{"float":"left",width:"50%",height:"100%"},repayDetailItemStyle:{width:"100%",height:"100%"},predictDetailItemStyle:{"float":"left",width:"33%",height:"100%"},upColor:(typeof(__style.upcolor)=="undefined"?"#f11200":__style.upcolor),downColor:(typeof(__style.downcolor)=="undefined"?"#23bc01":__style.downcolor),levelColor:((typeof(_s.color)=="undefined")?"#000":_s.color),toFixedNum:2,percentToFixedNum:2},tech:{show:!0,style:{width:(_ssc==1?"0px":"10%"),"float":"left"},boxStyle:{width:"100%",textAlign:"center",borderTop:"1px solid "+((typeof(_s.grid)=="undefined")?"#888":_s.grid),overflowY:"auto",backgroundColor:((typeof(_s.backgroundColor2)=="undefined")?"#F0F0F0":_s.backgroundColor2),fontSize:"12px",listStyle:"none",margin:0,padding:0,display:(_ssc==1?"none":"block")},kChart:{show:!0,tCharts:["null","VOLUME","ASI","BIAS","BRAR","CCI","DMA","DMI","EMV","KDJ","MACD","OBV","PSY","ROC","RSI","SAR","TRIX","VR","WR","WVAD","EMV"],pCharts:["VOLUME","MA","BBIBOLL","BOLL","EXPMA","SAR"]},tChart:{show:!0,tCharts:["null","TVOL","LB","MACD","BOLL","RSI","BBIBOLL","ROC","TRIX","DMA","EXPMA","BIAS","VR"],pCharts:["VOLUME"]},itemNormalStyle:{color:((typeof(_s.ttext)=="undefined")?"#000":_s.ttext),padding:"10px 0"},itemActiveStyle:{color:"#09f",padding:"10px 0"},techMap:{"null":"\u65e0","-1":"\u524d\u590d\u6743",0:"\u4e0d\u590d\u6743",1:"\u540e\u590d\u6743",VOLUME:"\u6210\u4ea4\u91cf",TVOL:"\u6210\u4ea4\u91cf",POSITION:"\u6301\u4ed3\u91cf",LB:"\u91cf\u6bd4"}},wrap:{style:{position:"relative",height:"100%",width:"100%",overflow:"hidden",webkitTouchCallout:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none",userSelect:"none",webkitTapHighlightColor:"rgba(0,0,0,0)"}},zoomBar:{show:!0,style:{position:"absolute",bottom:0,right:0,width:"70px",height:"30px",overflow:"hidden",zIndex:998},zoomOutStyle:{width:"30px",height:"30px",backgroundPosition:"0 0",backgroundRepeat:"no-repeat",backgroundSize:"100%","float":"right",backgroundImage:"url("+((typeof(__jsr)!="undefined")?__jsr:"")+"images/icon_add.png)"},zoomInStyle:{width:"30px",height:"30px",backgroundPosition:"0 0",backgroundRepeat:"no-repeat",backgroundSize:"100%","float":"left",backgroundImage:"url("+((typeof(__jsr)!="undefined")?__jsr:"")+"images/icon_subtract.png)"}},closeBtn:{show:!1,closeBoxStyle:{padding:0,bottom:0,right:0,position:"absolute",background:"#F0F0F0",textAlign:"center",overflow:"hidden",width:"35px",height:"35px"},closeStyle:{width:"20px",height:"20px",backgroundPosition:"0 0",backgroundRepeat:"no-repeat",backgroundSize:"100%",backgroundImage:"url(./images/iconclose2x.png)",margin:"8px 5px"}},mask:{show:!1},clinicStock:{show:0,style:{position:"absolute",bottom:0,right:0,width:"30px",height:"31px",overflow:"hidden",zIndex:998,backgroundPosition:"0 0",backgroundRepeat:"no-repeat",backgroundSize:"100%","float":"right",backgroundImage:""}},callUpApp:{isCall:0,isSE:0,pix:"chart_",bag:"",SEList:["km","kw","k5","k10","k15","k30","k60","k120","k240","zoom","tech"],noSEList:["k1","kd","kw","km","kcl","k5","k10","k15","k30","k60","k120","k240","zoom","tech"],callBack:null},bsCallUp:{tabs:[],tabName:["B/S\u70b9"],pix:"chart_",show:0,value:"",key:"",apk:""}},J=[],$=E.prototype;
return $._init=function(r){var n=this.symbol;this.param=l(r,j),this.market=H(n),this.hasVolume=w(this.market);var h=this.param.wrap.dom;if(l(h.style,this.param.wrap.style,!0),h.addEventListener("click",e),h.addEventListener("touchstart",e),h.addEventListener("touchmove",e),z(window.location.href)&&1!=t.localSL.load("tipToApp","cookie")){t.localSL.save("tipToApp",!0,{mode:"cookie",expires:10});var o=a("div"),s=o.style;s.position="absolute",s.left="50%",s.top="50%",s.width="300px",s.height="140px",s.marginLeft="-150px",s.marginTop="-90px",s.backgroundColor="rgba(0, 0, 0, 0.8)",s.zIndex="999";var c=a("span"),p=c.style;p.display="inline-block",p.width="100%",p.height="100px",p.lineHeight="100px",p.textAlign="center",p.color="#fff",p.borderBottom="1px solid #959595",c.innerHTML="\u524d\u5f80\u65b0\u6d6a\u8d22\u7ecf\u5ba2\u6237\u7aef\u67e5\u770b\u5b8c\u6574\u884c\u60c5",o.appendChild(c);var d=a("span"),m=d.style;m.display="inline-block",m["float"]="left",m.width="50%",m.height="40px",m.lineHeight="40px",m.textAlign="center",m.color="#fff",d.innerHTML="\u6682\u4e0d\u524d\u5f80",o.appendChild(d);var u=a("span"),f=u.style;f.display="inline-block",f["float"]="left",f.width="50%",f.height="40px",f.lineHeight="40px",f.textAlign="center",f.color="#fff",u.innerHTML="\u7acb\u5373\u524d\u5f80",o.appendChild(u),h.appendChild(o),s.display="none",h.addEventListener("click",function(t){s.display="block",t&&i(t)}),u.addEventListener("click",function(){}),d.addEventListener("click",function(){s.display="none",h.removeChild(o)})}this.tab=new k(this,r.tab),this.info=new S(this,r.info),r.tech.show&&(this.tech=new x(this,r.tech)),this.chart=new _(this,r.chart),r.zoomBar.show&&(this.zoomBar=new L(this,r.zoomBar)),r.closeBtn.show&&(this.closeBtn=new I(this,r.closeBtn)),r.mask.show&&(this.mask=new D(this,r.mask));var y=/^sz100\d{3}|sz101\d{3}|sz106\d{3}|sz107\d{3}|sz108\d{3}|sz109\d{3}|sz111\d{3}|sz112\d{3}|sz115\d{3}|sz12\d{4}|sz13\d{4}$/,C=/^sh020\d{3}|sh20\d{4}|sh1\d{5}|sh009\d{3}|sh010\d{3}|sh018\d{3}|^sh019\d{3}$/;"CN"===this.market&&(y.test(this.symbol)||C.test(this.symbol)||r.clinicStock.show&&(this.clinicStock=new B(this,r.clinicStock))),r.bsCallUp.show&&(this.bsCallUp=new T(this,r.bsCallUp)),this.setDirection("vertical")},$.setDirection=function(t){var e=this.chart.chart?this.chart.chart.currentView:this.chart.param.initView,i=u(e);"vertical"==t?(this.tech&&this.tech.hide(),this.tab.moveTo("top"),this.info.simple(!0),this.zoomBar&&this.zoomBar.moveTo(this.clinicStock?"50px":"10px","35px"),this.clinicStock&&this.clinicStock.moveTo("10px","35px"),this.closeBtn&&this.closeBtn.hide(),this.mask&&this.mask.show()):(this.tech&&("dk"==e?this.tech.hide():("tChart"===i?this.tech.param.tChart.show&&this.tech.show():"kChart"===i&&this.tech.param.kChart.show&&this.tech.show(),this.tech.switchTechList(u(e)))),this.tab.moveTo("bottom"),this.info.simple(!1),this.zoomBar&&this.zoomBar.moveTo(this.clinicStock?"50px":"10px","70px"),this.clinicStock&&this.clinicStock.moveTo("10px","70px"),this.closeBtn&&this.closeBtn.show(),this.mask&&this.mask.hide()),this.direction=t,this.resize(),this.update()},$.setCustom=function(t){this.chart&&this.chart.chart?this.chart.chart.setCustom(t):(l(this.param.chart.kChart.setCustom,t,!0),l(this.param.chart.tChart.setCustom,t,!0))},$.resize=function(){this.tab&&this.tab.resize(),this.tech&&this.tech.isShow&&this.tech.resize(),this.chart&&this.chart.resize()},$.appendTo=function(t){t.appendChild(this.param.wrap.dom),this.resize()},$.update=function(){this.chart&&this.chart.chart&&this.chart.chart.update()},$.pushData=function(t,e){this.chart&&this.chart.chart&&this.chart.chart.pushData(t,e)},$.callUpApp=function(t){t&&t.isCallUp&&(this.param.callUpApp.isCall=t.isCallUp)},$._calcChartHeight=function(){var t=this.param.wrap.dom,e=o(t);return this.tab&&(e-=o(this.tab.dom)),this.info&&!this.info.isSimple&&(e-=o(this.info.dom)),e},$._calcChartWidth=function(){var t=this.param.wrap.dom,e=h(t);return this.tech&&this.tech.isShow&&(e=e-h(this.tech.dom)-1),e},window.shortClickChart=O,m(E,X),P});