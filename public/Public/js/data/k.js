xh5_define("datas.k",["utils.util"],function(e){var t=e.load,n=e.dateUtil,a=e.kUtil,i=e.xh5_S_KLC_D,o=0==location.protocol.indexOf("https:");return new function(){this.VER="2.5.14";var r={CN:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",DAYK_RE_URL:"http://finance.sina.com.cn/realstock/newcompany/$symbol/p$dirfq.js?_=$rn",RE_VAR:"$symbol$dirfq"},HK:{MINK_URL:"",DAYK_URL:"http://finance.sina.com.cn/stock/hkstock/$symbol/klc_kl.js?d=$rn"},US:{MINK_URL:__quoteapi+"?token="+__token+"&$cb/US_MinKService.getMinK?symbol=$symbol&type=$scale&___qn=3",DAYK_URL:"http://finance.sina.com.cn/us_stock/company/hisdata/klc_kl_$symbol.js"},option_cn:{DAYK_URL:__quoteapi+"?token="+__token+"&$cb/StockOptionDaylineService.getSymbolInfo?symbol=$symbol"},op_m:{DAYK_URL:__quoteapi+"?token="+__token+"&$cb/FutureOptionAllService.getOptionDayline?symbol=$symbol"},forex:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"},forex_yt:{DAYK_URL:__quoteapi+"?token="+__token+"&$cb/NewForexService.getDayKLine?symbol=$symbol&_=$rn",MINK_URL:__quoteapi+"?token="+__token+"&$cb/NewForexService.getOldMinKline?symbol=$symbol&scale=$scale&datalen=$datalen"},OTC:{DAYK_URL:__quoteapi+"?token="+__token+"&$cb/ThirdDataService.ThirdDailyData?symbol=$symbol&_=$rn"},CFF:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"},HF:{DAYK_URL:__quoteapi+"?token="+__token+"&$cb/GlobalFuturesService.getGlobalFuturesDailyKLine?symbol=$symbol&_=$rn",INIT_URL:__quoteapi+"?token="+__token+"&$cb/InterfaceInfoService.getMarket?category=hf&symbol=$symbol",INIT_VAR_PRE:"kke_"},NF:{DAYK_URL:__quoteapi+"?token="+__token+"&$cb/InnerFuturesNewService.getDailyKLine?symbol=$symbol&_=$rn",MINK_URL:__quoteapi+"?token="+__token+"&$cb/InnerFuturesNewService.getFewMinLine?symbol=$symbol&type=$scale",INIT_URL:__quoteapi+"?token="+__token+"&$cb/InterfaceInfoService.getMarket?category=nf&symbol=$symbol",INIT_VAR_PRE:"kke_"},global_index:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",INIT_URL:__quoteapi+"?token="+__token+"&$cb/Global_IndexService.getTradeTime?symbol=$symbol&category=index",INIT_VAR_PRE:"kke_global_index_"},BTC:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"}},s=function(){return{msg:"",data:null}},l=function(t,i,o){var r=L(o),s=o.symbol,l=o.newthour,c=1,h=r.market;"CN"==h&&(c=i&&/[gz]/.test(i.type)?10:e.isRepos(s)?10:100),t||(t=[]);var d=0/0,u="";if(i&&i.date){var m,p=i.date,f=!1;t.length>0?(m=t[t.length-1],p||(p=m.date)):f=!0,m&&("NF"==h?n.stbd(m.date,p)?1!=i.iscff&&i.withNight&&i.time>=l?f=!0:i.open&&i.price&&(m.open=i.open,m.high=i.high,m.low=i.low,m.close=i.price,m.volume=i.totalVolume*c):p<m.date||(f=!0):n.stbd(m.date,p)?i.date&&i.open&&i.price&&(m.open=i.open,m.high=i.high,m.low=i.low,m.close=i.price,m.volume=i.totalVolume*c,m.date=n.ddt(p)):p<m.date||(f=l?i.time>=l:!0)),f&&t.push({open:i.open,high:i.high,low:i.low,close:i.price,volume:i.totalVolume*c,date:n.ddt(p)}),d=i.issueprice,u=i.name}if(t.length<1){return[t,void 0,void 0,void 0]}var v=!isNaN(d)&&d>0?d:t[0].open;e.oc(t[0],{prevclose:v,name:u,symbol:s});var g=a.mw(t,i,v,c,r.endDay),b=g[0],y=g[1],N=void 0;if(a.pd(t,null),a.pd(b,null),a.pd(y,null),i&&i.settlement){var w=t[t.length-1];w.ampP=w.amplitude/i.settlement,w.change=w.close-i.settlement,w.percent=w.change/i.settlement}return e.oc(b[0],{name:u,symbol:s}),e.oc(y[0],{name:u,symbol:s}),o.ytd&&(N=a.yd(t),e.oc(N[0],{name:u,symbol:s})),[t,b,y,N]},c=function(t,n,a){var i=e.market(t),s=i?r[i][n?"MINK_URL":"DAYK_URL"]:null;return(o||a)&&(s=e.getSUrl(s)),s},h=function(t,n){var a,i,s=e.market(t);return r[s]&&(a=r[s].DAYK_RE_URL,i=r[s].RE_VAR),a&&(o||n)&&(a=e.getSUrl(a)),{url:a,VAR:i,market:s}},d=function(t,n){var a,i,s,l=e.market(t);return r[l]&&(a=r[l].INIT_URL,i=r[l].INIT_VAR,s=r[l].INIT_VAR_PRE),a&&(o||n)&&(a=e.getSUrl(a)),{url:a,VAR:i,varPre:s,market:l}},u={xh5Fund:function(e){for(var t,n,a,i,o=new Date,r=[o.getFullYear(),o.getMonth()+1,o.getDate()].join("_"),s=e.data,l=e.symbol,c=s.split("#"),h=[],d=[],u=[],m=[],p=[],f=[],v=c.length;v--;){i=c[v].split(","),t=i[0].slice(0,4),n=i[0].slice(4,6),a=i[0].slice(6,8),a=[t,n,a].join("-"),h.push({d:a,c:i[1]}),d.push({d:a,c:i[2]}),u.push({d:a,c:i[3]}),m.push({d:a,c:i[4]}),p.push({d:a,c:i[5]}),f.push({d:a,c:i[6]})}var g=["_dwjz_",l,r].join(""),b=["_ljjz_",l,r].join(""),y=["_lshb_",l,r].join(""),N=["_pwbfbyd_",l,r].join(""),w=["_pwbfbjd_",l,r].join(""),_=["_pwbfbnd_",l,r].join(""),k=["_fh_",l,r].join("");window[g]=h,window[b]=d,window[y]=u,window[N]=m,window[w]=p,window[_]=f,window[k]={fhday:e.fhday,fhvalue:e.fhvalue,fhchaifen:e.fhchaifen}
}},m=function(e){var t=[];if(e){for(var n,a,i=0,o=e.length;o>i;i++){a=e[i],n=Number(a.c);var r=a.d.split("-");t.push({close:n,open:Number(a.o)||n,high:Number(a.h)||n,low:Number(a.l)||n,volume:Number(a.v)||0,date:new Date(Number(r[0]),Number(r[1])-1,Number(r[2]),0)})}}return t},p=function(e){var t=[];if(e){for(var n,a,i=e.split("|"),o=0,r=i.length;r>o;o++){n=i[o].split(","),n.length<5||(a=n[0].split("-"),t.push({open:Number(n[1]),low:Number(n[2]),high:Number(n[3]),close:Number(n[4]),volume:Number(n[5]),date:new Date(Number(a[0]),Number(a[1])-1,Number(a[2]),0)}))}}return t},f=function(e){var t=[];if(e&&e.result&&e.result.data){for(var n,a,i=e.result.data,o=i.split("|"),r=0,s=o.length;s>r;r++){n=o[r].split(","),n.length<5||(a=n[0].split("-"),t.push({open:Number(n[1]),low:Number(n[2]),high:Number(n[3]),close:Number(n[4]),volume:Number(n[5]),date:new Date(Number(a[0]),Number(a[1])-1,Number(a[2]),0)}))}}return t},v=function(e){var t=[];if(e&&e.length){for(var n,a,i=0.001,o=e.split("|"),r=0,s=0,l=o.length;l>s;s++){n=o[s].split(","),n.length<5||(a=n[0].split("-"),r=Number(n[4])||r,t.push({open:Number(n[1])||r,low:Number(n[2])||r,high:Number(n[3])||r,close:Number(n[4])||r,volume:Number(n[5])*i,date:new Date(Number(a[0]),Number(a[1])-1,Number(a[2]),0)}))}}return t},g=function(e){var t=[];if(e){for(var n,a,i,o=0,r=e.length;r>o;o++){n=e[o],a=n[0].split("-"),i=Number(n[4]),t.push({date:new Date(Number(a[0]),Number(a[1])-1,Number(a[2]),0),open:Number(n[1])||i,high:Number(n[2])||i,low:Number(n[3])||i,close:i,volume:Number(n[5])||0})}}return t},b=function(e){var t=[];if(e){for(var n,a,i=e.length;i--;){n=e[i],a=Number(n[4]),t.push({day:n[0],open:Number(n[1])||a,high:Number(n[2])||a,low:Number(n[3])||a,close:a,volume:Number(n[5])||0})}}return t},y=function(e){var t=[];if(e){for(var a,i,o=0,r=e.length;r>o;o++){a=e[o],i=Number(a.close),t.push({date:n.sd(a.date),volume:Number(a.volume),open:Number(a.open)||i,high:Number(a.high)||i,low:Number(a.low)||i,close:i})}}return t},N=function(e,t){if(!e){return null}for(var n,a=t.vu||1,i=0,o=e.length;o>i;i++){n=e[i],n.high*=1,n.open*=1,n.low*=1,n.close*=1,n.volume*=a}return e},w=function(e){if(!e){return null}for(var t,a=0,i=e.length;i>a;a++){t=e[a],t.high=1*t.h,t.open=1*t.o,t.low=1*t.l,t.close=1*t.c,t.volume=1*t.v,t.day=t.d,t.date=n.sd(t.d)}return e},_=function(e){if(!e){return null}for(var t,a=0,i=e.length;i>a;a++){t=e[a],t.high=1*t.h,t.open=1*t.o,t.low=1*t.l,t.close=1*t.c,t.volume=1*t.v,t.date=n.sd(t.d)}return e},k=function(t,a,i,o){for(var r,s,l=e.market(o.hqSb),c="BTC"==l?0:("DINIW"==o.hqSb,6),h=a.length;h--&&0!=h;){for(var d=a[h],u=a[h-1],m=n.ssd(d.day),p=n.ssd(u.day),f=h;p.setMinutes(p.getMinutes()+i)<m;){if(r=p.getDay(),6==r){if(s=p.getHours(),s>=c){continue}}else{if(0==r){continue}if(1==r&&(s=p.getHours(),c>s)){continue}}var v=e.clone(u,null);v.day=n.dss(p),a.splice(f++,0,v)}}for(var g=a[a.length-1],b=n.ssd(g.day);b.setMinutes(b.getMinutes()+i)<t;){if(r=b.getDay(),6==r){if(s=b.getHours(),s>=c){continue}}else{if(0==r){continue}if(1==r&&(s=b.getHours(),c>s)){continue}}var y={open:g.close,high:g.close,low:g.close,close:g.close,day:n.dss(b),prevclose:g.prevclose};"BTC"==l&&(y.volume=0),a.push(y),g=y,b=n.ssd(g.day)}},M=function(t,a,i){var o=e.market(i.hqSb),r="BTC"==o?0:("DINIW"==i.hqSb,6),s=a[a.length-1].day,l=s.split(" ")[0];if(n.stbds(t.date,l,null)){var c,h,d,u=t.prevclose,m=t.date.getHours();if(r>m){var p,f=!1;for(c=a.length;c--&&(p=!1,d=a[c],h=Number(d.day.split(" ")[1].split(":")[0]),!f&&r>h?p=!0:h>=r&&(f=!0,p=!0),p);){d.prevclose=u}}else{for(c=a.length;c--&&(d=a[c],h=Number(d.day.split(" ")[1].split(":")[0]),h>=r);){d.prevclose=u}}}},S=function(t,a){if(!t){return null}var i,o,r=Number(a.scale),s=e.market(a.hqSb);a.hqObjs&&(i=a.hqObjs[a.hqSb],o=new Date(1000*a.hqObjs[a.withsymbol].hqstr)),o||(o=new Date);var l=60*o.getTimezoneOffset()*1000;o.setTime(o.getTime()+l),o.setHours(o.getHours()+8);for(var c,h,d=0,u=t.length;u>d;d++){if(h=t[d],h.high=1*h.h,h.open=1*h.o,h.low=1*h.l,h.close=1*h.c,"BTC"==s&&(h.volume=1*h.v),r>1){var m=n.ssd(h.d);m.setMinutes(m.getMinutes()+r),h.day=n.dss(m)}else{h.day=h.d,isNaN(h.p)||(c=h.p),isNaN(c)&&(c=h.o),h.prevclose=1*c}}return k(o,t,r,a),1==r&&i&&M(i,t,a),t},I=function(e,t){return e&&e.result&&e.result.data?(e=e.result.data,S(e,t)):null},L=function(t){var n,a=t.symbol,i=t.volunit||1,o=e.market(a),r=!1;t.dataurl&&t.dataurl.length>1?n=t.dataurl:(n=c(a,!!t.ismink,t.ssl),/^(CN|HK|US)/.test(o)&&(r=!0));var s,l,h,d=a,u=a;switch(o){case"HK":d=0==a.indexOf("rt_")?a:"rt_"+a,u=d.substring(5);break;case"US":d=0==a.indexOf("gb_")?a:"gb_"+a,u=d.split("_")[1],u=u.replace("$","."),u=u.toUpperCase(),s=w;break;case"op_m":u=d.replace("P_OP_","");break;case"CN":i=0.01;break;case"forex":case"forex_yt":s=S,l=p,h=5;break;case"BTC":u=d.replace("btc_",""),s=I,l=f,h=5;break;case"OTC":u=a.replace("sb","otc_"),l=v;break;case"CFF":var N=d.split("_");u=N[N.length-1],l=g,s=b;break;case"HF":d=0==a.indexOf("hf_")?a:"hf_"+a,u=d.split("_")[1],l=y;break;case"NF":d=0==a.indexOf("nf_")?a:"nf_"+a,u=d.split("_")[1],l=m,s=w;
break;case"global_index":d=0==a.indexOf("znb_")?a:"znb_"+a,u=d.split("_")[1],l=_}return t.customksb&&(u=t.customksb),{hqSb:d,kSb:u,dayDataHandler:l,minDataHandler:s,endDay:h,kUrl:n,isCompressData:r,vu:i,market:o}},A=function(n,i){var o=L(n),r=new Date,l=[r.getFullYear(),r.getMonth()+1,r.getDate()].join("_"),c=n.scale,h=n.$scale||"$scale",d=n.datalen||828,u="_"+o.kSb.replace(/\W/g,"")+"_"+c+"_"+r.getTime(),m=function(r){var m=r?r.dataObj:void 0,p=s();t(o.kUrl.replace("$symbol",o.kSb).replace(h,c).replace("$cb","var%20"+u+"=").replace("$rn",l).replace("$datalen",d),function(){var t=window[u],r=n.dataformatter||o.minDataHandler||N;if(t=r(t,{vu:o.vu,withsymbol:n.withsymbol,hqSb:o.hqSb,hqObjs:m,scale:c})){var s={};1==c&&(/^forex/.test(o.market)||/^BTC/.test(o.market))&&(s.usePc=!0),a.pd(t,s),p.data=t}else{p.msg="error"}e.isFunc(i)&&i(p)},function(){p.msg="error",e.isFunc(i)&&i(p)},{market:o.market,symbol:o.hqSb,type:"mink"})};n.withsymbol?KKE.api("datas.hq.get",{symbol:[n.withsymbol,o.hqSb].join(","),cancelEtag:!0,ssl:n.ssl},m):m()},x=function(n,a){var o=L(n),r=function(r){var c=r?r.data[0]:void 0,h=s(),d=new Date,u=[d.getFullYear(),d.getMonth()+1,d.getDate()].join("_"),p="_"+o.kSb.replace(/\W/g,"")+u;t(o.kUrl.replace("$symbol",o.kSb).replace("$rn",u).replace("$cb","var%20"+p+"="),function(){var t;if(o.isCompressData){var r=o.kSb.replace(".","$");t=window["KLC_KL_"+r],t=i(t)}else{t=window[p];var s=n.dataformatter||o.dayDataHandler||m;t=s(t)}var d=l(t,c,n);d?h.data={hq:c,day:d[0],week:d[1],month:d[2],ytd:d[3]||null}:h.msg="error",e.isFunc(a)&&a(h)},function(){if(c){var t=l(null,c,n);t?h.data={hq:c,day:t[0],week:t[1],month:t[2],ytd:t[3]||null}:h.msg="error",e.isFunc(a)&&a(h)}else{h.msg="error",h.data={hq:c},e.isFunc(a)&&a(h)}},{market:o.market,symbol:o.hqSb,type:"k"})};"undefined"==typeof o.market||"UNKNOWN"===o.market?r():KKE.api("datas.hq.get",{symbol:o.hqSb,cancelEtag:!0,withI:!0,ssl:n.ssl},r)},R=function(t,n){var i=t.staticdata,o=s();if(t.ismink){a.pd(i,null),o.data=i}else{var r=l(i,null,t);o.data={day:r[0],week:r[1],month:r[2],ytd:r[3]||null}}e.isFunc(n)&&n(o)};this.get=function(t,n){t.staticdata?R(t,n):(t.wfn&&e.isFunc(u[t.wfn])&&(window[t.wfn]=u[t.wfn]),t.ismink?A(t,n):x(t,n))},this.loadReData=function(n,a){var i=s(),o=n.symbol,r=h(o,n.ssl),l=r.url;if(!l){return i.msg="error",void (e.isFunc(a)&&a(i))}var c=n.dir,d=r.VAR||"";d=d.replace("$symbol",o).replace("$dir",c);var u=new Date,m=u.getHours();t(l.replace("$symbol",o).replace("$dir",c).replace("$rn",m),function(){var t=window[d];window[d]=null,t&&t[0].total>0?i.data=t[0].data:i.msg="error",e.isFunc(a)&&a(i)},function(){i.msg="error",e.isFunc(a)&&a(i)},{market:r.market,symbol:o,type:"rek"})},this.loadHFInit=function(n,a){var i=s(),o=n.symbol,r=d(o,n.ssl),l=r.url,c=r.varPre,h=c+o,u=window[h];u?(i.data=u,e.isFunc(a)&&a(i)):(o=o.split("hf_")[1],t(l.replace("$cb","var%20"+h+"=").replace("$symbol",o),function(){u=window[h],u?i.data=u:(window[h]=null,i.msg="error, illegal data"),e.isFunc(a)&&a(i)},function(){i.msg="error",e.isFunc(a)&&a(i)},{market:r.market,symbol:o,type:"init_hf"}))},this.loadNFInit=function(n,a){var i=s(),o=n.symbol,r=d(o,n.ssl),l=r.url,c=r.varPre,h=c+o,u=window[h];u?(i.data=u,e.isFunc(a)&&a(i)):(o=o.match(/^nf_([a-zA-Z]+)\d+$/)[1],t(l.replace("$cb","var%20"+h+"=").replace("$symbol",o),function(){u=window[h],u?i.data=u:(window[h]=null,i.msg="error, illegal data"),e.isFunc(a)&&a(i)},function(){i.msg="error",e.isFunc(a)&&a(i)},{market:r.market,symbol:o,type:"init_nf"}))},this.loadGBInit=function(n,a){var i=s(),o=n.symbol,r=d(o,n.ssl),l=r.url,c=r.varPre,h=c+o,u=window[h];u?(i.data=u,e.isFunc(a)&&a(i)):(o=o.split("znb_")[1],t(l.replace("$cb","var%20"+h+"=").replace("$symbol",o),function(){u=window[h],u?i.data=u:(window[h]=null,i.msg="error, illegal data"),e.isFunc(a)&&a(i)},function(){i.msg="error",e.isFunc(a)&&a(i)},{market:r.market,symbol:o,type:"init_global"}))}}});