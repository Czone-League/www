xh5_define("datas.k",["utils.util","utils.utility"],function(e,e1){var t=e.load,n=e.dateUtil,a=e.kUtil,uz=e.uz,r=e.xh5_S_KLC_D,jde=((e1&&e1.jde)?e1.jde:function(a){}),o=0==location.protocol.indexOf("https:");return new function(){this.VER="2.5.14";var s={CN:{MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",DAYK_RE_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",RE_VAR:"$symbol$dirfq"},HK:{MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"},US:{MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"},option_cn:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"},op_m:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"},forex:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"},forex_yt:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb"},OTC:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb"},CFF:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb"},HF:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",INIT_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",INIT_VAR_PRE:"kke_"},NF:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",INIT_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",INIT_VAR_PRE:"kke_"},global_index:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",INIT_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb",INIT_VAR_PRE:"kke_global_index_"},BTC:{DAYK_URL:__quoteapi+"?token="+__token+"&_m=m&symbol=$symbol&scale=$scale&datalen=$datalen&cb=$cb",MINK_URL:__quoteapi+"?token="+__token+"&_m=k&symbol=$symbol&_=$rn&cb=$cb"}},l=function(){return{msg:"",data:null}},i=function(t,r,o){var s=K(o),l=o.symbol,i=o.newthour,c=1,u=s.market;"CN"==u&&(c=r&&/[gz]/.test(r.type)?10:e.isRepos(l)?10:100),t||(t=[]);var m=0/0,p="";if(r&&r.date){var b,d=r.date,h=!1;t.length>0?(b=t[t.length-1],d||(d=b.date)):h=!0,b&&("NF"==u?n.stbd(b.date,d)?1!=r.iscff&&r.withNight&&r.time>=i?h=!0:r.open&&r.price&&(b.open=r.open,b.high=r.high,b.low=r.low,b.close=r.price,b.volume=r.totalVolume*c):d<b.date||(h=!0):n.stbd(b.date,d)?r.date&&r.open&&r.price&&(b.open=r.open,b.high=r.high,b.low=r.low,b.close=r.price,b.volume=r.totalVolume*c,b.date=n.ddt(d)):d<b.date||(h=i?r.time>=i:!0)),h&&t.push({open:r.open,high:r.high,low:r.low,close:r.price,volume:r.totalVolume*c,date:n.ddt(d)}),m=r.issueprice,p=r.name}if(t.length<1){return[t,void 0,void 0,void 0]}var f=!isNaN(m)&&m>0?m:t[0].open;e.oc(t[0],{prevclose:f,name:p,symbol:l});var v=a.mw(t,r,f,c,s.endDay),y=v[0],g=v[1],_=void 0;if(a.pd(t,null),a.pd(y,null),a.pd(g,null),r&&r.settlement){var k=t[t.length-1];k.ampP=k.amplitude/r.settlement,k.change=k.close-r.settlement,k.percent=k.change/r.settlement}return e.oc(y[0],{name:p,symbol:l}),e.oc(g[0],{name:p,symbol:l}),o.ytd&&(_=a.yd(t),e.oc(_[0],{name:p,symbol:l})),[t,y,g,_]},c=function(t,n,a){var r=e.market(t),l=r?s[r][n?"MINK_URL":"DAYK_URL"]:null;return(o||a)&&(l=e.getSUrl(l)),l},u=function(t,n){var a,r,l=e.market(t);return s[l]&&(a=s[l].DAYK_RE_URL,r=s[l].RE_VAR),a&&(o||n)&&(a=e.getSUrl(a)),{url:a,VAR:r,market:l}},m=function(t,n){var a,r,l,i=e.market(t);return s[i]&&(a=s[i].INIT_URL,r=s[i].INIT_VAR,l=s[i].INIT_VAR_PRE),a&&(o||n)&&(a=e.getSUrl(a)),{url:a,VAR:r,varPre:l,market:i}},p={xh5Fund:function(e){for(var t,n,a,r,o=new Date,s=[o.getFullYear(),o.getMonth()+1,o.getDate()].join("_"),l=e.data,i=e.symbol,c=l.split("#"),u=[],m=[],p=[],b=[],d=[],h=[],f=c.length;f--;){r=c[f].split(","),t=r[0].slice(0,4),n=r[0].slice(4,6),a=r[0].slice(6,8),a=[t,n,a].join("-"),u.push({d:a,c:r[1]}),m.push({d:a,c:r[2]}),p.push({d:a,c:r[3]}),b.push({d:a,c:r[4]}),d.push({d:a,c:r[5]}),h.push({d:a,c:r[6]})}var v=["_dwjz_",i,s].join(""),y=["_ljjz_",i,s].join(""),g=["_lshb_",i,s].join(""),_=["_pwbfbyd_",i,s].join(""),k=["_pwbfbjd_",i,s].join(""),w=["_pwbfbnd_",i,s].join(""),N=["_fh_",i,s].join("");window[v]=u,window[y]=m,window[g]=p,window[_]=b,window[k]=d,window[w]=h,window[N]={fhday:e.fhday,fhvalue:e.fhvalue,fhchaifen:e.fhchaifen}
}},b=function(e){var t=[];if(e){for(var n,a,r=0,o=e.length;o>r;r++){a=e[r],n=Number(a.c);var s=a.d.split("-");t.push({close:n,open:Number(a.o)||n,high:Number(a.h)||n,low:Number(a.l)||n,volume:Number(a.v)||0,date:new Date(Number(s[0]),Number(s[1])-1,Number(s[2]),0)})}}return t},d=function(e){var t=[];if(e){for(var n,a,r=e.split("|"),o=0,s=r.length;s>o;o++){n=r[o].split(","),n.length<5||(a=n[0].split("-"),t.push({open:Number(n[1]),low:Number(n[2]),high:Number(n[3]),close:Number(n[4]),volume:Number(n[5]),date:new Date(Number(a[0]),Number(a[1])-1,Number(a[2]),0)}))}}return t},h=function(e){var t=[];if(e&&e.result&&e.result.data){for(var n,a,r=e.result.data,o=r.split("|"),s=0,l=o.length;l>s;s++){n=o[s].split(","),n.length<5||(a=n[0].split("-"),t.push({open:Number(n[1]),low:Number(n[2]),high:Number(n[3]),close:Number(n[4]),volume:Number(n[5]),date:new Date(Number(a[0]),Number(a[1])-1,Number(a[2]),0)}))}}return t},f=function(e){var t=[];if(e&&e.length){for(var n,a,r=0.001,o=e.split("|"),s=0,l=0,i=o.length;i>l;l++){n=o[l].split(","),n.length<5||(a=n[0].split("-"),s=Number(n[4])||s,t.push({open:Number(n[1])||s,low:Number(n[2])||s,high:Number(n[3])||s,close:Number(n[4])||s,volume:Number(n[5])*r,date:new Date(Number(a[0]),Number(a[1])-1,Number(a[2]),0)}))}}return t},v=function(e){var t=[];if(e){for(var n,a,r,o=0,s=e.length;s>o;o++){n=e[o],a=n[0].split("-"),r=Number(n[4]),t.push({date:new Date(Number(a[0]),Number(a[1])-1,Number(a[2]),0),open:Number(n[1])||r,high:Number(n[2])||r,low:Number(n[3])||r,close:r,volume:Number(n[5])||0})}}return t},y=function(e){var t=[];if(e){for(var n,a,r=e.length;r--;){n=e[r],a=Number(n[4]),t.push({day:n[0],open:Number(n[1])||a,high:Number(n[2])||a,low:Number(n[3])||a,close:a,volume:Number(n[5])||0})}}return t},g=function(e){var t=[];if(e){for(var a,r,o=0,s=e.length;s>o;o++){a=e[o],r=Number(a.close),t.push({date:n.sd(a.date),volume:Number(a.volume),open:Number(a.open)||r,high:Number(a.high)||r,low:Number(a.low)||r,close:r})}}return t},_=function(e,t){if(!e){return null}for(var n,a=t.vu||1,r=0,o=e.length;o>r;r++){n=e[r],n.high*=1,n.open*=1,n.low*=1,n.close*=1,n.volume*=a}return e},k=function(e){if(!e){return null}for(var t,a=0,r=e.length;r>a;a++){t=e[a],t.high=1*t.h,t.open=1*t.o,t.low=1*t.l,t.close=1*t.c,t.volume=1*t.v,t.day=t.d,t.date=n.sd(t.d)}return e},w=function(e){if(!e){return null}for(var t,a=0,r=e.length;r>a;a++){t=e[a],t.high=1*t.h,t.open=1*t.o,t.low=1*t.l,t.close=1*t.c,t.volume=1*t.v,t.date=n.sd(t.d)}return e},N=function(t,a,r,o){for(var v=a[a.length-1],y=n.ssd(v.day);y.setMinutes(y.getMinutes()+r)<t;){if(s=y.getDay(),6==s){if(l=y.getHours(),l>=c){continue}}else{if(0==s){continue}if(1==s&&(l=y.getHours(),c>l)){continue}}var g={open:v.close,high:v.close,low:v.close,close:v.close,day:n.dss(y),prevclose:v.prevclose};"BTC"==i&&(g.volume=0),a.push(g),v=g,y=n.ssd(v.day)}},$=function(t,a,r){var o=e.market(r.hqSb),s="BTC"==o?0:("DINIW"==r.hqSb,6),l=a[a.length-1].day,i=l.split(" ")[0];if(n.stbds(t.date,i,null)){var c,u,m,p=t.prevclose,b=t.date.getHours();if(s>b){var d,h=!1;for(c=a.length;c--&&(d=!1,m=a[c],u=Number(m.day.split(" ")[1].split(":")[0]),!h&&s>u?d=!0:u>=s&&(h=!0,d=!0),d);){m.prevclose=p}}else{for(c=a.length;c--&&(m=a[c],u=Number(m.day.split(" ")[1].split(":")[0]),u>=s);){m.prevclose=p}}}},D=function(t,a){if(!t){return null}var r,o,s=Number(a.scale),l=e.market(a.hqSb);a.hqObjs&&(r=a.hqObjs[a.hqSb],o=new Date(1000*a.hqObjs[a.withsymbol].hqstr)),o||(o=new Date);var i=60*o.getTimezoneOffset()*1000;o.setTime(o.getTime()+i),o.setHours(o.getHours()+8);for(var c,u,m=0,p=t.length;p>m;m++){if(u=t[m],u.high=1*u.h,u.open=1*u.o,u.low=1*u.l,u.close=1*u.c,(u.volume=1*u.v),s>1){var b=n.ssd(u.d);b.setMinutes(b.getMinutes()+s),u.day=n.dss(b)}else{u.day=u.d,isNaN(u.p)||(c=u.p),isNaN(c)&&(c=u.o),u.prevclose=1*c}}return N(o,t,s,a),1==s&&r&&$(r,t,a),t},R=function(e,t){return e&&e.result&&e.result.data?(e=e.result.data,D(e,t)):null},K=function(t){var n,a=t.symbol,r=t.volunit||1,o=e.market(a),s=!1;t.dataurl&&t.dataurl.length>1?n=t.dataurl:(n=c(a,!!t.ismink,t.ssl),/^(CN|HK|US)/.test(o)&&(s=!0));var l,i,u,m=a,p=a;switch(o){case"HK":m=0==a.indexOf("rt_")?a:"rt_"+a,p=m.substring(5);break;case"US":m=0==a.indexOf("gb_")?a:"gb_"+a,p=m.split("_")[1],p=p.replace("$","."),p=p.toUpperCase(),l=k;break;case"op_m":p=m.replace("P_OP_","");break;case"CN":r=0.01;break;case"forex":case"forex_yt":l=D,i=d,u=5;break;case"BTC":p=m.replace("btc_",""),l=R,i=h,u=5;break;case"OTC":p=a.replace("sb","otc_"),i=f;break;case"CFF":var _=m.split("_");p=_[_.length-1],i=v,l=y;break;case"HF":m=0==a.indexOf("hf_")?a:"hf_"+a,p=m.split("_")[1],i=g;break;case"NF":m=0==a.indexOf("nf_")?a:"nf_"+a,p=m.split("_")[1],i=b,l=k;break;case"global_index":m=0==a.indexOf("znb_")?a:"znb_"+a,p=m.split("_")[1],i=w}return t.customksb&&(p=t.customksb),{hqSb:m,kSb:p,dayDataHandler:i,minDataHandler:l,endDay:u,kUrl:n,isCompressData:s,vu:r,market:o}},jdc=function(a,m){return jde(a)},S=function(n,r){var o=K(n),s=new Date,i=[s.getFullYear(),s.getMonth()+1,s.getDate()].join("_"),c=n.scale,u=n.$scale||"$scale",m=n.datalen||828,p="_"+o.kSb.replace(/\W/g,"")+"_"+c+"_"+s.getTime(),b=function(s){var b=s?s.dataObj:void 0,d=l();
t(o.kUrl.replace("$symbol",o.kSb).replace(u,c).replace("$cb","var%20"+p+"=").replace("$rn",i).replace("$datalen",m),function(){var t=window[p],s=n.dataformatter||o.minDataHandler||_;t=JSON.parse(jde(t,36,uz));if(t=s(t,{vu:o.vu,withsymbol:n.withsymbol,hqSb:o.hqSb,hqObjs:b,scale:c})){var l={};1==c&&(/^forex/.test(o.market)||/^BTC/.test(o.market))&&(l.usePc=!0),a.pd(t,l),d.data=t}else{d.msg="error"}e.isFunc(r)&&r(d)},function(){d.msg="error",e.isFunc(r)&&r(d)},{market:o.market,symbol:o.hqSb,type:"mink"})};n.withsymbol?KKE.api("datas.hq.get",{symbol:[n.withsymbol,o.hqSb].join(","),cancelEtag:!0,ssl:n.ssl},b):b()},F=function(n,a){var o=K(n),s=function(s){var c=s?s.data[0]:void 0,u=l(),m=new Date,p=[m.getFullYear(),m.getMonth()+1,m.getDate()].join("_"),d="_"+o.kSb.replace(/\W/g,"")+p;t(o.kUrl.replace("$symbol",o.kSb).replace("$rn",p).replace("$cb","var%20"+d+"="),function(){var t;if(o.isCompressData){var s=o.kSb.replace(".","$");t=window["KLC_KL_"+s],window["KLC_KL_"+s]=null,t=r(t)}else{t=window[d];window[d]=null;var l=n.dataformatter||o.dayDataHandler||b;t=jde(t,36,uz);t=l(t)}var m=i(t,c,n);m?u.data={hq:c,day:m[0],week:m[1],month:m[2],ytd:m[3]||null}:u.msg="error",e.isFunc(a)&&a(u)},function(){if(c){var t=i(null,c,n);t?u.data={hq:c,day:t[0],week:t[1],month:t[2],ytd:t[3]||null}:u.msg="error",e.isFunc(a)&&a(u)}else{u.msg="error",u.data={hq:c},e.isFunc(a)&&a(u)}},{market:o.market,symbol:o.hqSb,type:"k"})};"undefined"==typeof o.market||"UNKNOWN"===o.market?s():KKE.api("datas.hq.get",{symbol:o.hqSb,cancelEtag:!0,withI:!0,ssl:n.ssl},s)},I=function(t,n){var r=t.staticdata,o=l();if(t.ismink){a.pd(r,null),o.data=r}else{var s=i(r,null,t);o.data={day:s[0],week:s[1],month:s[2],ytd:s[3]||null}}e.isFunc(n)&&n(o)};this.get=function(t,n){t.staticdata?I(t,n):(t.wfn&&e.isFunc(p[t.wfn])&&(window[t.wfn]=p[t.wfn]),t.ismink?S(t,n):F(t,n))},this.loadReData=function(n,a){var r=l(),o=n.symbol,s=u(o,n.ssl),i=s.url;if(!i){return r.msg="error",void (e.isFunc(a)&&a(r))}var c=n.dir,m=s.VAR||"";m=m.replace("$symbol",o).replace("$dir",c);var p=new Date,b=p.getHours();t(i.replace("$symbol",o).replace("$dir",c).replace("$rn",b),function(){var t=window[m];window[m]=null,t&&t[0].total>0?r.data=t[0].data:r.msg="error",e.isFunc(a)&&a(r)},function(){r.msg="error",e.isFunc(a)&&a(r)},{market:s.market,symbol:o,type:"rek"})},this.loadHFInit=function(n,a){var r=l(),o=n.symbol,s=m(o,n.ssl),i=s.url,c=s.varPre,u=c+o,p=window[u];p?(r.data=p,e.isFunc(a)&&a(r)):(o=o.split("hf_")[1],t(i.replace("$cb","var%20"+u+"=").replace("$symbol",o),function(){p=window[u],p?r.data=p:(window[u]=null,r.msg="error, illegal data"),e.isFunc(a)&&a(r)},function(){r.msg="error",e.isFunc(a)&&a(r)},{market:s.market,symbol:o,type:"init_hf"}))},this.loadNFInit=function(n,a){var r=l(),o=n.symbol,s=m(o,n.ssl),i=s.url,c=s.varPre,u=c+o,p=window[u];p?(r.data=p,e.isFunc(a)&&a(r)):(o=o.match(/^nf_([a-zA-Z]+)\d+$/)[1],t(i.replace("$cb","var%20"+u+"=").replace("$symbol",o),function(){p=window[u],p?r.data=p:(window[u]=null,r.msg="error, illegal data"),e.isFunc(a)&&a(r)},function(){r.msg="error",e.isFunc(a)&&a(r)},{market:s.market,symbol:o,type:"init_nf"}))},this.loadGBInit=function(n,a){var r=l(),o=n.symbol,s=m(o,n.ssl),i=s.url,c=s.varPre,u=c+o,p=window[u];p?(r.data=p,e.isFunc(a)&&a(r)):(o=o.split("znb_")[1],t(i.replace("$cb","var%20"+u+"=").replace("$symbol",o),function(){p=window[u],p?r.data=p:(window[u]=null,r.msg="error, illegal data"),e.isFunc(a)&&a(r)},function(){r.msg="error",e.isFunc(a)&&a(r)},{market:s.market,symbol:o,type:"init_global"}))}}});xh5_define("chart.h5k",["cfgs.settinger","utils.util","utils.painter"],function(e,t,n){function a(a){function i(e,n){function i(e){O.setDataRange(e),y&&(y.linkData(e),y.setDataRange()),N&&(N.linkData(e),N.setDataRange()),_&&(_.linkData(e),_.setDataRange())}function l(e,t){var n,a,i=D.get(w.URLHASH.KD),o=i.length;e||(n=0),t||(a=o-1);for(var r=0;o>r&&(isNaN(n)&&i[r].date>=e&&(n=r),isNaN(a)&&i[r].date>=t&&(a=r),isNaN(n)||isNaN(a));r++){}return[n,a]}function c(){n&&(T=D),P.uUpdate(null,!0),"CN"!==u||/^(sh0|sh1|sh5|sz1|sz399)\d+/i.test(e.symbol)||D.initExtraData()}e=m({symbol:void 0,datas:{day:{wfn:void 0,url:void 0,dataformatter:void 0,staticdata:void 0},min:{wfn:void 0,url:void 0,dataformatter:void 0,staticdata:void 0}}},e||{});var h=this,u=t.market(e.symbol),g=!0;this.isErr=!1,this.symbol=e.symbol,this.market=u;var b;switch(u){case"forex":case"forex_yt":"DINIW"==this.symbol,b="06:00";break;case"BTC":b="00:00";break;default:b="09:30"}this.isMain=n,this.isCompare=!1,this.datas=null,this.dataLen=0,this.nfloat=e.nfloat||2,this.dataLenOffset=0,this.prevclose=0/0,this.labelMaxP=0,this.labelMinP=Number.MAX_VALUE,this.maxPrice=0,this.minPrice=Number.MAX_VALUE,this.rangeMax=0,this.rangeMin=Number.MAX_VALUE,this.labelMaxVol=0,this.maxVolume=0,this.minPercent=Number.MAX_VALUE,this.maxPercent=-Number.MAX_VALUE,this.labelPriceCount=0/0,this.isTotalRedraw=!0,this.hq=void 0,this.nco=void 0;var y,N,_,M=new k(this,e),A=e.name;this.getName=function(){return A||""},this.viewState=z;
var D=new function(){var i,o={},r={rsAmount:void 0},s=function(e,a,r,s,l){if(a){if(n){if(e==w.URLHASH.KD&&(i=t.clone(a,null)),s&&window.datelist&&h.hq){var c=t.xh5_S_KLC_D(window.datelist);a=t.kUtil.ayd(a,c,!1,a[0].date,h.hq.date)}}else{l||(e==w.URLHASH.KD&&(i=t.clone(a,null)),a=t.kUtil.adbd(a,T.get(e),r,!1))}o["k"+e]=a;var d=a.length,u=s?I.PARAM.K_CL_NUM:I.PARAM.defaultCandleNum;o["k"+e+"v"]=d>u?d-u:0,o["k"+e+"b"]=d}},l=function(){var e=z.viewId;switch(e){case w.URLHASH.KDF:case w.URLHASH.KDB:e=w.URLHASH.KD;break;case w.URLHASH.KWF:case w.URLHASH.KWB:e=w.URLHASH.KW;break;case w.URLHASH.KMF:case w.URLHASH.KMB:e=w.URLHASH.KM;break;case w.URLHASH.KCLF:case w.URLHASH.KCLB:e=w.URLHASH.KCL}return e};this.get=function(e){if(t.isStr(e)){var n=l();return o["k"+n+e]}return o["k"+(e||z.viewId)]},this.set=function(e,t){var n=l(),a="k"+n+e;"undefined"!=typeof o[a]&&(o[a]=t)},this.getOriDK=function(){return i},this.initState=s,this.initDWMState=function(e,n){var a=t.clone(n.day,null);s(w.URLHASH.KD,n.day),s(w.URLHASH.KW,n.week),s(w.URLHASH.KM,n.month),s(w.URLHASH.KCL,a,!1,!0)},this.extraDataObj=r,this.initExtraData=function(){var n="";a.ssl&&(n=t.getSUrl(n));var i="KKE_ShareAmount_"+e.symbol;t.load(n.replace("$symbol",e.symbol).replace("$rn",String((new Date).getDate())).replace("$cb","var%20"+i+"="),function(){var e=window[i];if(e){for(var t,n=[],a=e.length;a--;){t=e[a],n.push({amount:Number(t.amount),date:p.sd(t.date)})}n.length&&(r.rsAmount=n)}})},this.gc=function(){o=null,r=null}},O=new function(){var e=function(){h.minPrice=Number.MAX_VALUE,h.maxPrice=0,h.minPercent=Number.MAX_VALUE,h.maxPercent=-Number.MAX_VALUE,h.maxVolume=0,h.rangeMax=0,h.rangeMin=Number.MAX_VALUE},t=function(){for(var e,t=0,n=h.dataLen;n>t;t++){e=h.datas[t],e.close<=0||(e.high>h.maxPrice&&(h.maxPrice=h.rangeMax=e.high),e.low<h.minPrice&&(h.minPrice=h.rangeMin=e.low),h.maxVolume=Math.max(h.maxVolume,e.volume))}var a=v(h.maxVolume,0,0,!0);h.labelMaxVol=a[0],h.maxPercent=Math.max((h.maxPrice-h.prevclose)/h.prevclose,0),h.minPercent=Math.min((h.minPrice-h.prevclose)/h.prevclose,0)};this.createPlayingData=function(){var e,t,n=I.DIMENSION.h_k,a=n*I.DIMENSION.P_HV,i=n*(1-I.DIMENSION.P_HV);e=h.labelMinP,t=h.labelMaxP;for(var o,r=h.labelMaxVol,s=h.prevclose,l=h.isTotalRedraw?0:h.dataLen-h.dataLenOffset,c=I.custom.show_underlay_vol,u=h.isCompare?"ppp":"pp",m=h.dataLen;m>l;l++){o=h.datas[l],o.cy=d[u](o.close,e,t,n,s),o.oy=d[u](o.open,e,t,n,s),o.hy=d[u](o.high,e,t,n,s),o.ly=d[u](o.low,e,t,n,s),c&&(o.vy=d.vp(o.volume,r,a)+i)}},this.setDataRange=function(n){var i=D.get();if(i){z.dataLength=i.length;var o=z.start,r=z.end;if(isNaN(o)||isNaN(r)){r=D.get("b"),o=D.get("v"),z.start=o,z.end=r}else{if(n&&r+1>=i.length){var s=i.length-r;z.end=r=i.length,(1==a.pcm||z.viewId==w.URLHASH.K1)&&(0==o&&r>1&&r<I.PARAM.minCandleNum&&(o=r-1,z.start=o),r-o>=I.PARAM.defaultCandleNum&&(o+=s,z.start=o))}D.set("v",o),D.set("b",r)}switch(z.currentLength=r-o,z.startDate=i[o].date,z.endDate=i[r-1].date,a.pcm){case 1:h.prevclose=i[0].prevclose;break;case 2:h.prevclose=i[o].close;break;default:h.prevclose=o>1?i[o-1].close:i[0].prevclose||i[0].close}h.datas=i.slice(o,r),h.dataLen=h.datas.length,e(),t(n)}}},P=new function(){var o,r=function(e){return o?(e.volume=e.totalVolume-(o.totalVolume||0),e.amount=e.volume*e.price):(o={},e.volume=0),o.totalVolume=e.totalVolume,e.avg_price=e.totalAmount/e.totalVolume||e.price,!0},s=!1,l=function(e,n,a){if(e.isUpdateTime){var i=D.get(n);if(i&&!(i.length<1)){var o=n==w.URLHASH.KD||n==w.URLHASH.KDF||n==w.URLHASH.KCL||n==w.URLHASH.KCLF,r=i[i.length-1];if(1==a){if(r.time&&!t.kUtil.spk(r.time,e.time,b,n,h.market)){if(t.kUtil.nc(i,e,n,{price:e.price,volume:e.volume}),/^forex|^BTC/.test(h.market)){n==w.URLHASH.K1&&(r=i[i.length-1],r.prevclose=e.prevclose,r.change=e.price-e.prevclose,r.percent=r.change/e.prevclose)}else{if("NF"==h.market){}else{if(t.kUtil.spk("09:35",e.time,b,n)){if(n==w.URLHASH.K60){var l=e.time.split(":"),c=l[0],d=l[1];if(c>10||10==c&&d>30){return}}r=i[i.length-1],r.open=e.open,r.open>r.high&&(r.high=r.open),r.open<r.low&&(r.low=r.open)}}}return}}else{if(2==a){if(!e.trstr){return}t.kUtil.nc(i,e,n,{price:e.price,volume:0})}else{if(f(e.date,r.date)){h.nco&&("NF"==h.market?p.dst(r.date)<h.nco.open&&e.time>=h.nco.open&&e.time>h.nco.close&&t.kUtil.nc(i,e,n,null):s&&e.time>=h.nco.open&&(s=!1,t.kUtil.nc(i,e,n,null)))}else{if(!(e.date>r.date)){return}h.nco?"NF"==h.market?e.time>=h.nco.open&&t.kUtil.nc(i,e,n,null):e.time<=h.nco.close&&(s=!0):t.kUtil.nc(i,e,n,null)}}}r=i[i.length-1],r.close=e.price,r.date=p.ddt(e.date),r.day=p.ds(r.date,"/"),n==w.URLHASH.KMS?(r.volume=e.trvolume||0,r.amount=e.tramount||0,r.trbs=e.trbs,r.kke_cs=0==e.trbs?-1:1):(o?(r.open=e.open,r.high=e.high,r.low=e.low,r.volume=e.totalVolume):isNaN(r.volume)?r.volume=e.volume:r.volume+=Number(e.volume),r.kke_cs=r.close>r.open?1:r.open>r.close?-1:0);var u;1==i.length?u=o?e.prevclose:r.open:(u=i[i.length-2].close,e.settlement&&o&&(u=e.settlement)),/^forex|^BTC/.test(h.market)&&(n==w.URLHASH.K1||n==w.URLHASH.KD)&&(u=e.prevclose),r.change=e.price-u,r.percent=r.change/u,e.price>r.high&&(r.high=e.price),e.price<r.low&&(r.low=e.price),r.amplitude=r.high-r.low,r.ampP=r.amplitude/u,r.time=e.time
}}},c=function(e){l(e,w.URLHASH.KD,0),l(e,w.URLHASH.KW,0),l(e,w.URLHASH.KM,0),l(e,w.URLHASH.KDF,0),l(e,w.URLHASH.KWF,0),l(e,w.URLHASH.KMF,0),l(e,w.URLHASH.KCL,0),l(e,w.URLHASH.KCLF,0),l(e,w.URLHASH.K1,1),l(e,w.URLHASH.K5,1),l(e,w.URLHASH.K15,1),l(e,w.URLHASH.K30,1),l(e,w.URLHASH.K60,1),l(e,w.URLHASH.K240,1),l(e,w.URLHASH.KMS,2)},d=new function(){this.check=function(e){if(n){return !0}var a=z.viewId,i=T.get(a);if(!i||i.length<1){return !1}var o=i[i.length-1];if(e.date>o.date){if("mink"==w.URLHASH.gt(z.viewId).type){if(!t.kUtil.spk(o.time,e.time,"00:00",a,h.market)){return !1}}else{if(!f(e.date,o.date)){return !1}}}return !0}};this.uUpdate=function(n,o,s,l){var u,m={symbol:e.symbol,ssl:a.ssl};s?(u="datas.hq.parse",m.hqStr=s,m.market=l):(u="datas.hq.get",m.delay=!0,m.cancelEtag=o),KKE.api(u,m,function(a){var o=a.dataObj[e.symbol];if(o&&o.date&&r(o)){if(A=A||o.name||"",!d.check(o)){return}h.hq=o,c(o),i(!0),t.isFunc(n)&&n()}})}},$=new function(){var i,o=function(e,n){S.re(w.e.K_DATA_LOADED,n),t.isFunc(e)&&e()},r=function(e){if(!h.hq||!h.hq.date){return null}for(var t=p.ddt(h.hq.date),n="_"+p.ds(t,"_"),a=!0;!Number(e[n]);){a=!1;var i=t.getDate();t.setDate(--i),n="_"+p.ds(t,"_")}var o=Number(e[n]);return{latestFactor:o,isToday:a,factorDate:t}},s=function(e,a,i){var o=e.latestFactor,r=e.isToday,s=e.factorDate;if(o){var l,c,d,u,m,f,v,g,b,y,N,_,k=-828==o,M=D.getOriDK();if("q"==i){if(c=w.URLHASH.KDF,D.initState(c,t.clone(M,null),!1,!1,!0),l=D.get(c),_=l.length,!k){var S=(r?h.hq.price:h.hq.prevclose)/o;for(y=l.length;y--;){var I=l[y];if(t.dateUtil.stbd(I.date,s)){S=I.close/o;break}}for(y=0;_>y;y++){v=l[y],g="_"+p.ds(v.date,"_"),b=Number(a[g]);var L=v.close;isNaN(b)?b=L/S:v.close=S*b,N=v.close/L,v.high=v.high*N,v.low=v.low*N,v.open=v.open*N,0==y&&(f=v.prevclose,isNaN(f)||0>=f?f=v.open:(f=v.prevclose*N,v.prevclose=f)),v.amplitude=v.high-v.low,v.ampP=v.amplitude/f,v.change=v.close-f,v.percent=v.change/f,f=v.close}}}else{if(c=w.URLHASH.KDB,D.initState(c,t.clone(M,null),!1,!1,!0),l=D.get(c),_=l.length,!k){for(y=0;_>y;y++){if(v=l[y],g="_"+p.ds(v.date,"_"),b=Number(a[g]),isNaN(b)){if(0>=y){continue}var A=l[y-1];b=v.percent*A.close+A.close}N=b/v.close,v.close=b,v.high=v.high*N,v.low=v.low*N,v.open=v.open*N,0==y&&(f=v.prevclose,isNaN(f)||0>=f?f=v.open:(f=v.prevclose*N,v.prevclose=f)),v.amplitude=v.high-v.low,v.ampP=v.amplitude/f,v.change=v.close-f,v.percent=v.change/f,f=v.close}}}var x;1==_&&(v=l[_-1],x={open:v.open,high:v.high,low:v.low,close:v.close,price:v.close,volume:v.volume,totalVolume:v.volume,date:p.dd(v.date)}),d=t.kUtil.mw(l,x,null,null,0/0),m=d[0],u=d[1],t.kUtil.pd(m,null),t.kUtil.pd(u,null),D.initState(w.URLHASH["q"==i?"KWF":"KWB"],m),D.initState(w.URLHASH["q"==i?"KMF":"KMB"],u);var R=t.clone(l,null);D.initState(w.URLHASH["q"==i?"KCLF":"KCLB"],R,!1,!0),n||D.initState(c,l)}},l=function(t){var n=w.URLHASH.gt(z.viewId),i=n.dir,l={symbol:e.symbol,dir:i,ssl:a.ssl};F.show(),KKE.api("datas.k.loadReData",l,function(e){F.hide();var n=!0,a=e.data;if(a){var l=r(a);l&&(n=!1,s(l,a,i))}n&&s({latestFactor:-828,isToday:!1,factorDate:null},null,i),o(t,{viewId:z.viewId})})},c=function(e,t){var a=w.URLHASH.gt(i),r="mink"==a.type?D.initState:D.initDWMState;F.show(),KKE.api("datas.k.get",e,function(s){F.hide();var l=i;if(i=0/0,"error"==s.msg){if(h.isErr=!0,n){if(s.data&&s.data.hq){var c;if(s.data.hq.status){switch(s.data.hq.status){case 2:c=w.notlisted;break;case 3:c=w.delisted}}else{c=w.norecord}c&&q.showTip({txt:c,parent:x,noBtn:!0})}else{q.showTip({txt:w.nodata,parent:x})}}}else{s.data.hq&&(h.hq=s.data.hq),r(a.baseid,s.data,e.ismink)}o(t,{viewId:l})})},d=function(t){KKE.api("datas.hq.get",{symbol:e.symbol,cancelEtag:!0,ssl:a.ssl},function(n){var a=n.dataObj[e.symbol],i=[{close:a.price,open:a.open,high:a.high,low:a.low,volume:0,prevclose:a.prevclose,amplitude:a.high-a.low,ampP:(a.high-a.low)/a.prevclose,change:a.price-a.prevclose,date:a.date,day:p.ds(a.date,"/"),time:a.time,percent:a.price-a.prevclose/a.prevclose,kke_cs:0}];D.initState(z.viewId,i,!0),o(t,{viewId:z.viewId})})},u=function(t){var n,i,o=z.viewId,r=w.URLHASH.gt(o);if(h.nco&&h.nco.open){i=h.nco.open,b=i}else{var s=new Date,l=b.split(":");s.setHours(l[0],l[1],0),s.setMinutes(s.getMinutes()-30),i=p.dst(s)}var d={symbol:e.symbol,newthour:i,ssl:a.ssl};if("mink"==r.type){if(n=e.datas.min,d.ismink=!0,d.scale=o,/^forex|^BTC/.test(h.market)){switch(d.withsymbol="sys_time",o){case w.URLHASH.K1:d.datalen=1440;break;case w.URLHASH.K240:d.datalen=parseInt(60/o*24*10);break;default:d.datalen=parseInt(60/o*24*5)}}}else{n=e.datas.day}d.dataurl=n.url,d.dataformatter=n.dataformatter,d.wfn=n.wfn,d.staticdata=n.staticdata,c(d,t)},m=function(t){var n={symbol:e.symbol,ssl:a.ssl},i="datas.k.";i+="loadGBInit",h.nco={open:"15:00",close:"23:30"},KKE.api(i,n,function(e){var n=e.data;if(n){var a=n.time;a&&a.length>0&&(h.nco.open=a[0][0]||h.nco.open,h.nco.close=a[a.length-1][1]||h.nco.close)}u(t)})},f=function(t,n){var i={symbol:e.symbol,ssl:a.ssl},o="datas.k.";n?(o+="loadNFInit",h.nco={open:"09:00",close:"15:00"}):(o+="loadHFInit",h.nco={open:"06:00",close:"05:59"}),KKE.api(o,i,function(e){var n=e.data;
if(n){var a=n.time;a&&a.length>0&&(h.nco.open=a[0][0]||h.nco.open,h.nco.close=a[a.length-1][1]||h.nco.close)}u(t)})},v=function(e,t){var n=new Date,a=b.split(":");n.setHours(a[0],a[1],0),n.setMinutes(n.getMinutes()-1);var i=p.dst(n);h.nco={open:b,close:i},"rek"==t.type&&D.get(w.URLHASH.KD)?l(e):u(e)};this.iInit=function(e){var t=z.viewId;if(i!=t){i=t;var n=w.URLHASH.gt(t);switch(h.market){case"HF":f(e);break;case"NF":f(e,!0);break;case"global_index":m(e);break;case"forex":case"forex_yt":case"BTC":v(e,n);break;default:"msk"==n.type?d(e):"rek"==n.type&&D.get(w.URLHASH.KD)?l(e):u(e)}}}};this.kDb=D,this.extraDataObj=D.extraDataObj,this.getYtdIndex=function(e){var t=D.get(w.URLHASH.KD);if(!t){return null}var n=t[t.length-1],a=n.date.getFullYear(),i=0;return e&&(a--,i=n.date.getMonth()),l(new Date(a,i,1))},this.initData=$.iInit,this.doUpdate=P.uUpdate,this.onViewChange=i,this.setPricePos=function(e,t){h.labelMaxP=e[0],h.labelMinP=e[1],h.labelPriceCount=e[2],h.isCompare=t,O.createPlayingData(),N&&N.setPricePos(e)},this.setRange=function(e){O.setDataRange(),y&&y.setDataRange(),N&&N.setDataRange(),_&&_.setDataRange(e)},this.draw=function(){M.draw(),y&&y.allDraw(V.x),N&&N.allDraw(V.x)},this.resize=function(e){O.createPlayingData(),M.resize(),y&&y.onResize(e),N&&N.onResize(),_&&_.onResize()},this.clear=function(e){M.clear(e),y&&(y.clear(),y=null),N&&(N.clear(),N=null),_&&(_.clear(),_=null),n&&(U=null)},this.getPriceTech=function(){return N||null};var W=function(e,n,a){e&&Y.resizeAll(!0),L.onChangeView(),n&&t.isFunc(n.callback)&&n.callback(),a&&j.onTechChanged(a[0])},X=void 0;this.initPt=function(e,i){if(e){!t.isArr(e)&&(e=[e]);for(var o=e.length;o--;){if(e[o].name&&"VOLUME"===e[o].name.toUpperCase()){e.splice(o,1),I.custom.show_underlay_vol=!0;break}}N||(N=new r({iMgr:B,stockData:h,chartArea:R,titleArea:C,cb:W,cfg:I,type:"k",usrObj:a}),n&&(K=N),X&&(g=N.showHide(X),X=void 0)),N.createChart(e,i)}},this.removePt=function(e){if(e){!t.isArr(e)&&(e=[e]);for(var n=e.length;n--;){if(e[n].name&&"VOLUME"===e[n].name.toUpperCase()){e.splice(n,1),I.custom.show_underlay_vol=!1;break}}}else{I.custom.show_underlay_vol=!1}N&&N.removeChart(e)},this.togglePt=function(e,t){N?g=N.showHide(e):!t&&(X=e)},this.initTc=function(e,t){y||(y=new s({stockData:h,iMgr:B,cb:W,subArea:H,cfg:I,type:"k",usrObj:a,initMgr:Y}),n&&(E=y)),y.createChart(e,t)},this.removeTc=function(e){y&&y.removeChart(e)},this.initRs=function(){_=new o({stockData:h,setting:I,rc:L.moving}),_.linkData(),U=_},this.setLineStyle=M.setLineStyle,this.getLineStyle=M.getLineStyle,c()}function k(e,a){function i(){if(y){s=I.COLOR.K_N,r=I.COLOR.K_FALL,l=I.COLOR.K_RISE,c=I.COLOR.K_CL}else{var a=o.linecolor,i=a.K_N||"#"+t.randomColor();s=i,r=a.K_FALL||i,l=a.K_RISE||i,c=a.K_CL||i}p.K_N=s,p.K_FALL=r,p.K_RISE=l,p.K_CL=c,d=new n.xh5_ibPainter({setting:I,sd:e,ctn:D,withHBg:y,fixScale:!1,reO:{mh:I.DIMENSION.H_MA4K},iMgr:B,iTo:function(t,n,a,i){if(e&&e.datas){!h(t,B.iHLineO.body)&&t.appendChild(B.iHLineO.body);var o=e.labelMaxP-a/I.DIMENSION.h_k*(e.labelMaxP-e.labelMinP);B.iToD({mark:o,x:n,y:a,oy:I.DIMENSION.H_MA4K,ox:I.DIMENSION.posX,e:i},!0,!1)}}}),u=d.getG()}var o,r,s,l,c,d,u,p={},f=1.3,v=1.3,g="solid",b=isNaN(a.nfloat)?2:a.nfloat,y=e.isMain,N=function(e){if(o=m({linetype:"solid",linecolor:p},e||{}),p=o.linecolor,s=p.K_N,r=p.K_FALL,l=p.K_RISE,c=p.K_CL,!o.linetype&&(o.linetype=g),I.datas.candle=o.linetype,0==o.linetype.indexOf("line")||0==o.linetype.indexOf("mountain")){var t=Number(o.linetype.split("_")[1]);(isNaN(t)||0>=t)&&(t=v),f=t}},w=function(t,n){u.fillStyle=I.COLOR.K_EXT;for(var a,i,o,r=!1,s=!1,l=e.datas,c=l.length;c--;){if(o=l[c],a=n,!r&&o.high==e.rangeMax){r=!0;var h=o.high.toFixed(b);99>a?u.textAlign="left":a>I.DIMENSION.w_k-99?(u.textAlign="right",a-=5):u.textAlign="center",i=o.hy,i<I.STYLE.FONT_SIZE&&(i=I.STYLE.FONT_SIZE+2),u.fillText(h,a,i)}if(a=n,!s&&o.low==e.rangeMin){s=!0;var d=o.low.toFixed(b);99>a?u.textAlign="left":a>I.DIMENSION.w_k-99?(u.textAlign="right",a-=5):u.textAlign="center",i=Math.floor(o.ly+I.STYLE.FONT_SIZE+2),i>I.DIMENSION.h_k+0.5*I.STYLE.FONT_SIZE-3&&(i=I.DIMENSION.h_k),u.fillText(d,a,i)}if(s&&r){break}n-=t,0>n&&(n=0)}},_=function(){var t=e.datas,n=t.length,a=I.DIMENSION.w_k/Math.max(n,I.PARAM.minCandleNum),i=0.5*a,o=V.x-a;d.beginPath();for(var r,s,l=0;n>l;l++){r=t[l],s=r.vy,d.drawVStickC(o,s,i,I.DIMENSION.h_k,I.COLOR.V_SD),o+=a}d.stroke()},k=function(){for(var t,n,a=e.datas,i=a.length,r=I.DIMENSION.w_k/Math.max(i,I.PARAM.minCandleNum),s=V.x-0.4*r,l=0;i>l;l++){n=a[l],t=n.cy,0==l?(d.newStyle(c,!0,f),d.moveTo(s,t)):d.lineTo(s,t),n.ix=s,s+=r}d.stroke(),0==o.linetype.indexOf("mountain")&&(s-=r,d.lineTo(s,I.DIMENSION.h_k),d.lineTo(V.x-0.4*r,I.DIMENSION.h_k),d.newFillStyle_rgba(I.COLOR.M_ARR,I.DIMENSION.h_k,I.COLOR.M_ARR_A),d.fill()),y&&I.custom.show_ext_marks&&w(r,s)},M=function(){for(var t,n,a,i,o=e.datas,c=o.length,h=I.DIMENSION.w_k/Math.max(c,I.PARAM.minCandleNum),u=0.6*h,m=-1,p=1,f=0;3>f;f++){switch(m){case -1:i=r;break;case 0:i=s;break;case 1:i=l}for(t=V.x-h,d.beginPath(),a=0;
c>a;a++){n=o[a],n.isFake||(n.kke_cs==m&&d.drawCandleRect(t,n.oy,n.cy,u,i,n.kke_cs==p),0==f&&(n.ix=t+u)),t+=h}for(d.stroke(),t=V.x-h,d.beginPath(),a=0;c>a;a++){n=o[a],n.isFake||n.kke_cs==m&&d.drawCandleLineRect(t,n.hy,n.oy,n.cy,n.ly,u,i,n.kke_cs==p),t+=h}d.stroke(),m++}y&&I.custom.show_ext_marks&&w(h,t)},S=function(){for(var t,n,a,i,o=e.datas,c=o.length,h=I.DIMENSION.w_k/Math.max(c,I.PARAM.minCandleNum),u=0.6*h,m=-1,p=0;3>p;p++){switch(m){case -1:i=r;break;case 0:i=s;break;case 1:i=l}for(t=V.x-h,d.beginPath(),a=0;c>a;a++){n=o[a],n.isFake||(n.kke_cs==m&&d.drawCandleRect_solid(t,n.oy,n.cy,u,i),0==p&&(n.ix=t+u)),t+=h}for(d.stroke(),t=V.x-h,d.beginPath(),a=0;c>a;a++){n=o[a],n.isFake||n.kke_cs==m&&d.drawCandleLineRect(t,n.hy,n.oy,n.cy,n.ly,u,i,!1),t+=h}d.stroke(),m++}y&&I.custom.show_ext_marks&&w(h,t)},L=function(){for(var t,n,a,i,o=e.datas,c=o.length,h=I.DIMENSION.w_k/Math.max(c,I.PARAM.minCandleNum),u=0.6*h,m=-1,p=0;3>p;p++){switch(m){case -1:i=r;break;case 0:i=s;break;case 1:i=l}for(t=V.x-h,d.beginPath(),a=0;c>a;a++){n=o[a],n.isFake||(0==p&&(n.ix=t+u),n.kke_cs==m&&d.drawOhlc(t,n.oy,n.hy,n.ly,n.cy,u,i)),t+=h}d.stroke(),m++}y&&I.custom.show_ext_marks&&w(h,t)},A=function(){y&&d.drawBg(V.x);var t=e.datas;if(t){var n=0==o.linetype.indexOf("line")||0==o.linetype.indexOf("mountain"),a=0==o.linetype.indexOf("hollow"),i=0==o.linetype.indexOf("ohlc");d.clear(n,I.PARAM.getHd()),d.newGStyle({textBaseline:"bottom",font:I.STYLE.FONT_SIZE+"px "+I.STYLE.FONT_FAMILY}),y&&I.custom.show_underlay_vol&&_(),n?k():a?M():i?L():S()}};this.draw=A,this.clear=function(e){e?d.clear(!1,I.PARAM.getHd()):(d.remove(),d=null)},this.resize=function(){d.resize({mh:I.DIMENSION.H_MA4K}),A()},this.setLineStyle=N,this.getLineStyle=function(){return o},N(a),i()}function M(){var e,n,l,h,d=this,f=[],g=0.05,y=function(){var e,t,n=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=f.length,r=o>1||"percent"==I.datas.scaleType;I.custom.k_overlay&&(r=!1);for(var s,l,c,h,d=r?"Percent":"Price",u=o;u--;){e=f[u],a.scalerange?c=a.scalerange:(h=e.getPriceTech(),r||!h?c=[i,n]:(t=h&&h.getMaxMin(),c=t||[i,n])),s=e["min"+d],l=e["max"+d],isFinite(s)&&isFinite(l)&&(n=Math.min(n,s,c[1]),i=Math.max(i,l,c[0]))}var m;m=a.scalerange?a.scalerange.concat(4):1==a.pcm?0.0199>i-n?[i,n,1]:v(i,n,2,!1,!0):v(i,n,a.nfloat,!1,!0,g);for(var p=o;p--;){e=f[p],e.setPricePos(m,r)}},N=function(){(z.start<1||!I.custom.smooth)&&V.resetX();for(var e=f.length;e--;){f[e].draw()}},_=function(){z.start=z.end=0/0,z.currentLength=0/0,n=void 0},k=function(t){_();for(var n,a=f.length,i=0;a>i;i++){n=f[i],n.onViewChange()}y(),N(),t||j.onRange(e,a>1)},M=[],S=!1,L=function(t){return t.isErr?(t!==e&&d.removeCompare([t.symbol]),!0):t.kDb.get()?!0:(t.initData(R),!1)},A=function(e){if(e&&t.isFunc(e.callback)){for(var n=!1,a=M.length;a--;){if(e.callback===M[a]){n=!0;break}}!n&&M.push(e.callback)}},D=function(){for(var t,n=!0,a=f.length;a--;){t=f[a],t==e||L(t)||(n=!1,S=!0)}return n},R=function(t,n){if(A(n),L(e)){if(e.isErr){return void (e.isErr=!1)}if(B.patcher.switchFloater(),V.resetX(0),D()){for(S=!1,k(t);M.length;){var a=M.shift();a()}}if(j.onViewChanged(),t){return}j.onDataUpdate(),j.onViewPrice()}},C=function(t){(t||n&&z.dataLength!=n)&&j.onRange(e,f.length>1),n=z.dataLength},H=function(e){(e||z.end==z.dataLength)&&(B.update(),y(),N(),C(!0)),j.onDataUpdate(),!B.isIng()&&j.onViewPrice()},T=function(e){clearTimeout(h),!P&&x.parentNode&&"none"!=x.style.display&&(h=setTimeout(H,e||200))},E=function(){if(!S){for(var e,t=f.length;t--;){e=f[t],e.doUpdate(T)}}},K=function(){if(clearInterval(l),!isNaN(a.rate)){var e=1000*a.rate;e>0&&(l=setTimeout(K,e))}E()};this.mM=new function(){var n=function(a,i,o){var l,c;switch(i){case"price":if(l=r,c="initPt",t.isObj(a)){a.name&&"TZY"===String(a.name).toUpperCase()&&(g=0.2)}else{if(t.isArr(a)){for(var h,d=a.length;d--;){if(h=a[d],h&&h.name&&"TZY"===String(h.name).toUpperCase()){g=0.2;break}}}}break;case"tech":l=s,c="initTc"}c&&(l?e[c](a,o):KKE.api("plugins.techcharts.get",{type:i},function(e){s=e.tChart,r=e.pChart,n(a,i,o)}))},a=function(t,n){var a;switch(n){case"price":a="removePt",g=0.05;break;case"tech":a="removeTc";break;default:return}e&&e[a](t)},i=function(t){return o?(U?(U.sh(t),(t.from||t.to)&&U.dateFromTo(t.from,t.to)):(e.initRs(),i(t),O.appendChild(U.getBody())),void Y.resizeAll(!0)):void KKE.api("plugins.rangeselector.get",null,function(e){o=e,i(t)})};this.showRs=i,this.newAC=n,this.removeAC=a,this.togglePt=function(t,n){e&&(e.togglePt(t,n),R())}};var F=new function(){var n,i,o,r,s=!1,l=!1,h=function(){i||(i=c("div"),i.style.margin="0 auto"),i.style.width=0.8*I.DIMENSION.getStageW()+"px",i.style.height=0.83*I.DIMENSION.h_k+"px"},d=function(e){n.dateTo(e.date,function(e){1!=e&&q.showTip({txt:w.nohistoryt,parent:x})})},u=function(t){if(o&&n){l=!0;var a=n.getSymbols()[0];a!=e.symbol&&n.newSymbol({symbol:e.symbol}),n.resize(),d(t),n.show(i)}},m=function(){l=!1},f=function(n){var a={txt:e.getName()+"("+e.symbol+") "+p.ds(n.date),content:i,parent:x,fontColor:"#000",closeCb:m,btnLb:"\u5173\u95ed",bgStyle:{backgroundColor:"#fff",width:"80%",top:"2%"}};
return o||(o=new t.TipM(I.COLOR)),a.content=i,a},v=function(t){var r=f(t);if(o.genTip(r),n){u(t)}else{if(s){return}s=!0,KKE.api("chart.h5t.get",{symbol:e.symbol,dom:i,nfloat:a.nfloat},function(e){n=e,s=!1,u(t)})}};this.resetHisT=function(){o&&o.hide()},this.isShowing=function(){return l},this.historyT=function(){if("CN"===t.market(e.symbol)){r=B.getInteractiveIdx();var n=e.datas[r];if(n){if(n.date.getFullYear()<2008){return void q.showTip({txt:w.historyt08,parent:x})}switch(I.custom.history_t){case"layer":h(),v(n);break;case"window":var a="finance.xxx.com.cn/h5charts/tchart.html?symbol=$symbol&date=$date&rangeselector=true&indicator=tvol";a=a.replace("$symbol",e.symbol).replace("$date",p.ds(n.date));var i="width=600,height=375,location=0,menubar=0,titlebar=0,toolbar=0,alwaysRaised=1";window.open(a,"_blank",i);break;default:return}}}}};this.h5tM=F,this.getAllStock=function(){return f},this.getMainStock=function(){return e},this.getAllSymbols=function(){for(var e=[],t=0,n=f.length;n>t;t++){e.push(f[t].symbol)}return e};var $=function(){d.mM.togglePt(f.length>1?{v:!1}:z.viewId==w.URLHASH.KCL||z.viewId==w.URLHASH.KCLF||z.viewId==w.URLHASH.KCLB?{v:!1}:{v:!0})},W=function(t,n,a,i,o){if(!a&&V.resetX(),!(n-t<I.PARAM.minCandleNum||n>z.dataLength||0>t||n-t>I.PARAM.maxCandleNum)){z.start=t,z.end=n,z.currentLength=n-t;for(var r,s=f.length,l=0;s>l;l++){r=f[l],r.setRange(i)}y(),N(),o||j.onRange(e,s>1)}};this.onChangeView=R,this.showYTD=function(t,n){z.viewId=w.URLHASH.KD+t,R(!0);var a=e.getYtdIndex(n);a&&W(a[0],a[1]+1)},this.moving=W,this.callSdDraw=N;var X=function(t,n){var a=t instanceof i?t:new i(t,n);n&&(e=a),f.push(a),$(),R()},G=function(n){if("mink"==w.URLHASH.gt(z.viewId).type){var a=t.market(n.symbol),i=t.market(e.symbol);if(a!=i&&("US"==a||"US"==i)){return !1}}return !0};this.compare=function(e){for(var n=e.callback,a=f.length;a--;){if(f[a].symbol==e.symbol){return void (t.isFunc(n)&&n({code:1,msg:"comparing same symbol"}))}}G(e)?X(e,!1):t.isFunc(n)&&n({code:2,msg:"invalid comparing market or period"})},this.removeCompare=function(e,t){for(var n,a,i=!1,o=e.length;o--;){a=e[o];for(var r=f.length;r--;){if(a==f[r].symbol){i=!0,n=f.splice(r,1)[0],n.clear(t),n=null;break}}}i&&!t&&($(),y(),N())};var Z,J=function(e){e?H():z.end==z.dataLength&&B.update()},Q=!1,ee=0,te=function(){clearTimeout(Z),Q=!1,ee=0},ne=function(){Z=setTimeout(function(){ee>0&&T(1),te()},500)};this.pushData=function(e,t){var n=!1;switch(Number(t)){case 0:te();break;case 1:te(),n=!0;break;case 2:Q||(Q=!0,ne())}for(var a=e.length;a--;){for(var i=f.length;i--;){if(f[i].symbol===e[a].symbol&&e[a].data){ee++,f[i].doUpdate(b(J,null,n),!1,e[a].data,e[a].market);break}}}},this.setScale=function(e){I.datas.scaleType=e,y(),N()},this.setLineStyle=function(n){if(n){!t.isArr(n)&&(n=[n]);for(var a=n.length;a--;){var i=n[a];if(i.hasOwnProperty("symbol")){for(var o=i.symbol,r=f.length;r--;){if(f[r].symbol==o){f[r].setLineStyle(i),f[r].draw();break}}}else{e.setLineStyle(i),e.draw()}}}else{e.setLineStyle(),e.draw()}},this.onResize=function(e){for(var t=f.length;t--;){f[t].resize(e)}};var ae=-1,ie=-1,oe=function(e,t){var n=z.start,a=z.end,i=e/Math.abs(e),o=i*Math.ceil((a-n)/I.PARAM.zoomUnit);if(Math.abs(o)>I.PARAM.zoomLimit&&(o=i*I.PARAM.zoomLimit),I.custom.centerZoom){var r=t?t.layerX/I.DIMENSION.w_k:0.5;r<I.PARAM.zoomArea?a=Math.min(a-o*Math.abs(o),z.dataLength):r>1-I.PARAM.zoomArea?n=Math.max(n+o*Math.abs(o),0):(n=Math.max(n+o*Math.abs(o),0),a=Math.min(a-o*Math.abs(o),z.dataLength))}else{n=Math.max(n+o*Math.abs(o),0)}return n==ae&&a==ie?[-1]:(ae=n,ie=a,[n,a])};this.onWheel=function(e){if(!F.isShowing()){var t=e.detail||-1*e.wheelDelta;if(0!=t){var n=oe(t,e);W(n[0],n[1])}}},this.onKb=function(e){if("keyup"==e.type){return void B.iToKb(null,!0)}var t=e.keyCode;if(F.isShowing()){return void (27==t&&F.resetHisT())}switch(t){case 38:case 40:var n=oe(38==t?1:-1);W(n[0],n[1]);break;case 37:case 39:var a=B.iToKb(37==t?-1:1);a&&(W(z.start+a,z.end+a),B.iToKb(0));break;case 13:F.historyT();break;default:return}u.preventDefault(e)},this.zoomApi=function(e){var t=oe(e?1:-1);W(t[0],t[1])},this.moveApi=function(e){var t=z.start,n=z.end;t+=e,n+=e,n>z.dataLength&&(n=z.dataLength,t=z.start+n-z.end),0>t&&(t=0,n=z.end-z.start),W(t,n)},this.shareTo=function(e){e=m({type:"weibo",url:window.location.href,wbtext:"",qrwidth:100,qrheight:100,extra:void 0},e||{});var n=String(e.type).toLowerCase();switch(n){case"qrcode":KKE.api("utils.qrcode.createcanvas",{text:e.url,width:e.qrwidth,height:e.qrheight},function(e){q.showTip({content:e,txt:'<p style="margin:0 0 9px 0;">\u626b\u63cf\u4e8c\u7ef4\u7801</p>',parent:x,btnLb:"\u5173\u95ed"})});break;default:t.grabM.shareTo({ctn:x,w:I.DIMENSION.getStageW(),h:I.DIMENSION.getStageH()-(O.clientHeight||0),ignoreZIdxArr:[I.PARAM.I_Z_INDEX],ignoreIdArr:[I.PARAM.LOGO_ID],priorZIdx:I.PARAM.G_Z_INDEX,nologo:!1,top:I.DIMENSION.posY+I.DIMENSION.H_MA4K+17,right:I.DIMENSION.RIGHT_W+I.DIMENSION.K_RIGHT_W,LOGO_W:I.DIMENSION.LOGO_W,LOGO_H:I.DIMENSION.LOGO_H,color:I.COLOR.LOGO,bgColor:I.COLOR.BG,txt:e.wbtext,url:e.url,extra:e.extra})
}},this.getExtraData=function(n){if(n=m({symbol:e.symbol,name:null,clone:!0},n||{}),!n.name){return null}for(var a,i,o=f.length;o--;){if(f[o].symbol===n.symbol){a=f[o];break}}if(a){var r;"currentK"==n.name?(r=a.kDb.get(),i=n.clone?t.clone(r,null):r):(r=a.extraDataObj[n.name],i=n.clone?t.clone(r,null):r)}return i},this.updateDataAll=K,this.outputNewRange=C,this.dcReset=function(){clearInterval(l),clearTimeout(h);for(var e,t=f.length;t--;){e=f.splice(t,1)[0],e.clear(),e=null}},this.dcInit=function(e){X(e,!0),K()}}t.xh5_EvtDispatcher.call(this);var S=this;a=m({candlenum:0/0,datas:{day:{wfn:void 0,url:void 0,dataformatter:void 0,staticdata:void 0},min:{wfn:void 0,url:void 0,dataformatter:void 0,staticdata:void 0}},dim:null,dom:void 0,domid:void 0,fh5:!1,maxcandlenum:0/0,mincandlenum:0/0,mh:0,name:void 0,nfloat:2,noh5:void 0,nohtml5info:void 0,ondataupdate:void 0,onrange:void 0,onviewchanged:void 0,onviewprice:void 0,ontechchanged:void 0,onshortclickmain:void 0,pcm:0,rate:0/0,reorder:!0,reheight:!0,scalerange:void 0,ssl:0,symbol:"sh000001",tchartobject:{t:void 0,k:void 0},theme:null,trace:void 0,view:"kd",w:0/0,h:0/0,zoomlimit:0/0,zoomunit:0/0},a||{WANGXuan:"wangxuan2@staff.sina.com.cn",VER:"2.9.13"});var I;!function(){if(!a.symbol&&(a.symbol="sh000001"),a.symbol=String(a.symbol),a.symbol=a.symbol.replace(".","$"),I=e.getSetting(["_",a.symbol,"_",Math.floor(1234567890*Math.random()+1)+Math.floor(9876543210*Math.random()+1)].join("")),0==location.protocol.indexOf("https:")&&(a.ssl=!0),isNaN(a.rate)&&(a.rate=I.PARAM.updateRate),!isNaN(a.mincandlenum)&&a.mincandlenum>0&&(I.PARAM.minCandleNum=a.mincandlenum),!isNaN(a.candlenum)&&a.candlenum>=I.PARAM.minCandleNum&&(I.PARAM.defaultCandleNum=a.candlenum),isNaN(a.maxcandlenum)||(I.PARAM.maxCandleNum=a.maxcandlenum),!isNaN(a.zoomunit)&&a.zoomunit>I.PARAM.minCandleNum&&(I.PARAM.zoomUnit=a.zoomunit),!isNaN(a.zoomlimit)&&a.zoomlimit>0&&(I.PARAM.zoomLimit=Math.round(a.zoomlimit)),g.noH5){if("undefined"==typeof FlashCanvas||a.fh5){return void (t.isFunc(a.noh5)&&a.noh5(a))}I.PARAM.isFlash=!0}if(I.PARAM.isFlash&&(I.COLOR.F_BG="#fff"),a.reorder||(I.custom.indicator_reorder=!1),a.reheight||(I.custom.indicator_reheight=!1),a.dim){for(var n in a.dim){a.dim.hasOwnProperty(n)&&t.isNum(I.DIMENSION[n])&&(I.DIMENSION[n]=a.dim[n])}}}();var L,A,x,D,R,C,H,O,T,E,K,U,F,P=!1,$=0,z={viewId:w.URLHASH.vi(a.view||"kd"),dataLength:0/0,start:0/0,end:0/0,currentLength:0/0,startDate:void 0,endDate:void 0,movY:0},V={x:0,resetX:function(e){this.x=isNaN(e)?I.DIMENSION.w_k/Math.max(z.currentLength,I.PARAM.minCandleNum):e}},q=new function(){var e;this.showTip=function(n){e||(e=new t.TipM(I.COLOR)),e.genTip(n)},this.hideTip=function(){e&&e.hide()}},j=new function(){var e=function(){var e=T.get(z.viewId);return e?e[e.length-1]:null};this.onRange=function(e,n){!P&&t.isFunc(a.onrange)&&a.onrange({isCompare:n,data:e.datas,viewRangeState:t.clone(z,null),width:I.DIMENSION.w_k,height:I.DIMENSION.h_k,left:I.DIMENSION.posX,top:I.DIMENSION.H_MA4K,range:[e.labelMaxP,e.labelMinP,e.labelMaxVol],minCandleNum:I.PARAM.minCandleNum})};var n=[];this.onViewPrice=function(i,o,r,s,l,c){if(!P&&t.isFunc(a.onviewprice)){if(!i){if(i=e(),!i){return}o=z.currentLength-1}if(!r){for(;n.length;){n.length--}for(var h,d,u,m,p=L.getAllStock(),f=0,v=p.length;v>f;f++){m=p[f],h=m.datas,!h||h.length<=o||(d=m.getName(),u=h[o],!s&&p[f].isMain&&(s=h),n.push({name:d,data:u,rangedata:h,symbol:m.symbol,color:m.getLineStyle().linecolor}))}r=n}l||(l=L.getMainStock().getName()),a.onviewprice({data:t.clone(i,null),rangedata:s,idx:o,left:I.DIMENSION.posX,top:I.DIMENSION.H_MA4K,data_array:r,curname:l,interacting:!!c})}},this.onDataUpdate=function(){if(t.isFunc(a.ondataupdate)){var n=e();n&&a.ondataupdate({data:t.clone(n,null),idx:z.currentLength-1,left:I.DIMENSION.posX,top:I.DIMENSION.H_MA4K})}},this.onViewChanged=function(){t.isFunc(a.onviewchanged)&&a.onviewchanged({viewRangeState:t.clone(z,null)})},this.onInnerResize=function(e){t.isFunc(a.oninnerresize)&&a.oninnerresize(e)},this.onTechChanged=function(e){t.isFunc(a.ontechchanged)&&a.ontechchanged({Indicator:e})},this.shortClickHandler=function(){t.isFunc(a.onshortclickmain)&&a.onshortclickmain()}},Y=new function(){var e,n,i,o,r,s=37,h=function(e,t,n){var i=!1;isNaN(e)&&(e=a.w||A.offsetWidth),isNaN(t)&&(t=a.h||A.offsetHeight-a.mh);for(var o,r=O.clientHeight||0,s=H.clientHeight||0,l=I.DIMENSION.getOneWholeTH(),c=0,h=H.childNodes,d=h.length,u=0,m=h.length;m--;){o=h[m],o.id.indexOf("blankctn")>=0?(c=o.offsetHeight,d--,u+=c):u+=l}return !isNaN(n)&&(s-=n),s/(t-r)>1&&(s=u,i=!0),I.DIMENSION.setStageW(e),1==$?d>0&&(I.DIMENSION.setStageH(t,d*l+c+r),i=!0,$=0):I.DIMENSION.setStageH(t,s+r),i},d=function(){r&&(r.style.display=I.custom.show_logo?"":"none")},m=function(){F=new t.LoadingSign,F.appendto(D)},p=function(){F.setPosition()},f=function(e,n,a){var o=h(n,a,0/0);if(e||n&&a){if(!L){return}L.onResize(o),B.onResize()}i.style.left="1px",i.style.top=I.DIMENSION.h_k+I.DIMENSION.H_MA4K+"px",d(),p(),t.stc("k_wh",[I.DIMENSION.getStageW(),I.DIMENSION.getStageH()])
},v=function(){A=l(a.domid)||a.dom,A||(A=c("div"),document.body.appendChild(A)),x=c("div"),x.style.position="relative",x.style.outlineStyle="none",x.style.webkitUserSelect=x.style.userSelect=x.style.MozUserSelect="none",D=c("div","mainarea_"+I.uid),R=c("div"),D.appendChild(R),C=c("div"),C.style.position="absolute",C.style.fontSize=C.style.lineHeight=I.STYLE.FONT_SIZE+"px",C.style.width="100%",D.appendChild(C),x.appendChild(D),H=c("div"),x.appendChild(H),O=c("div"),x.appendChild(O),e=new N({width:s,height:I.DIMENSION.H_TIME_PART}),n=e.g,i=e.canvas,i.style.position="absolute",x.appendChild(i),A.appendChild(x)},b=function(e){var n=!1;if(e){U&&(n=U.setTheme(e));for(var a in e){e.hasOwnProperty(a)&&I.COLOR.hasOwnProperty(a)&&I.COLOR[a]!==e[a]&&(I.COLOR[a]=e[a],n=!0)}t.stc("k_thm",e)}return n&&_.styleLogo({logo:r,color:I.COLOR.LOGO}),n},y=function(e){!I.custom.mousewheel_zoom||document.activeElement!==x&&document.activeElement.parentNode!==x||(L&&L.onWheel(e),u.preventDefault(e),u.stopPropagation(e))},k=function(e){I.custom.keyboard&&L&&L.onKb(e)},M=function(){t.xh5_deviceUtil.istd||(g.info.name.match(/firefox/i)?u.addHandler(x,"DOMMouseScroll",y):u.addHandler(x,"mousewheel",y),x.tabIndex=0,u.addHandler(x,"keyup",k),u.addHandler(x,"keydown",k))},S=function(e){r=e,x.appendChild(e)};v(),m(),b(a.theme),f(),M(),_.getLogo({cb:S,id:I.PARAM.LOGO_ID,isShare:!1,top:I.DIMENSION.posY+I.DIMENSION.H_MA4K+17,right:I.DIMENSION.RIGHT_W+I.DIMENSION.K_RIGHT_W,LOGO_W:I.DIMENSION.LOGO_W,LOGO_H:I.DIMENSION.LOGO_H,color:I.COLOR.LOGO}),g.noH5&&(q.showTip({txt:a.nohtml5info||w.nohtml5info,parent:x}),t.stc("k_nh5")),this.resizeAll=f,this.innerResize=function(e){L&&(h(0/0,0/0,e),L.onResize(),B.onResize(),p(),j.onInnerResize({height:I.DIMENSION.h_k}))},this.initTheme=b,this.drawReMark=function(t){if(t){if(i.style.display="",o==t){return}var a=I.DIMENSION.H_TIME_PART;o=t,e.resize({width:s,height:a,hd:I.PARAM.getHd()}),n.font="12px "+I.STYLE.FONT_FAMILY,n.textBaseline="top",n.fillStyle=I.COLOR.REMARK_BG,n.fillRect(0,0,s,a),n.fillStyle=I.COLOR.REMARK_T,n.fillText(t,0,0)}else{i.style.display="none"}}},B=new function(){var e,n,i,o,r=t.market(a.symbol),s=/^forex|^HF/.test(r),l=isNaN(a.nfloat)?2:a.nfloat,d=150,u=new function(){var t=function(t){var n=e.body.style;t&&I.custom.show_floater?(n.backgroundColor=I.COLOR.F_BG,n.color=I.COLOR.F_T,n.border="1px solid "+I.COLOR.F_BR,n.display=""):n.display="none"};this.pv=function(n){var a=e.body.style,i=Math.max(I.DIMENSION.posX,55)+9;a.left=(n.x>I.DIMENSION.getStageW()>>1?i:I.DIMENSION.getStageW()-d-9)+"px",a.top=(n.y||0)+"px",t(!0)},this.showFloater=t},m=function(){function t(){var e,t,n="border:0;font-size:100%;font:inherit;vertical-align:baseline;margin:0;padding:0;border-collapse:collapse;border-spacing:0;text-align:center;",a="font-weight:normal;border:0;height:16px;text-align:center",i="text-align:left;font-weight:normal;border:0;height:16px;",o="text-align:right;border:0;height:16px;",r=c("div"),h=r.style;h.position="absolute",h.zIndex=I.PARAM.I_Z_INDEX+2,h.padding="2px",h.width=d+"px",h.lineHeight="16px",h.display="none",h.fontSize="12px";var u,m,f,v,g=c("table"),b=c("thead"),N=c("tbody");g.style.cssText=n,u=c("tr"),m=c("th"),m.setAttribute("colspan","2"),m.style.cssText=a;var w=c("span");m.appendChild(w),u.appendChild(m),b.appendChild(u),u=c("tr"),m=c("th"),m.setAttribute("colspan","2"),m.style.cssText=a;var _=c("span");m.appendChild(_),u.appendChild(m),N.appendChild(u),u=c("tr"),m=c("th"),m.style.cssText=i,f=c("td"),v=c("span"),v.innerHTML="\u5f00\u76d8";var k=c("span");f.style.cssText=o,m.appendChild(v),f.appendChild(k),u.appendChild(m),u.appendChild(f),N.appendChild(u),u=c("tr"),m=c("th"),m.style.cssText=i,f=c("td"),v=c("span"),v.innerHTML="\u6700\u9ad8";var M=c("span");f.style.cssText=o,m.appendChild(v),f.appendChild(M),u.appendChild(m),u.appendChild(f),N.appendChild(u),u=c("tr"),m=c("th"),m.style.cssText=i,f=c("td"),v=c("span"),v.innerHTML="\u6700\u4f4e";var S=c("span");f.style.cssText=o,m.appendChild(v),f.appendChild(S),u.appendChild(m),u.appendChild(f),N.appendChild(u),u=c("tr"),m=c("th"),m.style.cssText=i,f=c("td"),v=c("span"),v.innerHTML="\u6536\u76d8";var L=c("span");f.style.cssText=o,m.appendChild(v),f.appendChild(L),u.appendChild(m),u.appendChild(f),N.appendChild(u),u=c("tr"),m=c("th"),m.style.cssText=i,f=c("td"),v=c("span"),v.innerHTML="\u6da8\u8dcc";var A=c("span");if(f.style.cssText=o,m.appendChild(v),f.appendChild(A),u.appendChild(m),u.appendChild(f),N.appendChild(u),!s){u=c("tr"),m=c("th"),m.style.cssText=i,f=c("td"),v=c("span"),v.innerHTML="\u6210\u4ea4";var x=c("span");f.style.cssText=o,m.appendChild(v),f.appendChild(x),u.appendChild(m),u.appendChild(f),N.appendChild(u),u=c("tr"),m=c("th"),m.style.cssText=i,f=c("td"),v=c("span"),v.innerHTML="\u6362\u624b";var D=c("span");f.style.cssText=o,m.appendChild(v),f.appendChild(D),u.appendChild(m),u.appendChild(f),N.appendChild(u),D.innerHTML="--"}u=c("tr"),m=c("th"),m.style.cssText=i,f=c("td"),v=c("span"),v.innerHTML="\u632f\u5e45";var R=c("span");
f.style.cssText=o,m.appendChild(v),f.appendChild(R),u.appendChild(m),u.appendChild(f),N.appendChild(u),g.appendChild(b),g.appendChild(N),g.style.width="100%",r.appendChild(g);var C,H,O=function(e,t){var n=I.COLOR.F_N;return e>t?n=I.COLOR.F_RISE:t>e&&(n=I.COLOR.F_FALL),n},T=function(e,t){return t?"("+((e-t)/t*100).toFixed(2)+"%)":"(--%)"};this.setFloaterData=function(n){if(e=n.name||n.symbol||e||"",w.innerHTML=e,C=n.data||t){t=C,H=n.stock||H;var a=H.market,i="";switch(a){case"CN":case"OTC":i="\u624b";break;case"US":case"HK":i="\u80a1";break;default:i=""}var o=C.percent,r=C.open,c=C.close,h=C.high,d=C.low,u=c/(1+o)||C.prevclose;_.innerHTML=p.ds(C.date,"/")+"/"+p.nw(C.date.getDay())+(C.time||"");var m=1>u||1>h||1>d?4:l;k.innerHTML=r.toFixed(m)+T(r,u,m),M.innerHTML=h.toFixed(m)+T(h,u,m),S.innerHTML=d.toFixed(m)+T(d,u,m),L.innerHTML=c.toFixed(m)+T(c,u,m),o=isNaN(o)||!isFinite(o)?"--":(100*o).toFixed(2),A.innerHTML=C.change.toFixed(m)+"("+o+"%)";var f=isNaN(C.ampP)?"--":(100*C.ampP).toFixed(2);if(R.innerHTML=C.amplitude.toFixed(m)+"("+f+"%)",A.style.color=O(o,0),k.style.color=O(r,u),M.style.color=O(h,u),S.style.color=O(d,u),L.style.color=O(c,u),s||(x.innerHTML=y(C.volume,2)+i),D&&H){var v=H.extraDataObj.rsAmount;if(v){for(var g,b=0,N=v.length;N>b;b++){if(C.date>=v[b].date){g=v[b].amount;break}}g&&(D.innerHTML=(C.volume/g).toFixed(2)+"%")}else{D.innerHTML="--"}}}},this.body=r,this.reset=function(){e=null,t=null}}n=new t,e=n},f=function(){function e(e){var t=c("div"),n=c("div"),a=c("span"),i=12,o=e.isH,r=function(){if(n.style.borderStyle="dashed",n.style.borderColor=I.COLOR.IVH_LINE,a.style.backgroundColor=I.COLOR[e.txtBgCN],a.style.color=I.COLOR[e.txtCN],o){n.style.borderWidth="1px 0 0 0",t.style.width=n.style.width=I.DIMENSION.getStageW()+"px",a.style.top=-(0.6*I.STYLE.FONT_SIZE)+"px",a.style.width=I.DIMENSION.extend_draw?"":I.DIMENSION.posX+"px",a.style.left=0,a.style.padding="1px 0"}else{n.style.borderWidth="0 1px 0 0";var i,r,s=I.DIMENSION.H_MA4K+I.DIMENSION.H_T_B;I.DIMENSION.getStageH()<0?(i=H.clientHeight,r=i-s):(i=I.DIMENSION.getStageH()-O.clientHeight||0,r=I.DIMENSION.h_k),i-=s,i+=I.DIMENSION.I_V_O,t.style.height=n.style.height=i+"px",a.style.top=r+"px",a.style.padding="2px 2px 1px"}};t.style.position="absolute",t.style.zIndex=I.PARAM.I_Z_INDEX-2,a.style.position=n.style.position="absolute",n.style.zIndex=0,a.style.zIndex=1,a.style.font=I.STYLE.FONT_SIZE+"px "+I.STYLE.FONT_FAMILY,a.style.whiteSpace="nowrap",a.style.lineHeight=i+"px",e.txtA&&(a.style.textAlign=e.txtA),r(),t.appendChild(a),t.appendChild(n);var s=function(e){e?""!=t.style.display&&(t.style.display=""):"none"!=t.style.display&&(t.style.display="none")};this.pv=function(e){if(!isNaN(e.y)&&(t.style.top=e.y+(e.oy||0)+"px"),a.innerHTML=e.v||"",!isNaN(e.x)){e.x<0&&(e.x=0);var n=e.x+(e.ox||0),i=I.DIMENSION.getStageW();n=~~(n+0.5),n-=1,t.style.left=n+"px";var o=a.offsetWidth||66,r=o>>1;e.x<r?r=e.x:n+r>i&&(r=n+o-i),a.style.left=-r+"px"}s(!0)},this.display=s,this.body=t,this.resize=r,s(!1)}i=new e({isH:!0,txtCN:"P_TC",txtBgCN:"P_BG",txtA:"right"}),o=new e({isH:!1,txtCN:"T_TC",txtBgCN:"T_BG",txtA:"center"}),x.appendChild(o.body)},v=function(){i.display(!1),o.display(!1),u.showFloater(!1)},g=function(e){E&&E.indirectI(e),K&&K.indirectI(e)},b=!1,N=!1,_=0/0,k=!1;this.getInteractiveIdx=function(){return _},this.isIng=function(){return b},this.isMoving=function(){return k};var M=0/0,A=0/0,R=[];this.iToD=function(t,n,a){if(!t.e||!N){var r=t.x,s=t.ox||0,c=t.y,h=t.oy||0,d=t.e?t.e.target:null;if(!a){if(M==r&&A==c){return}M=r,A=c}if(d){var m=d.style.height.split("px")[0];(0>c||c>m)&&(r=0/0,c=0/0)}var p=z.currentLength,f=Math.max(p,I.PARAM.minCandleNum);r+=I.DIMENSION.w_k/f-V.x;var y=Math.floor(r*f/I.DIMENSION.w_k);if(0>y?y=0:y>=p&&(y=p-1),!isNaN(y)&&(_=y),isNaN(r)&&isNaN(c)){return b=!1,v(),g(Number.MAX_VALUE),void j.onViewPrice()}b=z.end!=z.dataLength?!0:p-1>y;for(var k,x,D,C,H,O,T,E=Number(t.mark);R.length;){R.length--}if(n){var K=L.getAllStock(),U=K.length,F=U>1||"percent"==I.datas.scaleType;I.custom.k_overlay&&(F=!1);for(var P,$,q,Y,B=Number.MAX_VALUE,W=0;U>W;W++){q=K[W],H=q.datas,!H||H.length<=y||(P=q.getName(),$=H[y],R.push({name:P,data:$,rangedata:H,symbol:q.symbol,color:q.getLineStyle().linecolor}),$.isFake||(Y=Math.abs($.cy-c),B>Y&&(B=Y,C=q,D=$,T=H,x=P,k=C.symbol)))}if(F){O=100*E,O=Math.abs(O)>999?Math.floor(O):O.toFixed(2),O+="%"}else{if(O=E>99999?Math.floor(E):E.toFixed(E>9999?1:l),I.custom.show_k_rangepercent&&C){var X=(E-C.prevclose)/C.prevclose*100;X=isNaN(X)||!isFinite(X)?"--":X.toFixed(l),O+="<br/>"+X+"%"}}}else{if(C=L.getMainStock(),H=C.datas,!H||H.length<=y){return}D=H[y],T=H,x=C.getName(),k=C.symbol;var G=Math.abs(E);O=G>99999?Math.floor(E):E.toFixed(G>9999?1:l),R.push({name:x,data:D,rangedata:T,symbol:k,color:C.getLineStyle().linecolor})}if(D){var Z=r;I.custom.stick&&(r=D.ix||r),e&&(e.setFloaterData({symbol:k,name:x,data:D,stock:C,arr:R}),u.pv({x:Z,y:I.DIMENSION.K_F_T})),i.pv({y:c,v:O,oy:h}),o.pv({x:r,ox:s,y:I.DIMENSION.H_MA4K,v:D.day+" "+(D.time||"")}),g(y),!x&&(x=k||"--"),j.onViewPrice(D,y,R,T,x,!0),S.re(w.e.I_EVT,t.e)
}}};var C,T,U;this.iToKb=function(e,t){if(t){return void (N=!1)}if(N=!0,_+=e,!h(D,B.iHLineO.body)&&D.appendChild(B.iHLineO.body),C=L.getMainStock(),U=C.getName(),T=C.datas,!T){return void 0}if(0>_){return _=0,-1}if(_>=T.length){return _=T.length-1,1}var n=T[_];if(!n){return void 0}var a={mark:C.labelMaxP-n.cy/I.DIMENSION.h_k*(C.labelMaxP-C.labelMinP),x:n.ix,y:n.cy,oy:I.DIMENSION.H_MA4K,ox:I.DIMENSION.posX};return void this.iToD(a,!0,!0)};var F;this.globalDragHandler=function(e,t,n,a,i){if(isNaN(e)&&isNaN(t)){return F=0/0,k=!1,void S.re(w.e.I_EVT,i)}v();var o=z.start,r=z.end,s=r-o;isNaN(F)&&(F=e);var l=t-F,c=z.dataLength,h=I.DIMENSION.w_k/s;if(Math.abs(l)<h){if(I.custom.smooth&&h>4){if(r>=c&&0>l){return}if(1>o&&l>0){return}V.x=l,L.callSdDraw()}}else{F=t;var d=Math.round(l*s/I.DIMENSION.w_k);o-=d,r-=d,r>=c&&(r=c,o=r-s),0>o&&(o=0,r=s),(z.start!=o||z.end!=r)&&(V.resetX(0),z.movY=a-n,L.moving(o,r,!0),k=!0)}},this.shortClickHandler=function(){j.shortClickHandler()},this.zoomView=function(e,t){var n=-Number(e);0==n&&(n=1);var a=z.start,i=z.end,o=n*Math.ceil((i-a)/I.PARAM.zoomUnit);if(Math.abs(o)>I.PARAM.zoomLimit&&(o=n*I.PARAM.zoomLimit),I.custom.centerZoom){var r=Math.min.apply(Math,t),s=r/I.DIMENSION.w_k,l=Math.max.apply(Math,t),c=l/I.DIMENSION.w_k;s<I.PARAM.zoomArea?i=Math.min(i-o*Math.abs(o),z.dataLength):c>1-I.PARAM.zoomArea?a=Math.max(a+o*Math.abs(o),0):(a=Math.max(a+o*Math.abs(o),0),i=Math.min(i-o*Math.abs(o),z.dataLength))}else{a=Math.max(a+o*Math.abs(o),0)}L.moving(a,i)},m(),f(),this.onResize=function(){i.resize(),o.resize()},this.iHLineO=i,this.hideIUis=v,this.update=function(){b||(g(Number.MAX_VALUE),e&&e.setFloaterData({}))},this.iReset=function(){e.reset&&e.reset()},this.patcher=new function(){var a,i={},o=function(){if(a){e.body.parentNode&&e.body.parentNode.removeChild(e.body);var t="vid_"+z.viewId;if(a[t]){var o;o=i[t]?i[t]:i[t]=new a[t],e=o}else{e=n}}else{e=n}!h(x,e.body)&&x.appendChild(e.body)};this.customFloater=function(e){a=e,o(),t.stc("k_fl",e)},this.switchFloater=o}};L=new M;var W=new function(){var e=this;this.resize=function(e,t){Y.resizeAll(!0,e,t)};var n,a=function(n,a){if(I.hasOwnProperty(n)){for(var i in a){if(a.hasOwnProperty(i)&&t.isFunc(a[i])){return}}"DIMENSION"==n&&($=1),m(I[n],a),t.stc(n,a),e.resize()}},i=function(e,n){var a;if(I.hasOwnProperty(e)){a=t.clone(I[e],null);for(var i in a){if(a.hasOwnProperty(i)){if(t.isFunc(a[i])){a[i]=null,delete a[i]}else{if(n){for(var o=n.length;o--;){typeof a[i]===n[o]&&(a[i]=null,delete a[i])}}}}}}return a},o=function(e,t,n){n=m({toremove:!1,isexclusive:!1,callback:void 0,addon:!1},n||{}),n.toremove?L.mM.removeAC(t,e):n.isexclusive?(L.mM.removeAC(null,e),L.mM.newAC(t,e,n)):L.mM.newAC(t,e,n)};this.setLineStyle=function(e,a){a||(n=e),L.setLineStyle(e),t.stc("k_style",e)},this.showScale=function(e){L.setScale(e),t.stc("k_scale",e)},this.pushData=function(e,n){!t.isArr(e)&&(e=[e]),L.pushData(e,n)};var r,s,c=[],h=function(){if(c.length){var e=c.shift();L.pushData([e],1)}else{clearInterval(s)}},d=function(){s=setInterval(h,1)};this.pushTr=function(e){if(e&&e.data){for(var t,n=e.data.split(","),a=e.symbol,i=e.market,o=0,s=n.length;s>o;o++){t={symbol:a,data:n[o],market:i},c.push(t)}clearTimeout(r),r=setTimeout(d,20)}},this.hide=function(e){P=!0,B.hideIUis(),t.$CONTAINS(A,x)&&A.removeChild(x),e&&L.dcReset()},this.show=function(e){P=!1,e&&(t.isStr(e)&&(e=l(e)),A=e),t.$CONTAINS(A,x)||(A.appendChild(x),Y.resizeAll(!0)),L.outputNewRange(!0),j.onViewPrice()};var u=0,p=!1,f=function(e){var t;switch(e){case 1:t="\u540e\u590d\u6743";break;case -1:t="\u524d\u590d\u6743"}Y.drawReMark(t)},v=[],g=[],y=function(){for(;v.length;){var e=v.pop();g.length--,L.compare(e)}},N=function(){for(var e,t=L.getMainStock().symbol,n=L.getMainStock().market,a=L.getAllStock(),i=a.length;i--;){e=a[i];var o=e.symbol;if(o!=t){var r=e.market;r!=n&&("US"==r||"US"==n||"HK"==r||"HK"==n||"OTC"==r||"OTC"==n||"option_cn"==r||"option_cn"==n)&&(v.push(e),g.push(o))}}g.length&&L.removeCompare(g,!0)},_=function(){p=!1,e.setLineStyle(void 0,!0),e.showScale(void 0),L.mM.togglePt({v:!0,ytd:!0})},k=function(e){"mink"==w.URLHASH.gt(e).type?(z.viewId=e,f(),N()):(e+=u,z.viewId=e,f(u),y())},M=new function(){this.isClMode=!1,this.exitClMode=function(){this.isClMode=!1,e.setLineStyle(n,!0),L.mM.togglePt({v:!0,ytd:!0})},this.enterClMode=function(){this.isClMode=!0;var t=n&&"mountain"==n.linetype?"mountain":"line";e.setLineStyle({linetype:t,linecolor:{K_CL:I.COLOR.T_P}},!0),L.mM.togglePt({v:!1,ytd:!0})}},D=!0;this.showView=function(e,n,a){B.hideIUis(),D?setTimeout(function(){D=!1},99):F.hide();var i=t.isNum(e)?w.URLHASH.vn(e):w.URLHASH.vi(e);if(i){if(p&&_(),i==w.URLHASH.KCL){M.enterClMode()}else{M.isClMode&&M.exitClMode();var o=L.getAllStock(),r=o&&o.length>1;r&&L.mM.togglePt({v:!1})}k(i),L.onChangeView(!1,n),t.stc("k_v",e),!a&&t.suda("vw",e)}};var R=!1;this.showYTD=function(e,n){R=!!e,B.hideIUis(),p||(p=!0,this.setLineStyle({linetype:"line",linecolor:{K_CL:I.COLOR.T_P}},!0),!R&&this.showScale("percent"),L.mM.togglePt({v:!1,ytd:!0})),f(u),L.showYTD(u,R),t.stc("k_v",w.URLHASH.NYTD),!n&&t.suda("vw",w.URLHASH.NYTD)
},this.showYear=function(){this.showYTD(!0)},this.setReK=function(e){if(e=parseInt(e),!(isNaN(e)||Math.abs(e)>1)){u=e;var n=w.URLHASH.gt(z.viewId);t.stc("k_re",e);var a=e;"-1"==a&&(a="_1"),t.suda("k_re","k_re"+a),"mink"!=n.type&&(p?this.showYTD(R,!0):this.showView(n.baseid,void 0,!0))}};var C=function(e){var n;return n=t.isStr(e)?e.split(","):[e.symbol]};this.compare=function(e,n){if(n){for(var a=C(e),i=a.length;i--;){for(var o=g.length;o--;){if(a[i]==g[o]){g.splice(o,1),v.splice(o,1);break}}}L.removeCompare(C(e))}else{L.compare(e),t.suda("k_comp")}t.stc("k_comp",{rm:n,o:e})};var H=0;this.tCharts=function(e,n){o("tech",e,n),n&&!n.noLog&&(0==H?H=1:t.sudaLog())};var O=0;this.pCharts=function(e,n){o("price",e,n),n&&!n.noLog&&(0==O?O=1:t.sudaLog())},this.showPCharts=function(e){e&&(L.mM.togglePt(e),t.stc("k_sp",e))},this.getIndicators=function(){var e=E?E.getLog():null,t=K?K.getLog():null;return{tCharts:e,pCharts:t}},this.getIndicatorData=function(){var e=E?E.getExistingCharts():null,t=K?K.getExistingCharts():null;return{tCharts:e,pCharts:t}};var V;this.showRangeSelector=function(e){V=m({display:!0,from:void 0,to:void 0},e||{}),L.mM.showRs(V),t.stc("k_rs",e)},this.dateFromTo=function(e,n,a){U&&(U.dateFromTo(e,n,a),t.stc("k_ft",[e,n,a]))},this.setCustom=b(a,this,"custom"),this.setTheme=function(e){var t=Y.initTheme(e);t&&(this.setLineStyle({linecolor:e}),this.resize())},this.setDimension=b(a,this,"DIMENSION"),this.getDimension=b(i,null,"DIMENSION",["boolean"]),this.newSymbol=function(e){if(B.hideIUis(),B.iReset(),L.dcReset(),L.dcInit(e),q.hideTip(),E){var n=E.getLog();E=null,n&&this.tCharts(n)}if(K){var a=K.getLog();K=null,a&&this.pCharts(a)}V&&(V.from=void 0,V.to=void 0,L.mM.showRs(V)),L.h5tM.resetHisT(),t.stc("k_ns",e)},this.toggleExtend=function(){var e=I.DIMENSION.extend_draw,t=I.DIMENSION.posX;a.call(this,"DIMENSION",{extend_draw:!e,posX:t>9?7:55}),this.resize()},this.shareTo=function(e){L.shareTo(e),t.stc("k_share",e);var n=e&&e.type?e.type:"weibo";t.suda("share",n)},this.getChartId=function(){return I.uid},this.getSymbols=function(){return L.getAllSymbols()},this.patcher={iMgr:B.patcher},this.getExtraData=function(e){return L.getExtraData(e)},this.getCurrentData=function(){var e=T.get(z.viewId);return e&&(e=e[e.length-1]),t.clone(e,null)},this.getCurrentRange=function(){for(var e,t,n,a=[],i=L.getAllStock(),o=0,r=i.length;r>o;o++){n=i[o],t=n.getName(),e=n.datas,a.push({name:t,rangedata:e,symbol:n.symbol})}return a},this.zoom=function(e){L.zoomApi(e),t.stc("k_zoom",e,9000)},this.rangeMove=function(e,t){L.moving(e,t)},this.move=function(e){e=parseInt(e),isNaN(e)||(L.moveApi(e),t.stc("k_move",e,9000))},this.update=function(){L.updateDataAll(),t.stc("k_up",9000)},this.type="h5k",this.me=S};return L.dcInit(a),W}function i(){this.get=function(e,n){t.stc("h5k_get");var i=new a(e);t.isFunc(n)&&n(i),t.suda("h5k_"+t.market(e.symbol))},this.dual=function(e,n){t.stc("h5k_dual"),e.linetype="line";var i=new a(e);i.setCustom({k_overlay:!0});var o=function(t){i.me.rl(t,o);var n=e.dual;i.compare({symbol:n.symbol,name:n.name,datas:n.datas,linetype:"line",linecolor:n.theme})};i.me.al(w.e.K_DATA_LOADED,o,!1),t.isFunc(n)&&n(i),t.suda("dual_"+t.market(e.symbol))},this.tick=function(e,n){t.stc("h5k_tick"),e.pcm=1,e.view=w.URLHASH.NKMS,e.rate=600,e.linetype="line";var i=new a(e,!0);t.isFunc(n)&&n(i),KKE.api("patch.atick.customfloater",{chart:i},function(e){i.patcher.iMgr.customFloater(e)}),i.setCustom({smooth:!1}),t.suda("tick_"+t.market(e.symbol))}}var o,r,s,l=t.$DOM,c=t.$C,h=t.$CONTAINS,d=t.xh5_PosUtil,u=t.xh5_EvtUtil,m=t.oc,p=t.dateUtil,f=p.stbd,v=t.xh5_ADJUST_HIGH_LOW.c,g=t.xh5_BrowserUtil,b=t.fBind,y=t.strUtil.ps,N=n.xh5_Canvas,w=e.globalCfg,_=t.logoM;return t.fInherit(a,t.xh5_EvtDispatcher),i});