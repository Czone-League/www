xh5_define("datas.t",["utils.util","utils.utility"],function(e,e1){var t=e,a=e.HQ_DOMAIN,r=t.load,n=t.dateUtil,l=t.tUtil,uz=t.uz,jde=((e1&&e1.jde)?e1.jde:function(a){}),i=0==location.protocol.indexOf("https:"),s={isBond:function(e){return/^(sh204\d{3}|sz1318\d{2})$/.test(e)?"bond":/^sh020\d{3}$/.test(e)?"bond":/^sz108\d{3}$/.test(e)?"bond":/^sh(009|010|018)\d{3}$/.test(e)?"bond":/^sz10\d{4}$/.test(e)?"bond":/^sh(100|110|112|113)\d{3}$/.test(e)?"bond":/^sz12\d{4}$/.test(e)?"bond":/^sh(105|120|129|139)\d{3}$/.test(e)?"bond":/^sz11\d{4}$/.test(e)?"bond":!1},us:function(e,t,a){for(var r,n=e.split(";"),l=[],i=0,s=n.length;s>i;i++){var o,c,p,d,u,m=n[i].split(",");0==i?(a?(o=m[1].split(":")[0]+":"+m[1].split(":")[1],c=m[0],p=Number(m[4]),d=Number(m[2]),u=Number(m[5])||Number(m[4])):(u=t.prevclose,o=m[0].split(":")[0]+":"+m[0].split(":")[1],p=Number(m[3]),d=Number(m[1])),r={prevclose:u,d:c,m:o,p:p,v:d,avp:p}):(o=m[0].split(":")[0]+":"+m[0].split(":")[1],p=Number(m[3]),d=Number(m[1]),r={m:o,p:p,v:d,avp:p}),l.push(r),a&&i==s-1&&"16:00">o&&(r={m:"16:00",p:p,v:0,avp:p},l.push(r))}return l},optionCn:function(e,t,a){if(typeof e.length<1){return[]}for(var r,n,i,s,o=l.gata(a),c=[],p=e.length,d=0,u=0;p>d;d++){i=e[d],o[o.length-1]<i.m||(0==u&&Number(i.p)<=0&&(i.p=t.price||t.prevclose),u++,Number(i.p)>0&&(r=Number(i.p)),Number(i.p)<=0&&(i.p=r||0),Number(i.a)>0&&(n=Number(i.a)),Number(i.a)<=0&&(i.a=n||r||0),Number(i.v)<0&&(i.v=0),s={m:i.i,p:Number(i.p),avp:Number(i.a),v:Number(i.v),iy:Number(i.t)},0==d&&(s.d=i.d),c.push(s))}return c},opm:function(){return[]},gbIndex:function(t,a,r,n,i){if(typeof t.length<1){return[]}var s,o,c=l.gata(r,i.time),p=[],d=t.length,u=0;n&&(d=c.length);for(var m,b,v=0,f=0;d>v&&(o=t[v],m=0,0==v&&(m=n?1:4),0==f&&Number(o[1+m])<=0&&(o[1+m]=a.price),!(a.index>0&&!n&&a.index<=e.arrIndexOf(c,o[m])));v++){f++,o&&Number(o[1+m])>0&&(s=Number(o[1+m])),o&&Number(o[1+m])<=0&&(o[1+m]=s||0),o?(u+=Number(o[1+m]),b={m:o[m],p:Number(o[1+m]),avp:u/(v+1),v:0},0==v&&(b.d=o[0],b.prevclose=n?Number(o[m])||b.p:a.prevclose,n&&(o[1+m].split(":").length>1&&(b.p=b.avp=Number(o[3])),isNaN(u)&&(u=Number(o[3]),b.avp=u)))):n&&(b={m:c[v],p:p[p.length-1].p,avp:p[p.length-1].avp,v:0}),p.push(b)}return p},hf:function(t,a,r,n,i){if(typeof t.length<1){return[]}i=i||{time:[["00:00","23:59"]]};var s,o,c=l.gata(r,i.time),p=[],d=t.length,u=0;n&&(d=c.length);for(var m,b,v=0,f=0;d>v&&(o=t[v],m=0,0==v&&(m=n?1:4),0==f&&Number(o[1+m])<=0&&(o[1+m]=a.price),!(a.index>0&&!n&&a.index<=e.arrIndexOf(c,o[m])));v++){f++,o&&Number(o[1+m])>0&&(s=Number(o[1+m])),o&&Number(o[1+m])<=0&&(o[1+m]=s||0),o?(u+=Number(o[1+m]),b={m:o[m],p:Number(o[1+m]),avp:u/(v+1),v:Number(o[2+m])},0==v&&(b.d=o[0],b.prevclose=n?Number(o[m])||b.p:a.prevclose,n&&(o[1+m].split(":").length>1&&(b.p=b.avp=Number(o[3])),isNaN(u)&&(u=Number(o[3]),b.avp=u)))):n&&(b={m:c[v],p:p[p.length-1].p,avp:p[p.length-1].avp,v:p[p.length-1].v}),p.push(b)}return p},fx:function(t,a,r,n,i){if(typeof t.length<1){return[]}i=i||{time:[["00:00","23:59"]]};var s,o,c=l.gata(r,i.time),p=[],d=t.length,u=0;n&&(d=c.length);for(var m,b,v=0,f=0;d>v&&(o=t[v],m=0,0==v&&(m=n?1:4),0==f&&Number(o[1+m])<=0&&(o[1+m]=a.price),!(a.index>0&&!n&&a.index<=e.arrIndexOf(c,o[m])));v++){f++,o&&Number(o[1+m])>0&&(s=Number(o[1+m])),o&&Number(o[1+m])<=0&&(o[1+m]=s||0),o?(u+=Number(o[1+m]),b={m:o[m],p:Number(o[1+m]),avp:u/(v+1),v:Number(o[2+m])},0==v&&(b.d=o[0],b.prevclose=n?Number(o[m])||b.p:a.prevclose,n&&(o[1+m].split(":").length>1&&(b.p=b.avp=Number(o[3])),isNaN(u)&&(u=Number(o[3]),b.avp=u)))):n&&(b={m:c[v],p:p[p.length-1].p,avp:p[p.length-1].avp,v:p[p.length-1].v}),p.push(b)}return p},hk:function(e,t,a){if(typeof e.length<1){return[]}for(var r,n,i,s=l.gata(a),o=[],c=e.length,p=0,d=0,u=0,m=0;c>u;u++){n=e[u],d+=Number(n.a),p+=Number(n.v),n.m&&(n.m=n.m.split(":")[0]+":"+n.m.split(":")[1]),s[s.length-1]<n.m||(0==m&&Number(n.p)<=0&&(n.p=t.price||t.prevclose),m++,Number(n.p)>0&&(r=Number(n.p)),Number(n.p)<=0&&(n.p=r||0),0>=p&&(p=1),i={m:n.m,p:Number(n.p),avp:d/p,v:Number(n.v)},o.push(i))}return o},otc:function(e,t,a){if(typeof e.length<1){return[]}for(var r,n,i,s,o=l.gata(a),c=[],p=e.length,d=0,u=0;p>d;d++){s=e[d];var m=s.m.split(":"),b=m[0]+":"+m[1];o[o.length-1]<b||(0==u&&Number(s.p)<=0&&(s.p=t.price||t.prevclose),u++,Number(s.p)>0&&(r=Number(s.p)),Number(s.p)<=0&&(s.p=r||0),Number(s.avg)>0&&(n=Number(s.avg)),Number(s.avg)<=0&&(s.avg=n||r||0),i={p:Number(s.p),m:b,avp:Number(s.avg),v:Number(s.v)/1000},c.push(i))}return c},futures:function(t,a,r,n,i){if(typeof t.length<1){return[]}for(var s,o,c,p,d,u,m,b,v,f,g=l.gata(r,i.time),h=0,_=[],y=0,N=t.length;N>y;y++){var k=t[y];if(n?(o=k[6],v=Number(k[5])||Number(k[1])):(o=k[6]||a.today,v=Number(k[5])||a.prevclose),a.index>0&&!n&&a.index<=e.arrIndexOf(g,k[0])){break}if(-1!=e.arrIndexOf(g,k[0])||0==y){h++,Number(k[1])>0&&(u=Number(k[1])),Number(k[1])<=0&&(k[1]=u||0),Number(k[2])>0&&(m=Number(k[2])),Number(k[2])<=0&&(k[2]=m||0),Number(k[4])>0&&(b=Number(k[4])),Number(k[4])<=0&&(k[4]=b||0),s=k[0],d=Number(k[3])||0,f=Number(k[4])||0,!n&&t.length<=1&&0==y?(c=Number(k[1])?Number(k[1]):a.price,p=Number(k[2])?Number(k[2]):a.price,v=Number(k[5])||a.prevclose):(c=Number(k[1]),p=Number(k[2]));
var T={d:o,m:s,p:c,avp:p,iy:f,prevclose:v,v:d};_.push(T)}}return n&&_[_.length-1].m<"15:00"&&(T.m="15:00",_.push(T)),_},gdf:function(e,a,r){if(!e||e.length<9||!a){return null}var n=r?e:t.xh5_S_KLC_D(e),l=t.dateUtil.dd(a);0==l.getDay()&&l.setDate(l.getDate()-1);for(var i,s=new Date(l.getFullYear()-3,l.getMonth(),l.getDate()),o=0,c=0,p=0,d=n.length;d>p;p++){i=n[p],i.getTime()<=s.getTime()&&n[p+1].getTime()>=s.getTime()&&(o=p),t.dateUtil.stbd(i,l)&&(c=p+1)}return n.slice(o,c)},c2b:function(e){e=e.replace(" ","+");var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t>=0?t:0},db:function(e){if(!e){return[]}for(var t,a,r=[],n=0,l=0,i=0,s=e.length;s>i;i++){t=this.c2b(e.charAt(i)),a=6&l?7&l^7:5,n|=t>>5-a<<(7^l)-a,64767==n&&63==t&&(n=65535),l>25&&(l-=32,r[r.length]=n,n=0),n|=(t&(1<<5-a)-1)<<(7|l)+4+a,l+=6}return r},fB:function(t,a,r,n){t.splice(360,3);for(var i,s=[],o=l.gata(r),c=3*o.length,p=0,d=0,u=0;c>u;u+=3){d=Math.floor(u/3),a?s[s.length]={time:o[d],price:t[u+1]/1000}:(s[s.length]={time:o[d],avg_price:t[u]/1000,price:t[u+1]/1000,volume:t[u+2]/100},e.isRepos(n.symbol)&&(s[d].avg_price=s[d].price,s[d].volume*=10),/^(hy|gn|dy)\d+/.test(n.symbol)&&(s[d].volume*=100),s[d].volume>0&&(p+=s[d].volume),s[d]&&0==s[d].price&&(0==d?s[d].price=s[d].avg_price=n.prevclose:(s[d].price=s[d-1].price,s[d].avg_price=s[d-1].price)),s[d].avg_price>0&&(i=s[d].avg_price))}return s[0].price<0&&(s[0].price=s[0].avg_price=p=0),a||(s[0].totalVolume=p,s[0].totalAmount=p*i),s[0].index=n.index,s[0].prevclose=n.prevclose,s[0].symbol=n.symbol,s[0].name=n.name,s[0].today=n.today,s[0].date=n.date,s[0].lastfive=n.lastfive,s},ctdf:function(a,r,n,i){for(var s,o,c,p,d=[],u=r,m=0,b=a.length;b>m;m++){d[d.length]=0==m&&""==a[0]?l.gltbt(1,n.prevclose):t.xh5_S_KLC_D(a[m]);var v,f=0;for(d[m].splice(120,1),o=0,c=241;c>o;o++){d[m][o]&&0==d[m][o].price&&(0==o?d[m][o].price=d[m][o].avg_price=d[m][o].prevclose:(d[m][o].price=d[m][o-1].price,d[m][o].avg_price=d[m][o-1].avg_price)),e.isRepos(n.symbol)&&(d[m][o].avg_price=d[m][o].price,d[m][o].volume*=10),v=d[m][o].volume*=0.01,/^(hy|gn|dy)\d+/.test(n.symbol)&&(d[m][o].volume*=100),f+=v}d[m][0].totalVolume=f,d[m][0].prevclose=d[m][0].prevclose||d[m][0].price}var g=d.length;for(g>5&&d.splice(0,g-5),s=[u],g=i.length,m=g-2;m>g-6;m--){for(o=0,p=d.length;p>o;o++){if(t.dateUtil.stbd(d[o][0].date,i[m])){s.unshift(l.azft(d[o],"CN"));break}if(o==d.length-1){var h=s[0][0].prevclose;s.unshift(l.gltbt(1,h)),s[0][0].date=t.dateUtil.dd(i[m]),s[0][0].prevclose=h}}}return s},ctdb:function(t,a,r,n,i,s){for(var o=a,c=[o],p=n.length,d=p-2;d>p-6;d--){c.unshift("HF"==e.market(r.symbol)?l.gltbt(1,r.prevclose,!1,i,[n[d]],s.time):"NF"==e.market(r.symbol)?l.gltbt(1,r.prevclose,!1,i,[n[d]],s.time):"global_index"==e.market(r.symbol)?l.gltbt(1,r.prevclose,!1,i,[n[d]],s.time):l.gltbt(1,r.prevclose,!1,i,[n[d]],s.time))}return c},fund:function(e){var t=[];if(e){for(var a=e.detail.split(","),r=0,n=0,l=a.length;l>n;n+=2){r+=Number(a[n+1]);var i={p:Number(a[n+1]),avp:Number(r/(n/2+1)),m:a[n]};0==n&&(i.prevclose=Number("09:30"==a[n]?e.yes:a[n+1])),t.push(i)}}return t},pkt:function(e,a,r,n,i){if(typeof e.length<1){return[]}var s,o=!1,c=e,p=l.s0(a.date.getHours())+":"+l.s0(a.date.getMinutes());switch(r){case"forex":s=l.gata(r,i.time);break;case"HF":s=l.gata(r,i.time),c.length<=0&&c.push({d:a.today,price:a.price,prevclose:a.prevclose}),c[0].d<a.today&&p>i.time[0][0]&&(p=i.time[i.time.length-1][1]);break;case"NF":s=l.gata(r,i.time);break;case"global_index":s=l.gata(r,i.time);break;default:s=l.gata(r)}for(var d,u=[],m=0,b=0,v=s.length;v>b;b++){if(d={},u[u.length]=d,d.time=s[b],d.volume=d.price=-1,d.avg_price=-1,p){if(o&&!n){continue}p==d.time&&(o=!0)}for(var f=s[0],g=m,h=c.length;h>g;g++){var _=c[g],y=String(_.m).substring(0,5);if(y==s[b]){y==f&&(d.symbol=a.symbol,d.name=a.name,n?(d.prevclose=Number(e[0].prevclose)||Number(e[0].p),d.date=t.dateUtil.sd(e[0].d),d.today=e[0].d):(d.prevclose=a.prevclose,"HF"==r||"NF"==r?(d.date=t.dateUtil.sd(e[0].d)||a.date,d.today=e[0].d||a.today):(d.date=a.date,d.today=a.today)),"fund"==r&&(d.prevclose=e[0].prevclose)),d.volume=_.v||0,d.avg_price=_.avp,d.price=_.p,_.iy&&(d.inventory=_.iy),c.splice(g,1);break}y>s[b]||"NF"==r&&"21:00"==f&&d.time>"21:00"&&y<s[b]?(0==b?n?(d.price=e[0].p,d.prevclose=e[0].prevclose||d.price,d.avg_price=e[0].avp,d.date=t.dateUtil.sd(e[0].d),d.today=e[0].d):(d.price=a.open||a.prevclose,d.prevclose=a.prevclose,d.avg_price=d.price,d.symbol=a.symbol,d.name=a.name,"NF"==r?(d.date=t.dateUtil.sd(e[0].d)||a.date,d.today=e[0].d||a.today):(d.date=a.date,d.today=a.today)):(d.price=u[b-1].price,d.avg_price=u[b-1].avg_price,("option_cn"==r||"op_m"==r||"NF"==r)&&(d.inventory=u[b-1].inventory)),d.volume=-0.01):0!=b||n||(d.price=e[g].p||a.open||a.prevclose,d.prevclose=a.prevclose,d.avg_price=e[g].avp||d.price,d.symbol=a.symbol,d.name=a.name,d.volume=0,"HF"==r||"NF"==r?(d.date=t.dateUtil.sd(e[0].d)||a.date,d.today=e[0].d||a.today):(d.date=a.date,d.today=a.today))}}return u[0].index=v-1,u
}};return new function(){this.VER="2.6.1";var o="klc_td_sh.txt",c={CN:{T_Head_STR:"hq_str_",T_URL:__quoteapi+"?token="+__token+"&_m=r&_=$rn&list=$symbol",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o,HISTORY_DATA_URL:"/realstock/company/$symbol/hisdata/$y/$m.js?d=$date",},option_cn:{T_Head_STR:"t1",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o},op_m:{T_Head_STR:"t1",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o},US:{T_Head_STR:"t1",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:"/usstock/api/openapi.php/US_MinKService.getTradeDays?&start_day=$start&end_day=$end&callback=$cb="},HK:{T_Head_STR:"t1",T_URL:__quoteapi+"/api.ashx?_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"/api.ashx?_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"/api.ashx?_m=lst5&symbol=$symbol",HISTORY_DATA_URL:"/realstock/company/$symbol/hisdata/$y/$m.js?d=$date",TRADING_DATES_URL:o},fund:{T_Head_STR:"t1",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o},global_index:{T_Head_STR:"t1",T_URL:__quoteapi+"/api.ashx?"+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"/api.ashx?"+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"/api.ashx?"+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o},CFF:{T_Head_STR:"t1",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o},OTC:{T_Head_STR:"t1",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o},NF:{T_Head_STR:"t1",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o},HF:{T_Head_STR:"t1",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",HISTORY_DATA_URL:"/realstock/company/$symbol/hisdata/$y/$m.js?d=$date",TRADING_DATES_URL:o},forex:{T_Head_STR:"t1",T5_Head_STR:"t5",T_URL:__quoteapi+"?token="+__token+"&_m=t1&symbol=$symbol&cb=$cb",T5_URL:__quoteapi+"?token="+__token+"&_m=t5&symbol=$symbol&cb=$cb",LAST5_URL:__quoteapi+"?token="+__token+"&_m=lst5&symbol=$symbol",TRADING_DATES_URL:o}},p={},d=0,u=function(t,a,r){var n=e.market(a),l=c[n][r];return(i||t)&&(l=e.getSUrl(l)),l},m=0;this.get=function(a,n){var i,o,v,f=a.symbol,g=e.market(f),h=a.date,_=a.withT5,y=a.withI,N=a.ssl;m=a.dist5;var k={msg:null,data:{td1:null,td5:null,hq:null}};switch(v=i=f,g){case"HK":f="rt"==f.substring(0,2)?f.slice(3):f,i=f,o=i.replace("hk","");break;case"US":v+=","+f+",gb_ixic,sys_time",i=o=f.replace("gb_",""),o=o.replace("$","."),i=i.replace(".","");break;case"OTC":o=f.replace("sb","");break;case"fund":o=f.replace("fu_","");break;case"CFF":o=f.replace("CFF_RE_","");break;case"CN":o="ml_"+f;break;case"global_index":o=f.replace("znb_","");break;case"op_m":o=i=f.replace("P_OP_","");break;case"HF":o=f.replace("hf_","");break;case"NF":o=f.replace("nf_","");break;default:o=f}var T=function(e){var t,a,r;return h?(r=h.split("-")[1]||"01",a=h.split("-")[0],h.split("-")[1]&&Number(h.split("-")[1])<10&&(r="0"+Number(h.split("-")[1]),h=a+"-"+r+"-"+h.split("-")[2]),t="MLC_"+f+"_"+a+"_"+r,{lc:t,year:a,month:r}):(h=e,null)},$=function(e){r(u(N,f,"HISTORY_DATA_URL").replace("$symbol",f).replace("$y",e.year).replace("$m",e.month).replace("$date",h),function(){var a=String(window[e.lc]);if(window[e.lc]=null,k.msg="history",a){for(var i,o,c,d,m=String(a).split(","),b=[],v=m.length,_=l.gata(g),y=0;v>y;y++){b[y]=t.xh5_S_KLC_D(m[y]),i=b[y].shift(),b[y][0].prevclose=i.prevclose,b[y][0].date=i.date,b[y].splice(120,1),o=0;for(var T=0;241>T;T++){c=b[y][T].volume/=100,o+=c,b[y][T].time=_[T]}var $=t.dateUtil.ds(i.date);$==h&&(d=b[y]),b[y][0].totalVolume=o}if(b.length<5){return void r(u(N,f,"TRADING_DATES_URL"),function(){for(var a=window.datelist,r=b.length,i=s.gdf(a,t.dateUtil.sd(h)),o=5-r;o>0;o--){b.unshift(l.gltbt(1,b[0][0].price,!1,g,[i[i.length-5+o]]))
}k.data.td1=d,k.data.td5=b,p[f+e.year+e.month]=k,t.isFunc(n)&&n(k)},null,{symbol:f,market:g,type:"tradedate"})}k.data.td1=d,k.data.td5=b,p[f+e.year+e.month]=k,t.isFunc(n)&&n(k)}},function(){k.msg="nohistory",t.isFunc(n)&&n(k)},{market:g,symbol:f,type:"historydata"})},U=function(e){return p[f+e.year+e.month]?void (t.isFunc(n)&&n(p[f+e.year+e.month])):void $(e)},R=function(e,t,a){var r;switch(g){case"OTC":r=s.otc(e.result.data,t,g);break;case"US":r=s.us(String(e),t);break;case"HK":r=s.hk(e.result.data,t,g);break;case"fund":r=s.fund(e);break;case"CFF":r=s.futures(e,t);break;case"global_index":r=s.gbIndex(e,t,g,!1,a);break;case"NF":r=s.futures(e,t,g,!1,a);break;case"option_cn":r=s.optionCn(e.result.data,t,"CN");break;case"op_m":r=s.opm(e.result.data,t,"CN");break;case"CN":r=s.db(e);break;case"forex":r=s.fx(e.result.data.minLine_1d,t,g,!1,a);break;case"HF":r=s.hf(e.result.data.minLine_1d,t,g,!1,a);break}if("CN"==g){r=s.fB(r,!1,g,t)}else{r=s.pkt(r,t,g,!1,a)}return r},fdt=function(s){var dw=window["dw"+s]||0;var cd=window["cd"+s]||[];td=(new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()));o=[];var ds0=td.getTime(),ds1=(ds0-86400000*30);while(ds1<=ds0){td=new Date(ds1);if(((dw>=2)||(dw==1&&td.getDay()!=0)||(dw==0&&6!=td.getDay()&&0!=td.getDay()))&&cd.indexOf(td.getDate())<0){o.push(new Date(td))}ds1=(ds1+86400000)}return o},F=function(l,c,p){var d=fdt(l.symbol);b(l,f,c,d,"forex",n,a.dataformatter,N,null,null,p)},S=function(e,a){r(e,function(){var e=window[c[g].T_Head_STR+i];window[c[g].T_Head_STR+i]=null;try{e=JSON.parse(jde(e,36,uz))}catch(ex){e=null}if(""==e||undefined==e||e.result==null||e.result==undefined){e={result:{data:{time:[["00:00","23:59"]],dl:1440,dw:1,cd:[]}}}}else{if(e.result.data==null||e.result.data==undefined){e.result.data={time:[["00:00","23:59"]],dl:1440,dw:1,cd:[]}}}var r,s=o=p={time:e.result.data.time};window["time"+i]=e.result.data.time,window["dl"+i]=e.result.data.dl,window["dw"+i]=e.result.data.dw,window["cd"+i]=e.result.data.cd;if(""==e||null==e||undefined==e.result||null==e.result||null==e.result.data||undefined==e.result.data||null==e.result.data.minLine_1d||undefined==e.result.data.minLine_1d||e.result.data.minLine_1d.length<=0||e.__ERROR){switch(k.msg="empty",g){case"forex":r=l.gltbt(1,a.prevclose,!0,g,[a.date],s.time);break;case"HF":r=l.gltbt(1,a.prevclose,!0,g,[a.date],s.time);break;case"NF":r=l.gltbt(1,a.prevclose,!0,g,[a.date],o.time);break;case"global_index":r=l.gltbt(1,a.prevclose,!0,g,[a.date],p.time);break;default:r=l.gltbt(1,a.prevclose,!0,g)}}else{switch(k.msg="",g){case"HF":var u=a.today.split("-"),m=u[0]+"-"+(Number(u[1])<10?"0"+u[1]:u[1])+"-"+(Number(u[2])<10?"0"+u[2]:u[2]);r=m<e.result.data.minLine_1d[0][0]?l.gltbt(1,a.prevclose,!0,g,null,s.time):R(e,a,s),"hf_ES"==a.symbol&&a.time>s.time[0][0]&&!t.dateUtil.stbd(r[0].date,a.date)&&(r=l.gltbt(1,a.prevclose,!0,g,[a.date],s.time));break;case"forex":r=R(e,a,p);break;case"NF":r=R(e,a,o);break;case"global_index":r=R(e,a,p);break;default:r=R(e,a)}}if(r&&!r[0].date&&(r[0].date=a.date),k.data.td1=r,!_){return 0!=d&&(r[0].lastfive=d),void (t.isFunc(n)&&n(k))}switch(g){case"HF":F(a,r,s);break;case"forex":F(a,r,s);break;case"NF":F(a,r,o);break;case"global_index":F(a,r,p);break;default:F(a,r)}},function(){},{market:g,symbol:a.symbol,type:"t1"})},jdc=function(a,m){return jde(a)},w=function(){KKE.api("datas.hq.get",{symbol:v,withI:y,cancelEtag:!0,ssl:N},function(e){var a=e.data[0];if(k.data.hq=a,a.name||(a.name=v),!a.name&&"CFF"!=g){return k.msg="error",void (t.isFunc(n)&&n(k))}var r=u(N,f,"T_URL").replace("$rn",(new Date).getTime()).replace("$symbol",o).replace("$cb","var t1"+i),l=T(a.today);return t.dateUtil.stbd(t.dateUtil.sd(a.today),t.dateUtil.sd(h))?void S(r,a):void U(l)})};w()};var b=function(e,a,i,o,c,p,b,v,f,g,h){var _={msg:null,data:{td1:null,td5:null,hq:null}};if(_.data.hq=e,_.data.td1=i,e.name||(e.name=e.symbol),!e.name&&"CFF"!=c){return _.msg="error",void (t.isFunc(p)&&p(_))}var y=function(){var l,m=a.replace("hk","");r(u(v,a,"T5_URL").replace("$symbol",m).replace("$cb","var __hkT5"),function(){var m=window.__hkT5,b=m.result.data;b&&b.length>0?(b.forEach(function(e){var t=0;e.forEach(function(t,a){"12:00:00"==t.m&&e.splice(a,1)}),e.forEach(function(e,a){var r=e.m.split(":");e.date&&(e.today=e.date,e.date=n.sd(e.date)),e.prevclose&&(e.prevclose=Number(e.prevclose)),e.time=r[0]+":"+r[1],e.price=Number(e.price),e.volume=Number(e.volume),t+=Number(e.price),e.avg_price=Number(t)/(a+1)})}),b.length<=4?(l=s.ctdb(5,i,e,o,c),l.forEach(function(e){b.forEach(function(t){e[0].date==t[0].date&&(e=t)})}),_.data.td5=l):(n.stbd(b[b.length-2][0].date,i[0].date)&&(i[0].today=b[b.length-1][0].today,i[0].date=b[b.length-1][0].date),b[b.length-1]=i,_.data.td5=b)):(l=s.ctdb(5,i,e,o,c),_.data.td5=l);var f="lastfive"+a,g=a.substring(2);r(u(v,a,"LAST5_URL").replace("$rn",(new Date).getHours()).replace("$symbol",g).replace("$cb","var "+f+"="),function(){var e=window[f];return e?(_.data.td5[4][0].lastfive=d=Number(e.volume),void (t.isFunc(p)&&p(_))):void (t.isFunc(p)&&p(_))
},function(){_.data.td5=l,t.isFunc(p)&&p(_)},{symbol:e.symbol,market:c,type:"lastfive"})})},N=function(){r(u(v,a,"T5_URL").replace("$rn",(new Date).getTime()).replace("$symbol",g).replace("$cb","var t5"+f+"="),function(){var r=String(window["t5"+f]),n=[],d=r.split(" ");d.shift();for(var u=d.length;u--;){var m=s.us(d[u],e,!0);d[u]=s.pkt(m,e,c,!0)}if(window["t5"+a]=null,""==r){_.msg="empty"}else{_.msg="";var b=o.length,v=0,g=d.length,h=[];for(u=b-1;u>b-6;u--){h.unshift(l.gltbt(1,e.prevclose,!1,"US",[o[u]]))}for(u=b-1;u>b-6;u--){for(var y,N=0,k=0;g>k;k++){t.dateUtil.stbd(o[u],d[k][0].date)&&(y=d[k],N=1,v=k)}0==N&&(y=l.gltbt(1,h[v][0].prevclose,!1,"US",[o[u]])),n.unshift(y)}}n[4]=i,_.data.td5=n,t.isFunc(p)&&p(_)},null,{market:c,symbol:e.symbol,type:"t5"})},FX=function(){r(u(v,a,"T5_URL").replace("$rn",(new Date).getTime()).replace("$symbol",a).replace("$cb","var t5"+a),function(){var m=String(window["t5"+a]),o=[],r;window["t5"+a]=null;try{r=JSON.parse(jde(m,36,uz))}catch(ex){r=null}if(m=null,(""==r||null==r||undefined==r||r.result==undefined)){_.msg="empty"}else{n={time:r.result.time||[["00:00","23:59"]]};window["time"+a]=n.time,window["dw"+a]=r.result.dw||1,window["dl"+a]=r.result.dl||1440,window["cd"+a]=r.result.cd||[];if(void 0==r){return _.msg="data error.",void T()}_.msg="";for(var d=[],u=r.result.data.length,m=0;u>m;m++){var b=s.fx(r.result.data[m],e,c,"his",n);if(!t.dateUtil.stbd(t.dateUtil.sd(b[0].d),e.date)){var v=s.pkt(b,e,c,!0,n);d.push(v)}}for(var f=[],g=i[0].date||e.date,h=1;f.length<6;){var y=new Date(g);y.setDate(g.getDate()-h);if(((r.result.dw>=2)||(r.result.dw==1&&y.getDay()!=0)||(r.result.dw==0&&6!=y.getDay()&&0!=y.getDay()))&&r.result.cd.indexOf(y.getDate())<0){f.push(y)}h++}var N,k=f.length,$=1;for(m=0;k>m;m++){for(N=$;N<=d.length&&!(o.length>3);N++){if(t.dateUtil.stbd(d[d.length-N][0].date,f[m])){o.unshift(d[d.length-N]),$++;break}if(N==d.length-1){for(var U=0,R=1;R<=d.length;R++){t.dateUtil.stbd(d[d.length-R][0].date,f[m])&&(U=1)}0==U&&o.unshift(l.gltbt(1,d[d.length-1][0].prevclose,!1,c,[f[m]],n.time))}}$>=d.length&&o.length<=3&&!t.dateUtil.stbd(o[0][0].date,f[m])&&o.unshift(l.gltbt(1,d[d.length-1][0].prevclose,!1,c,[f[m]],n.time))}}o[4]=i,_.data.td5=o,t.isFunc(p)&&p(_)},null,{market:c,symbol:e.symbol,type:"t5"})},k=function(n){var l="CFF_RE_"==a.substring(0,7)?a.slice(7):a;r(u(v,a,"T5_URL").replace("$rn",(new Date).getTime()).replace("$symbol",l).replace("$cb","var t5"+a),function(){var r=window["t5"+a],l=[];if(window["t5"+a]=null,""==r){_.msg="empty"}else{if(void 0==r){return _.msg="data error.",void T()}_.msg="";for(var o=[],d=r.length,u=0;d>u;u++){var m=s.futures(r[u],e,c,"his",n);if(!t.dateUtil.stbd(t.dateUtil.sd(m[0].d),e.date)){var b=s.pkt(m,e,c,!0);o.push(b),l.push(b)}}}l[4]=i,_.data.td5=l,t.isFunc(p)&&p(_)},null,{market:c,symbol:e.symbol,type:"t5"})},T=function(a){_.data.td5=s.ctdb(5,i,e,o,c,a),t.isFunc(p)&&p(_)},$=function(n){r(u(v,a,"T5_URL").replace("$symbol",a.replace("nf_","")).replace("$cb","var t5"+a),function(){var r=window["t5"+a],d=[];if(window["t5"+a]=null,""==r){_.msg="empty"}else{if(void 0==r){return _.msg="data error.",void T()}_.msg="";for(var u=[],m=r.length,b=0;m>b;b++){var v=s.futures(r[b],e,c,"his",n);if(!t.dateUtil.stbd(t.dateUtil.sd(v[0].d),e.date)||"21:00"==n.time[0][0]&&e.time>="21:00"||e.time<="02:30"){var f=s.pkt(v,e,c,!0,n);u.push(f)}}m=5;var g;g="21:00"==n.time[0][0]&&e.time>="21:00"||e.time<="02:30"?5:6;var h=o.splice(o.length-g,5),y=0;for(b=m-1;b>=0;b--){for(var N=y;N<u.length&&!(d.length>3);N++){if(t.dateUtil.stbd(u[u.length-N-1][0].date,h[b])){d.unshift(u[u.length-N-1]),y++;break}if(N==u.length-1){for(var k=0,$=0;$<u.length;$++){t.dateUtil.stbd(u[u.length-$-1][0].date,h[b])&&(k=1)}0==k&&d.unshift(l.gltbt(1,u[u.length-1][0].prevclose,!1,c,[h[b]],n.time))}}if(u.length<=0){if(d.length>3){break}d.unshift(l.gltbt(1,e.prevclose,!1,c,[h[b]],n.time))}else{y==u.length&&d.length<4&&d.length>0&&!t.dateUtil.stbd(d[0][0].date,h[b])&&d.unshift(l.gltbt(1,u[u.length-1][0].prevclose,!1,c,[h[b]],n.time))}}}d[4]=i,_.data.td5=d,t.isFunc(p)&&p(_)},null,{market:c,symbol:e.symbol,type:"t5"})},U=function(n){r(u(v,a,"T5_URL").replace("$symbol",a.replace("hf_","")).replace("$cb","var t5"+a),function(){var r=window["t5"+a],o=[];if(window["t5"+a]=null,""==r){_.msg="empty"}else{if(void 0==r){return _.msg="data error.",void T()}_.msg="";for(var d=[],u=r.result.data[a.replace("hf_","")].length,m=0;u>m;m++){var b=s.hf(r.result.data[a.replace("hf_","")][m],e,c,"his",n);if(!t.dateUtil.stbd(t.dateUtil.sd(b[0].d),e.date)){var v=s.pkt(b,e,c,!0,n);d.push(v)}}for(var f=[],g=i[0].date||e.date,h=1;f.length<6;){var y=new Date(g);y.setDate(g.getDate()-h),6!=y.getDay()&&0!=y.getDay()&&f.push(y),h++}var N,k=f.length,$=1;for(m=0;k>m;m++){for(N=$;N<=d.length&&!(o.length>3);N++){if(t.dateUtil.stbd(d[d.length-N][0].date,f[m])){o.unshift(d[d.length-N]),$++;break}if(N==d.length-1){for(var U=0,R=1;R<=d.length;R++){t.dateUtil.stbd(d[d.length-R][0].date,f[m])&&(U=1)}0==U&&o.unshift(l.gltbt(1,d[d.length-1][0].prevclose,!1,c,[f[m]],n.time))
}}$>=d.length&&o.length<=3&&!t.dateUtil.stbd(o[0][0].date,f[m])&&o.unshift(l.gltbt(1,d[d.length-1][0].prevclose,!1,c,[f[m]],n.time))}}o[4]=i,_.data.td5=o,t.isFunc(p)&&p(_)},null,{market:c,symbol:e.symbol,type:"t5"})},R=function(){r(u(v,a,"T5_URL").replace("$rn",(new Date).getTime()).replace("$symbol",a).replace("$cb","var t5"+a),function(){var r=window["t5"+a],n=o.length,c=[];if(window["t5"+a]=null,""==r){_.msg="empty"}else{_.msg="";for(var d=r.result.data.length,u=0;d>u;u++){var m=s.optionCn(r.result.data[u],e,"CN"),b=s.pkt(m,e,"CN",!0);c.push(b)}var v=c[0]?c[0][0].prevclose:e.prevclose;for(u=n-1-d;u>n-6;u--){c.unshift(l.gltbt(1,v,!1,"CN",[o[u]]))}}c[4]=i,_.data.td5=c,t.isFunc(p)&&p(_)},null,{market:c,symbol:e.symbol,type:"t5"})},F=function(){r(u(v,a,"T5_URL").replace("$symbol",a).replace("$rn",e.today),function(){var n="lastfive"+a,l=window["KLC_ML_"+a];window["KLC_ML_"+a]=null;var m,b;""==l?(_.msg="empty",m=s.ctdb(5,i,e,o,c)):(_.msg="",b=l.split(","),m=s.ctdf(b,i,e,o)),s.isBond(a)?(_.data.td5=m,t.isFunc(p)&&p(_)):r(u(v,a,"LAST5_URL").replace("$rn",(new Date).getHours()).replace("$symbol",a),function(){var a=window[n];if(!a||!a.lastfive){return _.data.td5=m,void (t.isFunc(p)&&p(_))}for(var r=a.lastfive.length;r--;){for(var l=a.lastfive[r].d,i=m.length-1;i--;){if(t.dateUtil.stbds(m[i][0].date,l,null)){m[i][0].lastfive=Number(a.lastfive[r].c);break}}}d=e.lastfive?e.lastfive:0,_.data.td5=m,t.isFunc(p)&&p(_)},function(){_.data.td5=m,t.isFunc(p)&&p(_)},{market:c,symbol:e.symbol,type:"lastfive"})},function(){_.data.td5=s.ctdb(5,i,e,o,c),_.msg="error",t.isFunc(p)&&p(_)},{market:c,symbol:e.symbol,type:"t5"})};switch(c){case"HK":y();break;case"US":N();break;case"CFF":k(h);break;case"OTC":case"fund":T();break;case"NF":0==m?T(h):$(h);break;case"option_cn":R();break;case"global_index":T(h);break;case"op_m":T();break;case"CN":F();break;case"forex":FX(f);break;case"HF":0==m?T(h):U(h);break;case"":}}}});xh5_define("chart.h5t",["cfgs.settinger","utils.util","utils.painter"],function(e,t,a){function i(i){function n(e,a){function n(e){q.setDataRange(e),N&&(N.linkData(e),N.setDataRange()),k&&(k.linkData(e),k.setDataRange()),x&&(x.linkData(e),x.setDataRange())}function c(){a&&(B=U),de.update(null,!0),"CN"===p&&!/^(sh0|sh1|sh5|sz1|sz399)\d+/i.test(e.symbol)}e=u({symbol:void 0,datas:{t1:{url:void 0,dataformatter:void 0},t5:{url:void 0,dataformatter:void 0}},linecolor:void 0,linetype:void 0},e||{});var d,h=this,p=t.market(e.symbol),b=function(e){switch(e){case"CN":return 1;case"HK":return 2;case"US":return 3}return 1};this.business=e.business;var y=!0;this.dp=e.dp,this.marketNum=b,this.isErr=!1,this.witht5=!0,this.symbol=e.symbol,this.isMain=a,this.isCompare=!1,this.dAdd=0,this.uid=e.symbol+Math.random(),this.datas=null,this.dataLen=0,this.dataLenOffset=0,this.prevclose=void 0,this.labelMaxP=0,this.maxPrice=0,this.labelMinP=Number.MAX_VALUE,this.minPrice=Number.MAX_VALUE,this.labelMaxVol=0,this.maxVolume=0,this.minPercent=Number.MAX_VALUE,this.maxPercent=-Number.MAX_VALUE,this.labelPriceCount=void 0,this.isTotalRedraw=!0,this.realLen=0,this.market=p,this.date=null,this.hq=null,this.futureTime=T||D||I,this.gbiTime=I,this.preData={data:0,vPos:null},this.needMarket=p,this.changeMarket=function(e){var a,i=[],n=e;if(H=A.tcd(M),b(h.needMarket)!=b(M)){a=U.get(),d=t.tUtil.gata(M);for(var r=0;r<a.length;r++){b(h.needMarket)<b(M)?(i.push(A.aduk(a[r],h.market,M,C,a[r][0].date)),h.realLen=t.arrIndexOf(d,C.getHours()+":"+t.strUtil.zp(C.getMinutes())),h.realLen<0&&(h.realLen=H)):(i.push(A.rmuk(a[r],M,n)),h.realLen=t.arrIndexOf(d,C.getHours()+":"+t.strUtil.zp(C.getMinutes())))}h.needMarket=M,U.initTState(i),h.datas=i[4],q.setDataRange(),q.createPlayingData()}};var N,k,x,L,C,F=new w(this,e);this.getName=function(){return L||""},this.getStockType=function(){var e;return h.hq&&(e=h.hq.type),e||""},this.viewState=J;var U=new function(){var a={},n={rsAmount:void 0},r=function(e){if(e){var n,r=e.length,o=[];if(t.clone(e,o),o.length>5){if(i.date){for(var s,l=Number(i.date.split("-")[2]),c=0,d=0,h=0,m=o.length;m>h;h++){s=o[h][0].date.getDate(),0==h?c=Math.abs(s-l):c>Math.abs(s-l)&&(c=Math.abs(s-l),d=h)}d>=5?(n=o.splice(d-4,5),J.start=4,J.end=5):(n=o.splice(0,5),J.start=d,J.end=d+1),a.tv=J.start,a.tb=J.end}}else{n=o,a.tv=i.date?0:4,a.tb=r}a.t=n}};this.get=function(e){return e?a[e]:a.t},this.set=function(e,t){"undefined"!=typeof a[e]&&(a[e]=t)},this.initState=r,this.initTState=function(e){r(e)},this.extraDataObj=n,this.initExtraData=function(){var a=i.ssl?"https":"http",r=a+"/stock/api/jsonp.php/$cb/StockService.getAmountBySymbol?_=$rn&symbol=$symbol",o="KKE_ShareAmount_"+e.symbol;t.load(r.replace("$symbol",e.symbol).replace("$rn",String((new Date).getDate())).replace("$cb","var%20"+o+"="),function(){var e=window[o];if(e){for(var t,a=[],i=e.length;i--;){t=e[i],a.push({amount:Number(t.amount),date:f.sd(t.date)})}a.length&&(n.rsAmount=a)}})},this.gc=function(){a=null,n=null}},q=new function(){var e,t,a;e=function(){h.minPrice=Number.MAX_VALUE,h.maxPrice=0,h.minPercent=Number.MAX_VALUE,h.maxPercent=-Number.MAX_VALUE,h.minavgPrice=Number.MAX_VALUE,h.maxavgPrice=0,h.maxVolume=0
},t=function(){function e(e){var t=Math.max(Math.abs(e-h.maxPrice),Math.abs(e-h.minPrice)),a=Math.max(Math.abs(e-h.maxavgPrice),Math.abs(e-h.minavgPrice));switch(t/e>0.45&&"US"!=M&&(E.datas.scaleType="price"),t/e>0.1&&"newstock"==E.datas.scaleType&&(E.datas.scaleType="price"),E.datas.scaleType){case"newstock":h.minPrice=Number(e)-0.45*e,h.maxPrice=Number(e)+0.45*e;break;case"tpct":h.minPrice=h.minPrice<Number(e)-0.1*e?h.minPrice:Number(e)-0.1*e,h.maxPrice=h.maxPrice>Number(e)+0.1*e?h.maxPrice:Number(e)+0.1*e;break;case"pct":var i=h.maxPrice-h.minPrice;h.minPrice-=0.05*i,h.maxPrice+=0.05*i;break;case"price":default:h.minPrice=Number(e)-Number(t),h.maxPrice=Number(e)+Number(t),h.minavgPrice=Number(e)-Number(a),h.maxavgPrice=Number(e)+Number(a)}h.maxPercent=Math.max((h.maxPrice-e)/e,0),h.minPercent=Math.min((h.minPrice-e)/e,0),h.maxavgPercent=Math.max((h.maxavgPrice-e)/e,0),h.minavgPercent=Math.min((h.minavgPrice-e)/e,0)}h.isCompare=X.getAllStock().length>1,h.dAdd=X.dAdd;var t;h.datas&&0==h.datas[0][0].volume&&h.hq.time>"09:30"&&"CN"==h.market&&(t=h.datas[0][0].price),h.preData.data=h.hq.preopen?t?t:h.hq.preopen:h.preData.data;for(var a=0,n=h.datas.length;n>a;a++){for(var r,o=Number(h.datas[0][0].prevclose),s=0,l=h.dataLen;l>s;s++){r=h.datas[a][s],r.price<=0||r.avg_price<=0||("HK"==h.market&&h.hq&&"indx"==h.hq.type?(h.maxPrice=Math.max(h.maxPrice,r.price,o),h.minPrice=Math.min(h.minPrice,r.price,o)):v(h.datas[a][0].date,h.hq.date)&&"CN"==h.market?(h.maxPrice=Math.max(h.maxPrice,r.price,r.avg_price,o,h.preData.data),h.minPrice=Math.min(h.minPrice,r.price,r.avg_price,o,h.preData.data)):(h.maxPrice=Math.max(h.maxPrice,r.price,r.avg_price,o),h.minPrice=Math.min(h.minPrice,r.price,r.avg_price,o)),v(h.datas[a][0].date,h.hq.date)&&"CN"==h.market?(h.maxavgPrice=Math.max(h.maxavgPrice,r.price,o,h.preData.data),h.minavgPrice=Math.min(h.minavgPrice,r.price,o,h.preData.data)):(h.maxavgPrice=Math.max(h.maxavgPrice,r.price,o),h.minavgPrice=Math.min(h.minavgPrice,r.price,o)),h.labelMaxVol=h.maxVolume=Math.max(h.maxVolume,0,r.volume))}e(o)}(h.minPrice<-100000000||h.maxPrice-h.minPrice<0.000001)&&(f.stbd(h.datas[0][0].date,h.hq.date)&&(h.datas[0][0].price=h.hq.price,h.datas[0][0].avg_price=h.hq.price,h.datas[0][0].prevclose=h.hq.prevclose,h.datas[0][0].volume=h.hq.totalVolume),h.minPrice=o-0.01*o,h.maxPrice=o+0.01*o,h.maxPercent=0.01,h.minPercent=-0.01,h.hq.totalVolume>0&&f.stbd(h.datas[0][0].date,h.hq.date)&&!isNaN(h.hq.totalAmount)&&(h.datas[0][0].volume=h.hq.totalAmount/h.hq.totalVolume));var c=g(h.maxVolume,0,0,!0);h.labelMaxVol=c[0];var d,m=0.005;/^s[hz]51\d{4}$/.test(i.symbol)&&(d="fund"),d&&"fund"===d&&"pct"!==E.datas.scaleType&&m>Math.abs(h.minPercent)&&(m=Math.abs(h.minPercent),i.nfloat=h.nfloat=3),h.maxPercent<m&&"US"!==h.market&&"pct"!==E.datas.scaleType&&(h.minPrice=h.maxavgPrice=o-o*m,h.maxPrice=h.minavgPrice=o+o*m,h.maxPercent=h.maxavgPercent=m,h.minPercent=h.minavgPercent=-m),("gb_brk$a"===h.symbol||"usr_brk$a"===h.symbol)&&(i.nfloat=h.nfloat=1)},a=function(){var e,t,a,i=E.DIMENSION.h_t,n=i*E.DIMENSION.P_HV,r=i*(1-E.DIMENSION.P_HV);t=h.labelMinP,a=h.labelMaxP;var o,s=h.labelMaxVol;if(h.datas){var l=h.datas.length;for(e=0;l>e;e++){o=h.datas[0][0].prevclose;for(var c,d=E.custom.show_underlay_vol,p=h.isCompare?"ppp":"pp",u=h.dataLen,f=0;u>f;f++){if(c=h.datas[e][f],!c){return}c.price<=0&&h.realLen>=f&&f>0&&(c.price=h.hq.price,c.avg_price=h.datas[e][f-1].avg_price,c.volume=0),c.change=c.price-o,c.percent=c.change/o,c.py=m[p](c.price,t,a,i,o),c.ay=m[p](c.avg_price,t,a,i,o),d&&(c.vy=m.vp(c.volume,s,n)+r)}}h.preData.vPos="CN"==h.market&&1==l&&v(h.hq.date,h.datas[0][0].date)?m[p](h.preData.data,t,a,i,o):null}},this.createPlayingData=a,this.extValues=function(){e(),t()},this.setDataRange=function(a){var i=U.get();if(i){J.dataLength=i.length;var n=J.start,r=J.end;isNaN(n)||isNaN(r)?(r=U.get("tb")||5,n=U.get("tv")||4,J.start=n,J.end=r):(a&&r+1>i.length&&(J.end=r=i.length),U.set("tv",n),U.set("tb",r));var o=[],s=[];if(i.length<2){s=i,o.push(i)}else{for(var l=n;r>l;l++){if(i[l]!=undefined){s=s.concat(i[l]),o.push(i[l])}}}h.datas=o,h.lineDatas=s,h.dataLen=o[0].length,e(),t()}}},V={},W=!1,te=!1,ae={},oe=(new Date).getTime(),se=function(){var e;C=new Date,e=60*C.getTimezoneOffset()*1000,C.setTime(C.getTime()+e),C.setHours(C.getHours()+8)},le=function(e){se();switch(M){case"forex":var td=(window["time"+e.symbol]?{time:window["time"+e.symbol]}:0);D=td||{time:[["00:00","23:59"]]},d=t.tUtil.gata(M,D.time);break;case"HF":d=t.tUtil.gata(M,D.time);break;case"NF":d=t.tUtil.gata(M,T.time);break;case"global_index":d=t.tUtil.gata(M,I.time);break;default:d=t.tUtil.gata(M)}e.index=t.arrIndexOf(d,e.time);var a=e.index;if(h.realLen=a,h.hq.open==h.hq.prevclose&&h.hq.high==h.hq.prevclose&&h.hq.low==h.hq.prevclose&&0>a||h.hq.time<"09:30"){switch(h.market){case"CN":h.realLen=h.hq.time>="15:00"?H-1:0;break;case"NF":case"HF":case"forex":case"global_index":break;default:h.realLen=0}}},ce=function(e,t){var a=e.getTime(),i=t.getTime();return Math.floor((a-i)/86400000)>5
},de=new function(){var a,r=!0,o=function(e){var a;switch(M){case"forex":var td=(window["time"+e.symbol]?{time:window["time"+e.symbol]}:0);D=td||{time:[["00:00","23:59"]]},a=D.time;break;case"HF":a=D.time;break;case"NF":a=T.time;break;case"global_index":a=I.time;break;default:a=[]}var i=t.tUtil.gltbt(1,e.price,!0,h.needMarket,[e.date],a);"NF"==M&&e.time>="21:00"?(i[0].date=f.dd(e.date),i[0].date.setDate(e.date.getDate()+1)):i[0].date=f.dd(e.date),i[0].prevclose=e.price,i[0].price=e.price,i[0].volume=0;for(var n=0,r=0,o=U.get(),s=0,l=o.length;l>s;s++){o[s][0].totalVolume&&(r+=Number(o[s][0].totalVolume),n++)}i[0].lastfive=r/n/390||0,v(o[4][0].date,e.date)?"NF"==M&&e.time>="21:00"?(o.shift(),o.push(i)):o[4]=i:(o.shift(),o.push(i)),U.initTState(o),h.datas=[o[4]],h.date=f.ds(e.date),h.realLen=0},s=0,l=function(e,a,l){function c(){switch(o(h.hq),n(),q.createPlayingData(),h.market){case"US":q.extValues();break;case"NF":T.inited=1}t.isFunc(a)&&a()}function m(){var e=(new Date).getTime()-oe;return !isNaN(ee)&&ee>0&&e>=1000*Number(ee)&&0!=h.realLen&&h.hq.isUpdateTime?(oe=(new Date).getTime(),g(b,h.hq,a),!0):!1}function p(){function i(){v(h.hq.date,y[4][0].date)&&h.hq.time>"16:00"&&o.price<0&&(o.price=h.hq.price,o.avg_price=y[4][y[4].length-2].avg_price,o.volume=0)}function r(){v(h.hq.date,y[4][0].date)&&h.hq.time>"16:00"&&(o.price=h.hq.price,o.avg_price=y[4][y[4].length-2].avg_price,o.volume=0,o.time=h.hq.time,o.avg_price<0&&(o.avg_price=h.hq.price))}if(!h.hq.isUpdateTime){var o=y[4][y[4].length-1];switch(h.market){case"US":i();break;case"HK":r()}return le(h.hq),n(!0),q.createPlayingData(),t.isFunc(a)&&a(),!0}return"HK"==h.market&&l&&g(b,e,a),h.date="NF"==h.market&&h.hq.time>="21:00"?f.ds(y[4][0].date):h.hq.today,!1}var b,y=U.get();switch(h.needMarket){case"forex":var td=(window["time"+e.symbol]?{time:window["time"+e.symbol]}:0);D=td||{time:[["00:00","23:59"]]},d=t.tUtil.gata(h.needMarket,D.time);break;case"HF":d=t.tUtil.gata(h.needMarket,D.time);break;case"NF":d=t.tUtil.gata(h.needMarket,T.time);break;case"global_index":d=t.tUtil.gata(h.needMarket,I.time);break;default:d=t.tUtil.gata(h.needMarket)}if(e&&e.date&&h.datas&&!i.date){b=y[4];if(!m()&&!p()){if(h.datas&&(V=y[4][0]),ce(e.date,y[4][0].date)){return void (h.realLen=H)}L=e.name||"",h.hq=e;var N=e.date.getHours()<10?"0"+e.date.getHours():e.date.getHours();if(h.time=N+":"+t.strUtil.zp(e.date.getMinutes()),0==e.index&&u(b,e),t.arrIndexOf(d,h.time)&&e.index>0&&(t.arrIndexOf(d,h.time)-h.realLen<=1?u(b,e):g(b,e,a),1==e.index&&0==s)){return s=1,void g(b,e,a)}5==J.end&&(n(!0),q.createPlayingData()),t.isFunc(a)&&a()}}},c=-1,m=-1,p=-1,u=function(e,t){var i=e;le(t);var n=i[h.realLen];n&&(V&&!a?(W?(t.volume=c=t.totalVolume-(V.totalVolume||0),t.amount=m=t.volume*t.price,t.totalAmount=t.amount+V.totalAmount,t.avg_price=p=t.totalAmount/t.totalVolume||t.price):(t.volume=0,t.avg_price=p=V.totalAmount/V.totalVolume||t.price,t.totalAmount=t.totalVolume*t.avg_price,W=!0),V.totalVolume=t.totalVolume,V.totalAmount=t.totalAmount):(te?t.volume=t.totalVolume-ae.totalVolume||0:(t.volume=0,te=!0),ae.totalVolume=t.totalVolume),("option_cn"==h.market||"NF"==h.market)&&(n.inventory=t.position||t.holdingAmount),"CN"==h.market?n.avg_price=t.avg_price||n.price:(t.index>1?n.avg_price=(i[t.index-1].avg_price*t.index+t.price)/(t.index+1)||n.price:"fund"==h.market||(n.avg_price=n.price||t.price),0==t.index&&(n.avg_price=t.totalAmount/t.totalVolume||t.price),n.volume=0),"HK"!=h.market&&"NF"!=h.market&&(n.volume+=t.volume),n.price=t.price,n.volume<=0&&(n.volume=0))},g=function(a,r,o){var s={symbol:r.symbol,date:r.today,withT5:0,withI:!1,faker:"",dataformatter:e.datas.t1.dataformatter,ssl:i.ssl};W=te=!1,KKE.api("datas.t.get",s,function(e){a=e.data.td1,le(h.hq);var i=U.get();i[4]=a;U.initTState(i);5==J.end&&(n(!0),q.createPlayingData());t.isFunc(o)&&o()})},b=function(a,n,r){var o={symbol:n.symbol,date:n.today,withT5:1,dist5:1,withI:!1,faker:"",dataformatter:e.datas.t1.dataformatter,ssl:i.ssl};W=te=!1,KKE.api("datas.t.get",o,function(e){a=e.data.td1,U.initTState(e.data.td5),le(h.hq),t.isFunc(r)&&r(),X.moving(J.start,J.end,"T5"),Q.hide()})};this.updateT5Data=b,this.update=function(a,n,o,s,c){var d,h,m,p="";m=s?s:t.market(e.symbol),o?(d="datas.hq.parse",h={symbol:e.symbol+p,hqStr:o,market:m,ssl:i.ssl}):(d="datas.hq.get",h={symbol:e.symbol+p,delay:!0,cancelEtag:r,ssl:i.ssl}),KKE.api(d,h,function(t){l(t.dataObj[e.symbol],a,c)})}},he=new function(){var n=void 0,o=1,s=function(e){o>2||(R.re(_.e.T_DATA_LOADED),t.isFunc(e)&&e(),o++)},l=function(e){var t=e,a=!1;return a=t.hq.open==t.hq.prevclose&&t.hq.high==t.hq.prevclose&&t.hq.low==t.hq.prevclose&&t.hq.index<0?!0:t.hq.time<"09:30"},c=function(a,i){var n,r,o=a;switch(M){case"forex":r=D.time;break;case"HF":r=D.time;break;case"NF":r=T.time;break;case"global_index":r=I.time;break;default:r=[]}var s=t.tUtil.gltbt(1,o.hq.price,!0,h.market,[o.hq.date],r);return s[0].name=o.hq.name,s[0].symbol=e.symbol,s[0].today=t.dateUtil.ds(o.hq.date,"-"),n=i,n[4]=s,h.realLen=0,n};
this.init=function(o){var m=J.viewId;if(n!=m){n=m,null!=h.datas&&U.initTState(m,h.tDb.get());var p={ssl:i.ssl,symbol:e.symbol,date:i.date,withT5:1,dist5:i.dist5,withI:!0,faker:h.needMarket,dataformatter:e.datas.t1.dataformatter};switch(h.needMarket){case"forex":var td=(window["time"+e.symbol]?{time:window["time"+e.symbol]}:0);D=td||{time:[["00:00","23:59"]]},d=t.tUtil.gata(h.needMarket,D.time);break;case"HF":D=D||{time:[["00:00","23:59"]]};d=t.tUtil.gata(h.needMarket,D.time);break;case"NF":d=t.tUtil.gata(h.needMarket,T.time);break;case"global_index":d=t.tUtil.gata(h.needMarket,I.time);break;default:d=t.tUtil.gata(h.needMarket)}Q.show(),KKE.api("datas.t.get",p,function(e){X.hasHistory&&"history"==e.msg&&X.hasHistory(S);var d=e.data.hq.status,m="",u=Number(e.data.hq.state);if("empty"==e.msg){switch(h.market){case"CN":3==d&&(m=_.delisted,P.showTip({txt:m,parent:$,noBtn:!0}))}}if("error"==e.msg||"nohistory"==e.msg){if(a&&"nohistory"==e.msg&&(S=0,X.hasHistory&&X.hasHistory(S),P.showTip({txt:_.nohistoryt,parent:$,noBtn:!0})),h.isErr=!0,a&&e.data&&e.data.hq){if(d){switch(h.market){case"CN":switch(d){case 2:m=_.notlisted;break;case 3:m=_.delisted;break;case 0:m=_.norecord}break;case"HK":switch(d){case 5:m=_.notlisted;break;case 0:m=_.delisted}}}else{m=_.norecord}if(m&&0!=u){var f,g={txt:m,parent:$,noBtn:!0};if(!(E.DIMENSION.getStageW()<200)){return P.showTip({txt:m,parent:$,noBtn:!0}),void Q.hide()}g.bgStyle={padding:0,top:"0px"},f||(f=new t.TipM(E.COLOR),f.genTip(g))}}if(0!=u&&7!=u){if(X.onResize(),1!=d){return void X.removeCompare([p.symbol])}h.isErr=!1}else{h.isErr=!1}}h.hq=e.data.hq,n=void 0,p.td1=e.data.td1;var b;C=new Date;var y=60*C.getTimezoneOffset()*1000;if(C.setTime(C.getTime()+y),C.setHours(C.getHours()+8),L=h.hq.name||"",le(h.hq),l(h,e.data.td5)&&"HF"!=h.market&&"NF"!=h.market&&"global_index"!=h.market?"history"==e.msg?(b=e.data.td5,b[4][0].date||(b[4][0].date=h.hq.date)):b=c(h,e.data.td5):(b=e.data.td5,"NF"!=h.market||!T||"09:30"!=T.time[0][0]&&"09:15"!=T.time[0][0]||v(b[4][0].date,h.hq.date)&&h.hq.time<=T.time[0][0]&&(b=c(h,e.data.td5)),b&&!b[4][0].date&&(b[4][0].date=h.hq.date)),X.historyData=b,h.date=e.data.td1&&e.data.td1[0].today||h.hq.date,U.initTState(b),s(o),1==O&&(r.dateTo(i.historytime,i.historycb),O=0),Q.hide(),i.loadedChart,X.updateDataAll()){if(t.isFunc(i.loadedChart)){i.loadedChart()}else{if(window[i.loadedChart]){window[i.loadedChart]()}else{try{window.h5chart.loadedChart()}catch(N){}}}}})}}};this.tDb=U,this.initData=he.init,this.initT5Data=de.updateT5Data,this.doUpdate=de.update,this.onViewChange=n,this.setPricePos=function(e,t){h.labelMaxP=e[0],h.labelMinP=e[1],h.labelPriceCount=e[2],h.isCompare=t,q.createPlayingData(),k&&k.setPricePos(e)},this.setRange=function(){q.setDataRange(),N&&N.setDataRange(),k&&k.setDataRange(),x&&x.setDataRange()},this.draw=function(){F.draw(),N&&N.allDraw(),k&&k.allDraw()},this.resize=function(e){q.createPlayingData(),F.resize(),N&&N.onResize(e),k&&k.onResize(),x&&x.onResize()},this.clear=function(){F.clear(),N&&(N.clear(),N=null),k&&(k.clear(),k=null),x&&(x.clear(),x=null),a&&(Z=null)},this.getPriceTech=function(){return k||null},this.removePt=function(e){if(e){!t.isArr(e)&&(e=[e]);for(var a=e.length;a--;){if(e[a].name&&"VOLUME"===e[a].name.toUpperCase()){e.splice(a,1),E.custom.show_underlay_vol=!1;break}}}else{E.custom.show_underlay_vol=!1}k&&k.removeChart(e)},this.togglePt=function(e){k&&(y=k.showHide(e))};var me=function(e,a,i){e&&ie.resizeAll(!0),X.onChangeView(),a&&t.isFunc(a.callback)&&a.callback(),i&&ne.onTechChanged(i[0])};this.initPt=function(e,n){if(e){!t.isArr(e)&&(e=[e]);for(var r=e.length;r--;){if(e[r].name&&"VOLUME"===e[r].name.toUpperCase()){e.splice(r,1),E.custom.show_underlay_vol=!0;break}}k||(k=new s({iMgr:re,stockData:h,chartArea:K,titleArea:z,cb:me,type:"t",cfg:E,usrObj:i}),a&&(Y=k)),k.createChart(e,n)}},this.initTc=function(e,t){N||(N=new l({stockData:h,iMgr:re,subArea:G,cb:me,cfg:E,type:"option_cn"==M?"p":"t",usrObj:i,initMgr:ie}),a&&(j=N)),N.createChart(e,t)},this.removeTc=function(e){N&&N.removeChart(e)},this.initRs=function(){x||(x=new o({stockData:h,setting:E,state:J,rc:X.moving,witht5:1}),Z=x),x.linkData()},this.setTLineStyle=F.setTLineStyle,c()}function w(e,n){function r(){var n=e.isMain;if(e.nfloat=i.nfloat||2,n){l=E.COLOR.T_P,c=E.COLOR.T_AVG}else{2!=X.dAdd||o.linecolor||(o.linecolor=i.overlaycolor);var r=o.linecolor||"#cccccc";l=r.K_N||r.T_N||"#"+t.randomColor()}s=new a.xh5_ibPainter({setting:E,sd:e,withHBg:n,ctn:V,iMgr:re,reO:{mh:E.DIMENSION.H_MA4K},iTo:function(t,a,i,n){if(!h(t,re.iHLineO.body)&&t.appendChild(re.iHLineO.body),e&&e.datas){var r,o,s=e.datas[0][0].prevclose;2==e.dAdd?r=e.labelMaxP*s+s-i/E.DIMENSION.h_t*(e.labelMaxP*s+s-(e.labelMinP*s+s)):(r=e.labelMaxP-i/E.DIMENSION.h_t*(e.labelMaxP-e.labelMinP),o=Number(100*(r-s)/s).toFixed(2)+"%"),re.iToD({mark:r,rmark:o,x:a,y:i,oy:E.DIMENSION.H_MA4K,ox:E.DIMENSION.posX,e:n},!0,!1)}}})}var o,s,l,c,d,p={},f=1,v=function(e){o=u({linetype:"line_"+f,linecolor:o?o.linecolor||{}:{}},e||{});
var t=[];e&&e.linetype&&(t=e.linetype.split("_"),t.length>1&&("line"==t[0]||"mountain"==t[0])&&(f=Number(t[1])||1)),p=o.linecolor||{},l=p.K_N||p.T_N||E.COLOR.T_P,c=p.T_AVG||E.COLOR.T_AVG,d=p.T_PREV||E.COLOR.T_PREV},g=function(){function t(){if(e.isMain&&E.custom.show_underlay_vol){for(var t,a=E.COLOR.V_SD,i=w;N>i;i++){k=b[i],t=k.vy,s.drawVStickC(M,t,I,E.DIMENSION.h_t,a),M+=T}s.stroke(),s.getG().lineWidth=1}}function a(){if((!e.isCompare||2==e.dAdd&&e.isMain)&&!("HK"==e.market&&e.hq&&"indx"==e.hq.type||"US"==e.market)){for(M=T*(0.5+w),s.newStyle(c,!0,f),_=w;N>_&&(k=b[_],!(k.price<=0));_++){if(5==J.end&&"CN"==e.market&&Y){for(var t=Y.getLog(),a=0;a<t.length;a++){if("EWI"==t[a].name&&_>(N/H-1)*H){return void s.stroke()}}}_==w||_%H==0?s.moveTo(M,b[_].ay):s.lineTo(M,b[_].ay),M+=T}s.stroke()}}function n(){s.newStyle(l,!0,f),M=T*(0.5+w),"CN"==e.market&&e.preData.vPos&&(0==e.realLen&&e.hq?e.hq.time>"09:29"?(s.moveTo(0,e.preData.vPos),b[0].py||(b[0].py=e.preData.vPos),s.lineTo(M,b[0].py)):s.drawDot(M,e.preData.vPos,1):(s.moveTo(0,e.preData.vPos),b[0].py||(b[0].py=e.preData.vPos),s.lineTo(M,b[0].py)),s.stroke())}function r(){var e;for(_=w;N>_&&(k=b[_],!(k.price<=0));_++){e=k.py,_==w||_%H==0?s.moveTo(M,e):s.lineTo(M,e),k.ix=M,M+=T}S=M,O=e,s.stroke(),i.business&&h({xPos:M,yPos:e})}function h(e){s.newStyle(l,!0,0.5),s.drawDot(e.xPos,e.yPos,3,!0),s.newFillStyle_rgba(E.COLOR.M_ARR,3,1),s.fill(),s.stroke()}function p(){function t(){s.lineTo(M,E.DIMENSION.h_t),s.lineTo(0.5*T,E.DIMENSION.h_t),s.newFillStyle_rgba(E.COLOR.M_ARR,E.DIMENSION.h_t,E.COLOR.M_ARR_A),s.fill()}if(x&&!e.isCompare){if(e.datas.length<2){M-=T,t()}else{M=0.5*T;var a;for(s.newStyle(l,!0,f),_=0;N>_&&(k=b[_],!(k.price<=0));_++){a=k.py,0==_?s.moveTo(M,a):s.lineTo(M,a),M+=T}t()}}}function u(){d=E.COLOR.T_PREV,s.newStyle(d,!0,1);var t,a=0,n=5;for(t=e.isCompare&&e.isMain&&"pct"===E.datas.scaleType?m.pp(0,e.labelMinP,e.labelMaxP,E.DIMENSION.h_t):m.pp(e.datas[0][0].prevclose,e.minPrice,e.maxPrice,E.DIMENSION.h_t),t=~~(t+0.5),t-=0.5;a<E.DIMENSION.w_t;){s.moveTo(a,t),a+=n,s.lineTo(a,t),a+=n}if(e.isMain&&s.stroke(),i.business){var r=e.hq.price.toFixed(2),o=s.getG(),l=o.measureText(r).width,c=E.DIMENSION.w_t-l,h=l+10;S>c&&(S=c),10>S&&(S=20),30>O&&(O=30),o.fillStyle="#EB9A47";var p=v(S-10,O-25,h,20);g(p,5,o),o.beginPath(),o.fillStyle="#fff",o.fillText(r,S-5,O-10),s.fill()}}function v(e,t,a,i){return{x:e,y:t,width:a,height:i}}function g(e,t,a){var i=L(e.x+t,e.y),n=L(e.x+e.width,e.y),r=L(e.x+e.width,e.y+e.height),o=L(e.x,e.y+e.height),s=L(e.x,e.y);a.beginPath(),a.moveTo(i.x,i.y),a.arcTo(n.x,n.y,r.x,r.y,t),a.arcTo(r.x,r.y,o.x,o.y,t),a.arcTo(o.x,o.y,s.x,s.y,t),a.arcTo(s.x,s.y,i.x,i.y,t),a.stroke(),a.fill()}if(!(E.DIMENSION.getStageH()<0)){e.isMain&&s.drawBg("T");var b=[];if(e.datas){for(var y=0;y<e.datas.length;y++){b=b.concat(e.datas[y])}var N=b.length;if(b){var _,k,w,x=o.linetype&&0==o.linetype.indexOf("mountain"),D=e.datas.length*H,T=E.DIMENSION.w_t/Math.max(D,E.PARAM.minCandleNum),I=0.5*T,M=0;e.isTotalRedraw?(w=0,s.clear(!0,E.PARAM.getHd())):(w=D-2,0>w&&(w=0),M+=T*w,s.clearLimit(M+I,T+I));var S=0,O=0,L=function(e,t){return{x:e,y:t}};t(),"sh000012"!=e.symbol&&"sh000013"!=e.symbol&&(i.business||a()),n(),r(),p(),u()}}}};this.draw=g,this.clear=function(){s.remove(),s=null},this.resize=function(){s.resize({mh:E.DIMENSION.H_MA4K}),g()},this.setTLineStyle=v,v(n),r()}function x(){var e,a=this,r=[];this.getAllStock=function(){return r},this.getMainStock=function(){return e},this.getAllSymbols=function(){for(var e=[],t=0,a=r.length;a>t;t++){e.push(r[t].symbol)}return e};var c=function(){var e,t=E.DIMENSION.h_t;return i.business?e=0:i.appMode?2:e=100>t?2:180>t?4:300>t?6:8},d=function(){for(var e,t,a,i=Number.MAX_VALUE,n=-Number.MAX_VALUE,o=r.length,s=o>1,l=s?"avgPercent":"Price",d=o;d--;){e=r[d],a=e.getPriceTech(),a&&!s&&a.getMaxMin()[0]&&(n=a.getMaxMin()[0],i=a.getMaxMin()[1]),t=[n,i],i=Math.min(i,e["min"+l],t[1]),n=Math.max(n,e["max"+l],t[0])}if(Y){var h=Y.getLog(),m=h.length;for(d=0;m>d;d++){if("EWI"==h[d].name||"MA"==h[d].name){var p=r[0].datas[0][0].prevclose,u=Math.max(Math.abs(p-n),Math.abs(p-i));n=p+u,i=p-u}}}for(var f=c(),v=o;v--;){e=r[v],e.setPricePos([n,i,f],s)}},h=function(e){if(e){e.draw()}else{for(var t=r.length;t--;){r[t].draw()}}},m=function(t){1==J.viewId||0==J.viewId?i.date?a.moving(J.start,J.end):a.moving(4,5,!1):a.moving(J.start,J.end,!1),t||ne.onRange(e)},f=function(e){return e.isErr?(t.trace.error("err symbol data"),a.removeCompare([e.symbol]),!0):e.tDb.get()?!0:(e.initData(b),!1)},v=[],g=function(e){if(e&&t.isFunc(e.callback)){for(var a=!1,i=v.length;i--;){if(e.callback===v[i]){a=!0;break}}!a&&v.push(e.callback)}},b=function(a,i){if(g(i),f(e)){if(e.isErr){return t.trace.error("err main symbol"),void (e.isErr=!1)}re.patcher.switchFloater();for(var n,o=!0,s=r.length;s--;){n=r[s],n==e||f(n)||(o=!1)}if(o){for(s=r.length;s--;){r[s].marketNum(r[s].needMarket)>r[s].marketNum(M)&&(M=r[s].needMarket)}for(s=r.length;s--;){O(r[s])}for(m(a);v.length;){var l=v.shift();l()
}}if(ne.onViewChanged(),a){return}ne.onViewPrice(),ne.onDataUpdate()}},N=function(){ne.onRange(e)};this.getExtraData=function(a){if(a=u({symbol:e.symbol,name:null,clone:!0},a||{}),!a.name){return null}for(var i,n,o=r.length;o--;){if(r[o].symbol===a.symbol){i=r[o];break}}if(i){var s;"t1"==a.name||"t5"==a.name?(s=i.tDb.get(),n=a.clone?t.clone(s):s):n=null}return n},this.shareTo=function(e){e=u({type:"weibo",url:window.location.href,wbtext:"",qrwidth:100,qrheight:100,extra:void 0},e);var a=String(e.type).toLowerCase();switch(a){case"qrcode":KKE.api("utils.qrcode.createcanvas",{text:e.url,width:e.qrwidth,height:e.qrheight},function(e){P.showTip({content:e,txt:'<p style="margin:0 0 9px 0;">\u626b\u63cf\u4e8c\u7ef4\u7801</p>',parent:$,btnLb:"\u5173\u95ed"})});break;default:t.grabM.shareTo({ctn:$,w:E.DIMENSION.getStageW(),h:E.DIMENSION.getStageH()-(W.clientHeight||0),ignoreZIdxArr:[E.PARAM.I_Z_INDEX],ignoreIdArr:[E.PARAM.LOGO_ID],priorZIdx:E.PARAM.G_Z_INDEX,nologo:!1,top:E.DIMENSION.posY+E.DIMENSION.H_MA4K+17,right:E.DIMENSION.RIGHT_W+E.DIMENSION.K_RIGHT_W,LOGO_W:E.DIMENSION.LOGO_W,LOGO_H:E.DIMENSION.LOGO_H,color:E.COLOR.LOGO,bgColor:E.COLOR.BG,txt:e.wbtext,url:e.url,extra:e.extra})}};var _,k,w=function(){re.update(),d(),h(),N(),re.isIng()||ne.onViewPrice()},x=function(){clearTimeout(k),!te&&$.parentNode&&"none"!=$.style.display&&(k=setTimeout(w,200))},D=function(e){if(clearInterval(_),!isNaN(i.rate)){var t=1000*i.rate;t>0&&(_=setTimeout(D,t))}for(var a,n=r.length;n--;){a=r[n],a.doUpdate(x,null,null,null,e)}},T=function(){J.viewId=2;for(var e,t=r.length;t--;){e=r[t],e.initT5Data(e.datas,e.hq,b)}};this.updateDataAll=D,this.update5Data=T;var I=function(t,a){var i=new n(t,a);a&&(e=i),r[r.length]=i,L(),b()},S=function(e){for(var t,a,i=e,n=0,o=0;n<r.length;n++){a=r[n],a.marketNum(a.market)==a.marketNum(i)?o++:t=t?a.marketNum(a.market)>a.marketNum(t)?a.market:t:a.market,n==r.length-1&&0==o&&(M=t)}for(n=r.length;n--;){O(r[n],i)}},O=function(e,t){e.changeMarket(t)};this.changeData=O;var L=function(){if(r.length>1){a.mM.togglePt({v:!1})}else{if(r.length<=0){return}a.mM.togglePt({v:!0})}},A=function(e){var t=J.start,a=J.end;return t=Math.max(t+e,0),0==t&&5>=a&&0==J.start&&a++,t>=a&&(t=a-1),a>5&&(a=5),[t,a]};this.onWheel=function(e){var t=-1*e.detail||e.wheelDelta;if(0!=t){t=t>0?-1:1;var i=A(t);a.moving(i[0],i[1],"wheel")}},this.onKb=function(e){var t=e.keyCode;switch(t){case 38:case 40:var i=A(38==t?1:-1);a.moving(i[0],i[1],"Key");break;case 37:case 39:re.iToKb(37==t?-1:1);break;default:return}p.preventDefault(e)},this.zoomApi=function(e){var t=A(e?1:-1);a.moving(t[0],t[1],"zoom")},this.moveApi=function(e){var t=J.start,i=J.end;t+=e,i+=e,i>5&&(t=4,i=5),0>t&&(t=0,i=1),a.moving(t,i,"move")},this.setViewData=m,this.onChangeView=b;var R=1;this.moving=function(t,a,i,n){J.start=t,J.end=a,(4!=t&&5!=a||0!=t&&5!=a)&&(J.viewId=0),n&&4!=t&&1==R&&(i="rs",R=2,C=0),("HF"==M||"NF"==M)&&0==C&&i&&(Q.show(),T("t5"),C=1,R=2);for(var o,s=r.length;s--;){o=r[s],o.setRange(),o.onViewChange()}d(),h(),ne.onRange(e)},this.dAdd=0,this.compare=function(e){for(var t=r.length;t--;){if(r[t].symbol==e.symbol){return}}I(e,!1)},this.removeCompare=function(e){for(var t,a,i="CN",n=e.length;n--;){a=e[n];for(var o=r.length;o--;){if(a==r[o].symbol){t=r.splice(o,1)[0],i=t.market,t.clear(),t=null;break}}}S(i),L(),d(),h(),ne.onRange(r[0])},this.onResize=function(e){for(var t=r.length;t--;){r[t].resize(e)}},this.dcReset=function(){for(var e,t=r.length;t--;){e=r.splice(t,1)[0],e.clear(),e=null}},this.setScale=function(e){E.datas.scaleType=e},this.setTLineStyle=function(a){if(a){!t.isArr(a)&&(a=[a]);for(var i=a.length;i--;){var n=a[i];if(n.hasOwnProperty("symbol")){for(var o=n.symbol,s=r.length;s--;){if(r[s].symbol==o){r[s].setTLineStyle(n),r[s].draw();break}}}else{e.setTLineStyle(n),e.draw()}}}else{e.setTLineStyle(),e.draw()}};var F,H=function(e){e?w():re.update()},U=!1,q=0,V=function(){clearTimeout(F),U=!1,q=0},K=function(){F=setTimeout(function(){q>0&&w(),V()},500)};this.pushData=function(e,t){var a=!1;switch(Number(t)){case 1:V(),a=!0;break;case 2:U||(U=!0,K());break;case 0:V()}for(var i=e.length;i--;){for(var n=r.length;n--;){if(r[n].symbol==e[i].symbol&&e[i].data){q++,r[n].doUpdate(y(H,null,a),!1,e[i].data,e[i].market);break}}}},this.dcInit=function(e){I(e,!0),D()},this.mM=new function(){var t=function(a,i,n){var r,o;switch(i){case"price":r=s,o="initPt";break;case"tech":r=l,o="initTc"}o&&(r?e[o](a,n):KKE.api("plugins.techcharts.get",{type:i},function(e){l=e.tChart,s=e.pChart,t(a,i,n)}))},a=function(t,a){var i;switch(a){case"price":i="removePt";break;case"tech":i="removeTc"}i&&e&&(e[i](t),b())},i=function(t){return o?(Z?Z.sh(t):(e.initRs(),i(t),W.appendChild(Z.getBody())),void ie.resizeAll(!0)):void KKE.api("plugins.rangeselector.get",null,function(e){o=e,i(t)})};this.showRs=i,this.newAC=t,this.removeAC=a,this.togglePt=function(t){e&&(e.togglePt(t),b())}}}var D,T,I,M="CN",S=1,O=0,L="\u624b",C=0;T=i._nf_window_var,D=i._hf_window_var,I=i._gbi_window_var;var A={tcd:function(e){var a;
switch(e){case"forex":var td=(window["time"+i.symbol]?{time:window["time"+i.symbol]}:0);D=td||{time:[["00:00","23:59"]]},a=t.tUtil.gtAll(D.time).length;break;case"HF":D=D||{time:[["00:00","23:59"]]},a=t.tUtil.gtAll(D.time).length;break;case"CN":a=241,t.isRepos(i.symbol)&&(L="");break;case"option_cn":case"op_m":a=241,L="";break;case"HK":a=331,L="";break;case"US":a=391,L="";break;case"NF":a=t.tUtil.gtAll(T.time).length,L="";break;case"global_index":a=t.tUtil.gtAll(I.time).length;break;default:a=241}return a},rmuk:function(e,t,a){var i,n,r=e;return"HK"==a?(i=r.splice(0,120),n=i.concat(r.splice(30,121))):"US"==a||(n=e),n},aduk:function(e,a,i,n,r){var o,s,l,c,d,h=e,m=a,p=i,u=[],v=[],g=n.getHours()+":"+t.strUtil.zp(n.getMinutes()),b=t.tUtil.gata(i),y=f.stbd(n,r)?t.arrIndexOf(b,g):0;"HK"==m&&"US"==i&&(s=[["12:01","12:59"]],u=[1],l=h[150],c=h[h.length-1]),("CN"==m||"option_cn"==m)&&("HK"==p?(s=[["11:30","11:59"],["15:01","16:00"]],u=[0,2],l=h[119],c=h[h.length-1]):(s=[["11:30","11:59"],["12:00","12:59"],["15:01","16:00"]],u=[0,1,2],l=h[119],c=h[h.length-1]));for(var N=0,_=u.length;_>N;N++){for(var k,w,x,D=t.tUtil.gtr([s[N]]),T=[],I=0,M=D.length;M>I;I++){u[N]<2?(("CN"==m||"option_cn"==m)&&(y>120&&150>y?(w=y-120,x=w>I?l.price:-0.01):x=l.price),"HK"==m&&y>150&&180>y&&(w=y-150),k={time:D[I],price:x,avg_price:x,volume:0,fake:u[N]}):(("CN"==m||"option_cn"==m)&&(y>272?(w=y-272,x=w>I?c.price:-0.01):x=c.price),k={time:D[I],price:x,avg_price:x,volume:0,fake:u[N]}),T.push(k)}v.push(T)}return"HK"==a&&(d=h.splice(0,151),o=d.concat(v[0],h)),("CN"==a||"option_cn"==m)&&("US"==p?(d=h.splice(0,120),o=d.concat(v[0],v[1],h,v[2])):"HK"==p&&(d=h.splice(0,120),o=d.concat(v[0],h,v[1]))),o}};t.xh5_EvtDispatcher.call(this);var R=this;i=u({symbol:"sh000001",ssl:0,business:!1,datas:{t1:{url:void 0,dataformatter:void 0},t5:{url:void 0,dataformatter:void 0}},dim:null,theme:null,view:"ts",rate:__rate,t_rate:0/0,fh5:!1,noh5:null,reorder:!0,reheight:!0,dist5:0,w:void 0,h:void 0,mh:0,date:null,dp:!1,onrange:void 0,onviewprice:void 0,ondataupdate:void 0,onviewchanged:void 0,ontechchanged:void 0,onshortclickmain:void 0,nfloat:2,trace:void 0,overlaycolor:void 0,nohtml5info:void 0,tchartobject:{t:void 0,k:void 0}},i||{YANGWEN:"yangwen@staff.sina.com.cn",VER:"2.5.25"}),!i.symbol&&(i.symbol="sh000001"),i.symbol=String(i.symbol),i.symbol=i.symbol.replace(".","$"),0==location.protocol.indexOf("https:")&&(i.ssl=!0);var F="_"+i.symbol+"_"+Math.floor(1234567890*Math.random()+1)+Math.floor(9876543210*Math.random()+1),E=e.getSetting(F);E.datas.isT=!0,i.reorder||(E.custom.indicator_reorder=!1),i.reheight||(E.custom.indicator_reheight=!1),M=t.market(i.symbol),E.datas.tDataLen=A.tcd(M);var H=E.datas.tDataLen,P=new function(){var e;this.showTip=function(a){e||(e=new t.TipM(E.COLOR)),e.genTip(a)},this.hideTip=function(){e&&e.hide()}};if(b.noH5){if("undefined"==typeof FlashCanvas||i.fh5){return void (t.isFunc(i.noh5)&&i.noh5(i))}E.PARAM.isFlash=!0}if(E.PARAM.isFlash&&(E.COLOR.K_EXT_BG="#fff",E.COLOR.F_BG="#fff"),i.dim){for(var U in i.dim){i.dim.hasOwnProperty(U)&&t.isNum(E.DIMENSION[U])&&(E.DIMENSION[U]=i.dim[U])}}var q,$,V,K,z,G,W,X,B,j,Y,Z,Q,J={viewId:_.URLHASH.vi(i.view||"ts"),dataLength:void 0,start:void 0,end:void 0,startDate:void 0,endDate:void 0},ee=isNaN(i.t_rate)?E.PARAM.T_RATE:i.t_rate,te=!1,ae=0,ie=new function(){var e,a=function(e,t,a){var n=!1;isNaN(e)&&(e=i.w||q.offsetWidth),isNaN(t)&&(t=i.h||q.offsetHeight-i.mh);for(var r,o=W.clientHeight||0,s=G.clientHeight||0,l=E.DIMENSION.getOneWholeTH(),c=0,d=G.childNodes,h=d.length,m=0,p=d.length;p--;){r=d[p],r.id.indexOf("blankctn")>=0?(c=r.offsetHeight,h--,m+=c):m+=l}return !isNaN(a)&&(s-=a),s/(t-o)>1&&(s=m,n=!0),E.DIMENSION.setStageW(e),1==ae?h>0&&(E.DIMENSION.setStageH(t,h*l+c+o),n=!0,ae=0):E.DIMENSION.setStageH(t,s+o),0>t&&(E.DIMENSION.H_T_G=E.DIMENSION.H_T_G-E.DIMENSION.H_T_T,E.DIMENSION.H_T_B=E.DIMENSION.H_TIME_PART),n},n=function(){Q.setPosition()},r=function(){e&&(e.style.display=E.custom.show_logo?"":"none")},o=function(e,i,o){var s=a(i,o,0/0);if(e||i&&o){if(!X){return}X.onResize(s),re.onResize()}n(),r(),t.stc("t_wh",[E.DIMENSION.getStageW(),E.DIMENSION.getStageH()])},s=function(){q=c(i.domid)||i.dom,q||(q=d("div"),document.body.appendChild(q),t.trace.error("missing of dom id")),$=d("div"),$.style.position="relative",$.style.outlineStyle="none",$.style.webkitUserSelect=$.style.userSelect=$.style.MozUserSelect="none",V=d("div","mainarea_"+E.uid),K=d("div"),V.appendChild(K),z=d("div"),z.style.position="absolute",z.style.fontSize=E.STYLE.FONT_SIZE+"px",V.appendChild(z),$.appendChild(V),G=d("div"),$.appendChild(G),W=d("div"),$.appendChild(W),q.appendChild($),Q=new t.LoadingSign,Q.appendto(V,E)},l=function(a){var i=!1;if(a){Z&&(i=Z.setTheme(a));for(var n in a){a.hasOwnProperty(n)&&E.COLOR.hasOwnProperty(n)&&E.COLOR[n]!==a[n]&&(E.COLOR[n]=a[n],i=!0)}t.stc("t_thm",a)}return i&&k.styleLogo({logo:e,color:E.COLOR.LOGO}),i},h=function(e){!E.custom.mousewheel_zoom||document.activeElement!==$&&document.activeElement.parentNode!==$||(X&&X.onWheel(e),p.preventDefault(e),p.stopPropagation(e))
},m=function(e){E.custom.keyboard&&X&&X.onKb(e)},u=function(){t.xh5_deviceUtil.istd||(b.info.name.match(/firefox/i)?p.addHandler($,"DOMMouseScroll",h):p.addHandler($,"mousewheel",h),$.tabIndex=0,p.addHandler($,"keydown",m))},f=function(t){e=t,$.appendChild(t)},v=function(){s(),l(i.theme),o(),u(),E.DIMENSION.h_t<0&&(V.style.display="none",E.custom.indicator_reorder=!1,E.custom.indicator_reheight=!1),k.getLogo({cb:f,id:E.PARAM.LOGO_ID,isShare:!1,top:E.DIMENSION.posY+E.DIMENSION.H_MA4K+17,right:E.DIMENSION.RIGHT_W+E.DIMENSION.K_RIGHT_W,LOGO_W:E.DIMENSION.LOGO_W,LOGO_H:E.DIMENSION.LOGO_H,color:E.COLOR.LOGO}),b.noH5&&(P.showTip({txt:i.nohtml5info||_.nohtml5info,parent:$}),t.stc("t_nh5"))};v(),this.resizeAll=o,this.innerResize=function(e){X&&(a(0/0,0/0,e),X.onResize(),re.onResize(),n(),ne.onInnerResize({height:E.DIMENSION.h_t}))},this.initTheme=l},ne=new function(){var e=0,a=function(a,i){var n=H-1,r=X.getAllStock()[0];if(r&&r.datas&&(v(r.datas[r.datas.length-1][0].date,r.hq.date)?i=r.realLen<0||r.realLen>n?n:n=r.realLen:"NF"==M&&T&&"21:00"==T.time[0][0]?i=n=r.realLen:r.realLen<0||r.realLen>n?i=n:(i=n,r.datas[r.datas.length-1][i].price<0&&(i=r.realLen)),a=r.datas[r.datas.length-1][i],a&&a.time)){var o,s;if("HF"==M?(o=D.time[0][0],o>a.time?(o=r.datas[r.datas.length-1][0].date,s=new Date(o),s.setDate(s.getDate()+1)):s=r.datas[r.datas.length-1][0].date):"NF"==M?(o=T.time[0][0],o<a.time&&"21:00"==o?(o=r.datas[r.datas.length-1][0].date,s=new Date(o),s.setDate(s.getDate()-1)):s=r.datas[r.datas.length-1][0].date):s=r.datas[r.datas.length-1][0].date,"US"==M&&r.hq&&r.datas&&r.datas.length>0&&r.hq.today===r.datas[r.datas.length-1][0].today){var l=r.datas[r.datas.length-1][i];-1==l.price&&(l.price=l.avg_price=r.hq.price,l.percent=(r.hq.price-r.hq.prevclose)/r.hq.prevclose)}return a.day=t.dateUtil.ds(s,"/",!1)+"/"+t.dateUtil.nw(s.getDay())+(a.time||""),e=i,t.clone(a)}};this.currentData=a,this.onDataUpdate=function(){if(t.isFunc(i.ondataupdate)){var e=a();e&&i.ondataupdate({data:t.clone(e),idx:J.currentLength-1,left:E.DIMENSION.posX,top:E.DIMENSION.H_MA4K})}},this.onInnerResize=function(e){t.isFunc(i.oninnerresize)&&i.oninnerresize(e)},this.onRange=function(e){!te&&t.isFunc(i.onrange)&&e&&i.onrange({isCompare:e.isCompare,data:t.clone(e.datas),width:E.DIMENSION.w_t,height:E.DIMENSION.h_t,viewRangeState:t.clone(J),range:[e.labelMinP,e.labelMaxP,e.labelMaxVol],left:E.DIMENSION.posX,top:E.DIMENSION.H_MA4K})},this.onViewChanged=function(){t.isFunc(i.onviewchanged)&&i.onviewchanged({viewRangeState:t.clone(J)})},this.onViewPrice=function(n,r,o,s){if(!te&&t.isFunc(i.onviewprice)){if(n||(n=a(n,r)),!n){return}o||(o=X.getMainStock().getName());var l=t.clone(n),c=i.symbol.length;"HK"==M&&i.symbol.substring(c-1,c)>="A"&&(l.avg_price=0/0),l.volume&&l.volume<0&&(l.volume=0),i.onviewprice({curname:o||"",data_array:X.getAllStock().length,data:l,idx:e,left:E.DIMENSION.posX,top:E.DIMENSION.H_MA4K,interacting:!!s})}},this.onTechChanged=function(e){t.isFunc(i.ontechchanged)&&i.ontechchanged({Indicator:e})},this.shortClickHandler=function(){t.isFunc(i.onshortclickmain)&&i.onshortclickmain()}},re=new function(){var e,a,n,r,o,s=isNaN(i.nfloat)?2:i.nfloat,l=137,c=new function(){var t=function(t){var a=e.body.style;t&&E.custom.show_floater?(a.backgroundColor=E.COLOR.F_BG,a.color=E.COLOR.F_T,a.border="1px solid "+E.COLOR.F_BR,a.display=""):a.display="none"};this.pv=function(a){s=isNaN(i.nfloat)?2:i.nfloat;var n=e.body.style,r=Math.max(E.DIMENSION.posX,55)+9,o=E.DIMENSION.posX<55?9:0,c=E.DIMENSION.getStageW()-l-9-E.DIMENSION.RIGHT_W-o;n.left=(a.x>E.DIMENSION.getStageW()-E.DIMENSION.RIGHT_W>>1?r:c)+"px",n.top=(a.y||0)+"px",t(!0)},this.showFloater=t},m=function(){function t(){var e=X.getAllStock()[0];return !("HK"!=e.market||"indx"!=e.hq.type)}function i(){var e,a,i,n="border:0;font-size:100%;font:inherit;vertical-align:baseline;margin:0;padding:0;border-collapse:collapse;border-spacing:0;text-align:center;",r="font-weight:normal;border:0;height:16px;text-align:center;",o="text-align:left;font-weight:normal;border:0;height:16px;",c="text-align:right;border:0;height:16px;",h=d("div");h.style.position="absolute",h.style.zIndex=E.PARAM.I_Z_INDEX+2,h.style.padding="2px",h.style.width=l+"px",h.style.lineHeight="16px",h.style.display="none",h.style.fontSize="12px";var m,p,u,f,v=d("table"),g=d("thead"),b=d("tbody");v.style.cssText=n,m=d("tr"),p=d("th"),p.setAttribute("colspan","2"),p.style.cssText=r;var y=d("span");p.appendChild(y),m.appendChild(p),g.appendChild(m),m=d("tr"),m.style.textAlign="center",p=d("th"),p.setAttribute("colspan","2"),p.style.cssText=r;var _=d("span");p.appendChild(_),m.appendChild(p),b.appendChild(m),m=d("tr"),p=d("th"),p.style.cssText=o,u=d("td"),p.style.fontWeight="normal",f=d("span"),f.innerHTML="\u4ef7\u683c";var k=d("span");u.style.cssText=c,p.appendChild(f),u.appendChild(k),p.style.fontWeight="normal",m.appendChild(p),m.appendChild(u),b.appendChild(m),m=d("tr"),p=d("th"),p.style.cssText=o,p.style.fontWeight="normal",u=d("td"),f=d("span"),f.innerHTML="\u5747\u4ef7";
var w=d("span");u.style.cssText=c,p.appendChild(f),p.style.fontWeight="normal",u.appendChild(w),m.appendChild(p),m.appendChild(u),b.appendChild(m),m=d("tr"),p=d("th"),p.style.cssText=o,u=d("td"),p.style.fontWeight="normal",f=d("span"),f.innerHTML="\u6da8\u8dcc";var x=d("span");u.style.cssText=c,p.appendChild(f),u.appendChild(x),m.appendChild(p),m.appendChild(u),b.appendChild(m),m=d("tr"),p=d("th"),p.style.cssText=o,u=d("td"),p.style.fontWeight="normal",f=d("span"),f.innerHTML="\u6210\u4ea4";var D=d("span");u.style.cssText=c,"HF"!=M&&(p.appendChild(f),u.appendChild(D),m.appendChild(p),m.appendChild(u),b.appendChild(m)),v.appendChild(g),v.appendChild(b),v.style.width="100%",h.appendChild(v);var T=function(e,t){var a=E.COLOR.F_N;return e>t?a=E.COLOR.F_RISE:t>e&&(a=E.COLOR.F_FALL),a};this.setFloaterData=function(n){if(e=n.name||e||"",y.innerHTML=e,i=n.time||i,a=n.data||a){_.innerHTML=i;var r=a,o=Number(r.percent),l=Number(r.price),c=Number(r.prevclose),d=Number(r.avg_price),h=r.change,m=1>l||1>d?4:s;"HF"==M&&(3>l||3>d?m=4:(99>l||99>d)&&(m=3)),o=isNaN(o)?"--":(100*o).toFixed(2),k.innerHTML=l.toFixed(m),w.innerHTML=t()?"--":d.toFixed(m),x.innerHTML=h.toFixed(m)+"("+o+"%)",D.innerHTML=N(r.volume<0?0:r.volume,2)+L,x.style.color=T(o,0),w.style.color=T(d-c,0),k.style.color=T(o,0)}},this.body=h}a=new i,e=a},p=function(){function e(e){var t=d("div"),a=d("div"),i=d("span"),n=d("span"),r=e.isH,o=12,s=function(){if(a.style.borderStyle="dashed",a.style.borderColor=E.COLOR.IVH_LINE,i.style.backgroundColor=n.style.backgroundColor=E.COLOR[e.txtBgCN],i.style.color=n.style.color=E.COLOR[e.txtCN],r){a.style.borderWidth="1px 0 0 0",t.style.width=a.style.width=E.DIMENSION.getStageW()-E.DIMENSION.RIGHT_W+"px",i.style.top=-(0.6*E.STYLE.FONT_SIZE)+"px",n.style.top=-(0.6*E.STYLE.FONT_SIZE)+"px",i.style.left=0,n.style.left=E.DIMENSION.extend_draw?E.DIMENSION.getStageW()-55+2*E.DIMENSION.RIGHT_W+"px":E.DIMENSION.getStageW()-E.DIMENSION.RIGHT_W+"px",i.style.width=n.style.width=E.DIMENSION.extend_draw?"":E.DIMENSION.posX+"px",i.style.padding="1px 0",n.style.padding="1px 0"}else{a.style.borderWidth="0 1px 0 0";var o,s,l=E.DIMENSION.H_MA4K+E.DIMENSION.H_T_B;E.DIMENSION.getStageH()<0?(o=G.clientHeight,s=o-l):(o=E.DIMENSION.getStageH()-W.clientHeight||0,s=E.DIMENSION.h_t),o-=l,o+=E.DIMENSION.I_V_O,t.style.height=a.style.height=o+"px",i.style.top=s+"px",i.style.padding="2px 2px 1px"}};t.style.position="absolute",t.style.zIndex=E.PARAM.I_Z_INDEX-2,i.style.position=n.style.position=a.style.position="absolute",a.style.zIndex=0,i.style.zIndex=n.style.zIndex=1,i.style.font=n.style.font=E.STYLE.FONT_SIZE+"px "+E.STYLE.FONT_FAMILY,i.style.whiteSpace=n.style.whiteSpace="nowrap",i.style.lineHeight=o+"px",n.style.lineHeight=o+"px",e.txtA&&(i.style.textAlign=e.txtA)&&(n.style.textAlign="left"),e.txtBgCN&&(i.style.backgroundColor=E.COLOR[e.txtBgCN])&&(n.style.backgroundColor=E.COLOR[e.txtBgCN]),s(),t.appendChild(i),r&&t.appendChild(n),t.appendChild(a);var l=function(e){e?""!=t.style.display&&(t.style.display=""):"none"!=t.style.display&&(t.style.display="none")};this.pv=function(e){if(!isNaN(e.y)&&(t.style.top=e.y+(e.oy||0)+"px"),i.innerHTML=e.v||"",e.p?(n.innerHTML=isNaN(Number(e.p.replace("%","")))?"0.00%":e.p,n.style.display=""):n.style.display="none",!isNaN(e.x)){var a=e.x+(e.ox||0),r=E.DIMENSION.getStageW();t.style.left=a+"px";var o=i.offsetWidth;if(0>=o&&(o=112),o>0){var s=o>>1;e.x<s?s=e.x:a+s>r-E.DIMENSION.posX&&(s=a+o-r+E.DIMENSION.posX),i.style.left=-s+"px"}}l(!0)},this.display=l,this.body=t,this.resize=s,l(!1)}n=new e({isH:!0,txtCN:"P_TC",txtBgCN:"P_BG",txtA:"right"}),r=new e({isH:!1,txtCN:"T_TC",txtBgCN:"T_BG",txtA:"center"}),$.appendChild(r.body)},u=function(){n.display(!1),r.display(!1),c.showFloater(!1)},g=function(){var e=X.getAllStock(),t=e[0].datas.length,a=0;return e[0].realLen>=0&&(a=5==J.end?e[0].realLen+E.datas.tDataLen*(t-1):E.datas.tDataLen*(t-1)),a},b=function(e){0>e||(j&&j.indirectI(e),Y&&Y.indirectI(e))},y=function(){b(g()),j&&j.allDraw()},k=!0,w=0,x=0,I=0/0,S=0/0;this.iToD=function(a,i,o){var l=a.x,d=a.ox||0,h=a.y,m=a.oy||0,p=a.mark,g=a.rmark,y=a.e?a.e.target:null;if(!o){if(I==l&&S==h){return}I=l,S=h}if(y){var N=y.style.height.split("px")[0];(0>h||h>Number(N))&&(l=0/0,h=0/0)}var O,L=X.getAllStock(),C=L.length,A=H,F=C>1,P=L[0].datas.length,U=A*P,q=Math.floor(l*U/E.DIMENSION.w_t);if(isNaN(l)&&isNaN(h)){if(k=!0,u(),v(L[0].datas[P-1][0].date,L[0].hq.date)){var $;$=L[0].realLen>=0?(A-1)*(P-1)+L[0].realLen:Number.MAX_VALUE,b($)}else{b(Number.MAX_VALUE)}return void ne.onViewPrice()}k=!1,x=q;for(var V,K,z,G,W,B,j,Y,Z=[],Q=Number.MAX_VALUE,ee=C;ee--;){if(B=L[ee].datas,Z=Z.concat(B),B){var te=Math.floor(q/A),ae=q%A;if(!B[te]){return}if(j=B[te][ae],j.date=B[te][0].date,F&&L[ee].dAdd<=1){Y=Math.abs(j.py-h),Q>Y&&(K=ee,Q=Y,O=j,z=L[ee],G=L[ee].getName(),W=L[ee].getStockType()),g=V=i?(100*p).toFixed(2)+"%":p.toFixed(s)}else{switch(K=ee,z=L[ee],G=L[ee].getName(),W=L[ee].getStockType(),M){case"HK":V=p.toFixed(1>p&&p>0||p>-1&&0>p?3:s);break;case"HF":V=p.toFixed(3>p?4:99>p?3:s);
break;default:V=p.toFixed(1>p&&p>0||p>-1&&0>p?4:s)}V=p>99999?Math.floor(p):p>9999?p.toFixed(1):V,O=j}}}var ie=j&&j.date;w=0==L[0].realLen?0:L[0].realLen-1;var re="string"!=typeof L[0].date?f.ds(L[0].date):L[0].date;if(P>1){z.realLen<0&&(z.realLen=H);var oe=U-A+z.realLen;5==J.end&&q>=oe&&(q=oe,O=Z[te][q%H])}else{if(f.stbd(ie,f.sd(re))){-1==z.realLen&&(z.realLen=H),q>=z.realLen&&(q=z.realLen)}else{switch(M){case"HF":case"NF":q>=z.realLen&&4==J.start&&(q=z.realLen);break;default:w=H-1}}"HF"!=M&&"NF"!=M&&f.stbd(ie,f.sd(re))&&z.hq&&z.hq.time>="09:00"&&z.hq.time<"09:30"?O={price:z.hq.preopen,avg_price:z.hq.preopen,prevclose:z.hq.prevclose,percent:(z.hq.open-z.hq.prevclose)/z.hq.prevclose,change:z.hq.preopen-z.hq.price,volume:z.hq.totalVolume,ix:0.1,time:z.hq.time}:(O=z.datas[0][q],O.prevclose=z.datas[0][0].prevclose)}if(O&&(O.date||(O.date=ie),!O||O.date)){var se=l;E.custom.stick&&(l=O.ix||l);var le,ce;"HF"==M?(le=D.time[0][0],le>O.time?(le=O.date,ce=new Date(le),ce.setDate(ce.getDate()+1)):ce=O.date):"NF"==M?(le=T.time[0][0],le<=O.time&&"21:00"==le?(le=O.date,ce=new Date(le),ce.setDate(ce.getDate()-1),0==ce.getDay()&&ce.setDate(ce.getDate()-2)):O.time<"03:00"&&1==O.date.getDay()?(ce=new Date(O.date),ce.setDate(ce.getDate()-2)):ce=O.date):ce=O.date;var de=t.dateUtil.ds(ce,"/",!1)+"/"+t.dateUtil.nw(ce.getDay())+(O.time||"");O.day=de,e&&(e.setFloaterData({stocktype:W,name:G,time:de,data:O}),c.pv({x:se,y:E.DIMENSION.T_F_T})),n.pv({y:h,oy:m,v:V,p:g}),r.pv({v:de,x:l,ox:d,y:E.DIMENSION.H_MA4K}),b(q),ne.onViewPrice(O,q,G,!k),R.re(_.e.I_EVT,a.e)}},this.globalDragHandler=function(e,t,a,i,n){isNaN(e)&&isNaN(t)&&R.re(_.e.I_EVT,n)},this.shortClickHandler=function(){ne.shortClickHandler()},this.zoomView=function(){},m(),p(),this.onResize=function(){n.resize(),r.resize()},this.iHLineO=n,this.hideIUis=u,this.iToKb=function(e){x+=e,w=x;var t=X.getAllStock(),a=t[0].datas.length,i=t[0].datas[0][x],n=t.length,r=t[0].realLen,o="string"!=typeof t[0].date?f.ds(t[0].date):t[0].date;1>=a?f.stbd(t[0].datas[0][0].date,f.sd(o))?0>r&&(r=H):r=H:f.stbd(t[0].datas[a-1][0].date,f.sd(o))||(r=H);var s=H>r?r+1:r;if(0>x){var l=H>r?r:r-1;w=x=(a-1)*H+l,i=t[0].datas[a-1][l]}else{if(x>=s+(a-1)*H){if(f.stbd(t[0].datas[a-1][0].date,f.sd(o))&&0>e){var c=0;c=a>1?r-1+H*(a-1):r-1,w=x=c,i=t[0].datas[0][w]}else{w=x=0,i=t[0].datas[0][0]}}}!h(V,re.iHLineO.body)&&V.appendChild(re.iHLineO.body);var d=Math.floor(w/H);x>=H&&(i=t[0].datas[d][w-d*H]),i.date=t[0].datas[d][0].date;var m=n>1?i.percent:i.price,p={idx:x,name:t[0].getName(),mark:m,datas:t[0].datas,data:i,x:i.ix,y:i.py,oy:E.DIMENSION.H_MA4K,ox:E.DIMENSION.posX};this.iToD(p,!0,!0)},this.isIng=function(){return !k},this.isMoving=function(){return !1},this.iReset=function(){},this.patcher=new function(){var i,n={},r=function(){if(i){e.body.parentNode&&e.body.parentNode.removeChild(e.body);var t="vid_"+J.viewId;if(i[t]){var r;r=n[t]?n[t]:n[t]=new i[t],e=r}else{e=a}}else{e=a}!h($,e.body)&&$.appendChild(e.body)};this.customFloater=function(e){i=e,r(),t.stc("t_fl",e)},this.switchFloater=r},this.update=function(){var a=X.getAllStock();if(a){var i,n=a[0],r=n.datas.length,s=0;if(n){if(x>r*(H-1)&&(x=0),i=Math.floor(x/(H-1)),r==i&&(i-=1),x>H-1){var l=x-H*i;s=v(n.datas[i][0].date,n.hq.date)&&l>w?n.realLen:l}else{s=1==r&&0==i&&x>w?n.realLen:x}if(i=0>i?0:i,s=0>s?0:s,o=n.datas[i][s]){if(o.day=t.dateUtil.ds(n.datas[i][0].date,"/",!1)+"/"+t.dateUtil.nw(n.datas[i][0].date.getDay())+(o.time||""),e&&e.setFloaterData({}),k){if(v(n.datas[r-1][0].date,n.hq.date)){s=n.realLen>=0?n.realLen:H-1,s+=(r-1)*H,s=0>s?Number.MAX_VALUE:s,b(s)}else{if("NF"==M&&n.hq.time>="21:00"){return n.realLen>=0&&(s=n.realLen),void (4==J.start&&5==J.end&&ne.onViewPrice(o,s,void 0,!k))}y()}}else{if("HF"==M){4==J.start&&5==J.end&&ne.onViewPrice(o,s,void 0,!k)}else{if("NF"==M){var c=new Date(o.date);o.date&&o.time>="21:00"&&(c.setDate(1==o.date.getDay()?c.getDate()-3:c.getDate()-1),o.day=t.dateUtil.ds(c,"/",!1)+"/"+t.dateUtil.nw(c.getDay())+(o.time||"")),ne.onViewPrice(o,s,void 0,!k)}else{ne.onViewPrice(o,s,void 0,!k)}}}}}}}};return r=new function(){var e=this,a=function(a,i){if(E.hasOwnProperty(a)){for(var n in i){if(i.hasOwnProperty(n)&&t.isFunc(i[n])){return void t.trace.error("illegal operation:",n)}}"DIMENSION"==a&&(ae=1),u(E[a],i),t.stc(a,i),e.resize()}else{t.trace.error("not exist param:",a)}},n=function(e,a){var i;if(E.hasOwnProperty(e)){i=t.clone(E[e]);for(var n in i){if(i.hasOwnProperty(n)&&t.isFunc(i[n])){i[n]=null,delete i[n]}else{if(a){for(var r=a.length;r--;){typeof i[n]===a[r]&&(i[n]=null,delete i[n])}}}}}return i},r=function(e,t,a){a=u({toremove:!1,isexclusive:!1,callback:void 0},a),a.toremove?X.mM.removeAC(t,e):a.isexclusive?(X.mM.removeAC(null,e),X.mM.newAC(t,e,a)):X.mM.newAC(t,e,a)},o=function(e){J.viewId=e,J.start=1==e?4:0,J.end=5};this.pushData=function(e,a){!t.isArr(e)&&(e=[e]),X.pushData(e,a)};var s;this.pushTr=function(e){e&&e.data&&(clearTimeout(s),s=setTimeout(function(){var t=e.data.split(","),a=e.symbol,i=e.market,n={symbol:a,data:t[t.length-1],market:i};
X.pushData([n],1)},20))},this.setScale=function(e){X.setScale(e),t.stc("t_scale",e)};var l=!0;this.showView=function(e,a){re.hideIUis(),l?l=!1:Q.hide();var n=_.URLHASH.vi(e);if(i.date){return i.date="",o(n),void this.newSymbol(i)}var r=X.getAllStock()[0];if(ne.onRange(r),t.stc("t_v",e),t.suda("vw",e),J.viewId!=n){if(o(n),("HF"==M||"NF"==M)&&"t5"==e&&0==C){return Q.show(),C=1,void X.update5Data(e)}X.onChangeView(!1,a),ne&&ne.onViewPrice()}};var d=function(e){var a;return a=t.isStr(e.symbol)?e.symbol.split(","):[e.symbol]},h=[];this.overlay=function(e,t){if(X&&1!=X.dAdd){if(t){X.removeCompare(d(e));for(var a=0;a<h.length;a++){e.symbol==h[a]&&h.splice(a,1)}X.getAllStock().length<=1&&(X.dAdd=0)}else{i.overlaycolor=e.linecolor||{K_N:"#cccccc"},X.dAdd=2,X.compare(e),h.push(e.symbol)}}},this.compare=function(e,a){if(X){var i,n=0;if(a){if(i=t.isStr(e)?e.split(","):[e.symbol],1==X.dAdd&&X.removeCompare(i),X.getAllStock().length<=1){for(n=0;n<h.length;n++){X.dAdd=2,X.compare({symbol:h[n]})}h.length<1&&(X.dAdd=0)}}else{2==X.dAdd&&X.removeCompare(h),X.dAdd=1,X.compare(e),t.suda("t_comp")}t.stc("t_comp",{rm:a,o:e})}};var m=0;this.tCharts=function(e,a){r("tech",e,a),a&&!a.noLog&&(0==m?m=1:t.sudaLog())};var p=0;this.pCharts=function(e,a){r("price",e,a),a&&!a.noLog&&(0==p?p=1:t.sudaLog())},this.showPCharts=function(e){e&&(X.mM.togglePt(e),t.stc("t_sp",e))},this.getIndicators=function(){var e=j?j.getLog():null,t=Y?Y.getLog():null;return{tCharts:e,pCharts:t}};var v;this.showRangeSelector=function(e){v=u({dispaly:!0,from:void 0,to:void 0},e),X.mM.showRs(v),t.stc("t_rs",e)},this.setLineStyle=function(e){X&&X.setTLineStyle(e),t.stc("t_style",e)},this.setCustom=y(a,this,"custom"),this.setDimension=y(a,this,"DIMENSION"),this.getDimension=y(n,null,"DIMENSION",["boolean"]),this.setTheme=function(e){var t=ie.initTheme(e);t&&(this.setLineStyle({linecolor:e}),this.resize())},this.newSymbol=function(e){if(i.symbol=e.symbol,i.date=e.date,re.hideIUis(),re.iReset(),X.dcReset(),X.dcInit(i),P.hideTip(),j){var a=j.getLog();j=null,a&&this.tCharts(a)}if(Y){var n=Y.getLog();Y=null,n&&this.pCharts(n)}v&&(v.from=void 0,v.to=void 0,X.mM.showRs(v)),t.stc("t_ns",e)},this.resize=function(e,t){ie.resizeAll(!0,e,t)},this.hide=function(e){te=!0,re.hideIUis(),t.$CONTAINS(q,$)&&q.removeChild($),e&&X.dcReset()},this.show=function(e){te=!1,e&&(t.isStr(e)&&(e=c(e)),q=e),t.$CONTAINS(q,$)||(q.appendChild($),ie.resizeAll(!0)),ne&&ne.onViewPrice()},this.shareTo=function(e){X.shareTo(e),t.stc("t_share",e);var a=e&&e.type?e.type:"weibo";t.suda("share",a)},this.getChartId=function(){return E.uid},this.dateTo=function(e,a){i.historytime=e,i.historycb=a;var n=e;"object"==typeof e?n=f.ds(e,"-"):e=f.sd(e);var r=B.get();if(null==r){return void (O=1)}for(var o=r.length,s=0;o>s;s++){if(f.stbd(e,r[s][0].date)){return void X.moving(s,s+1,"dateTo")}}i.date=n,X.hasHistory=a,t.stc("t_ft",n),this.newSymbol(i)},this.showScale=function(e){X&&X.setScale(e)},this.resize=function(e,t){ie.resizeAll(!0,e,t)},this.showCompatibleTip=function(e){ie.showCompatibleTip(e)},this.toggleExtend=function(e){var t,i=E.DIMENSION.posX;t=e?"on"==!e:E.DIMENSION.extend_draw,a.call(this,"DIMENSION",{extend_draw:!t,posX:i>9?7:55,RIGHT_W:i>9?7:55}),this.resize()},this.historyData=function(){return X.historyData},this.getExtraData=function(e){return X.getExtraData(e)},this.patcher={iMgr:re.patcher},this.zoom=function(e){X.zoomApi(e),t.stc("t_zoom",e,9000)},this.move=function(e){e=parseInt(e),isNaN(e)||(X.moveApi(e),t.stc("t_move",e,9000))},this.getSymbols=function(){return X.getAllSymbols()},this.update=function(){X.updateDataAll(1),t.stc("t_up","update",9000)},this.getCurrentData=function(){return ne.currentData()},this.viewState=J,this.me=R,this.type="h5t"},X=new x,X.dcInit(i),r}function n(){function e(e,a){var n=new i(e),r=function(e){n.me.rl(e,r)};n.me.al(_.e.T_DATA_LOADED,r),t.isFunc(a)&&a(n)}this.get=function(a,i){t.stc("h5t_get"),t.suda("h5t_"+t.market(a.symbol));var n;0==location.protocol.indexOf("https:")&&(n=!0);var r=t.market(a.symbol),o="/api.ashx?_m=tt&symbol=$symbol&cb=$cb",s="/usstock/api/jsonp.php/var $cb=/Global_IndexService.getTradeTime?symbol=$symbol&category=index";e(a,i)}}var r,o,s,l,c=t.$DOM,d=t.$C,h=t.$CONTAINS,m=t.xh5_PosUtil,p=t.xh5_EvtUtil,u=t.oc,f=t.dateUtil,v=t.dateUtil.stbd,g=t.xh5_ADJUST_HIGH_LOW.c,b=t.xh5_BrowserUtil,y=t.fBind,N=t.strUtil.ps,_=e.globalCfg,k=t.logoM;return t.fInherit(i,t.xh5_EvtDispatcher),n});